<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=UTF-8">
<meta name=Generator content="Microsoft Word 14 (filtered)">
<style>
<!--
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
h1
	{mso-style-link:"Heading 1 Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:15.0pt;
	margin-left:0in;
	border:none;
	padding:0in;
	font-size:36.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;
	font-weight:normal;}
h1.CxSpFirst
	{mso-style-link:"Heading 1 Char";
	margin:0in;
	margin-bottom:.0001pt;
	border:none;
	padding:0in;
	font-size:36.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;
	font-weight:normal;}
h1.CxSpMiddle
	{mso-style-link:"Heading 1 Char";
	margin:0in;
	margin-bottom:.0001pt;
	border:none;
	padding:0in;
	font-size:36.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;
	font-weight:normal;}
h1.CxSpLast
	{mso-style-link:"Heading 1 Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:15.0pt;
	margin-left:0in;
	border:none;
	padding:0in;
	font-size:36.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;
	font-weight:normal;}
h2
	{mso-style-link:"Heading 2 Char";
	margin-top:10.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Cambria","serif";
	color:black;}
h3
	{mso-style-link:"Heading 3 Char";
	margin-top:10.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:12.0pt;
	font-family:"Cambria","serif";
	color:#4F81BD;}
p.MsoToc1, li.MsoToc1, div.MsoToc1
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:0in;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoToc2, li.MsoToc2, div.MsoToc2
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:11.0pt;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoToc3, li.MsoToc3, div.MsoToc3
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:22.0pt;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoToc4, li.MsoToc4, div.MsoToc4
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:33.0pt;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoToc5, li.MsoToc5, div.MsoToc5
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:44.0pt;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoToc6, li.MsoToc6, div.MsoToc6
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:55.0pt;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoToc7, li.MsoToc7, div.MsoToc7
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:66.0pt;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoToc8, li.MsoToc8, div.MsoToc8
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:77.0pt;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoToc9, li.MsoToc9, div.MsoToc9
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:88.0pt;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoCommentText, li.MsoCommentText, div.MsoCommentText
	{mso-style-link:"Comment Text Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{mso-style-link:"Header Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{mso-style-link:"Footer Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoCaption, li.MsoCaption, div.MsoCaption
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";
	color:#4F81BD;
	font-weight:bold;}
p.MsoTitle, li.MsoTitle, div.MsoTitle
	{mso-style-link:"Title Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:15.0pt;
	margin-left:0in;
	border:none;
	padding:0in;
	font-size:48.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	color:black;
	letter-spacing:.25pt;}
p.MsoTitleCxSpFirst, li.MsoTitleCxSpFirst, div.MsoTitleCxSpFirst
	{mso-style-link:"Title Char";
	margin:0in;
	margin-bottom:.0001pt;
	border:none;
	padding:0in;
	font-size:48.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	color:black;
	letter-spacing:.25pt;}
p.MsoTitleCxSpMiddle, li.MsoTitleCxSpMiddle, div.MsoTitleCxSpMiddle
	{mso-style-link:"Title Char";
	margin:0in;
	margin-bottom:.0001pt;
	border:none;
	padding:0in;
	font-size:48.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	color:black;
	letter-spacing:.25pt;}
p.MsoTitleCxSpLast, li.MsoTitleCxSpLast, div.MsoTitleCxSpLast
	{mso-style-link:"Title Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:15.0pt;
	margin-left:0in;
	border:none;
	padding:0in;
	font-size:48.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	color:black;
	letter-spacing:.25pt;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;}
p.MsoCommentSubject, li.MsoCommentSubject, div.MsoCommentSubject
	{mso-style-link:"Comment Subject Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";
	font-weight:bold;}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{mso-style-link:"Balloon Text Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Tahoma","sans-serif";}
span.MsoPlaceholderText
	{color:gray;}
p.MsoRMPane, li.MsoRMPane, div.MsoRMPane
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:.5in;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoListParagraphCxSpFirst, li.MsoListParagraphCxSpFirst, div.MsoListParagraphCxSpFirst
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoListParagraphCxSpMiddle, li.MsoListParagraphCxSpMiddle, div.MsoListParagraphCxSpMiddle
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoListParagraphCxSpLast, li.MsoListParagraphCxSpLast, div.MsoListParagraphCxSpLast
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:.5in;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoTocHeading, li.MsoTocHeading, div.MsoTocHeading
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:15.0pt;
	margin-left:0in;
	border:none;
	padding:0in;
	font-size:36.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;}
p.MsoTocHeadingCxSpFirst, li.MsoTocHeadingCxSpFirst, div.MsoTocHeadingCxSpFirst
	{margin:0in;
	margin-bottom:.0001pt;
	border:none;
	padding:0in;
	font-size:36.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;}
p.MsoTocHeadingCxSpMiddle, li.MsoTocHeadingCxSpMiddle, div.MsoTocHeadingCxSpMiddle
	{margin:0in;
	margin-bottom:.0001pt;
	border:none;
	padding:0in;
	font-size:36.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;}
p.MsoTocHeadingCxSpLast, li.MsoTocHeadingCxSpLast, div.MsoTocHeadingCxSpLast
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:15.0pt;
	margin-left:0in;
	border:none;
	padding:0in;
	font-size:36.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;}
span.Heading1Char
	{mso-style-name:"Heading 1 Char";
	mso-style-link:"Heading 1";
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;}
span.Heading2Char
	{mso-style-name:"Heading 2 Char";
	mso-style-link:"Heading 2";
	font-family:"Cambria","serif";
	color:black;
	font-weight:bold;}
span.Heading3Char
	{mso-style-name:"Heading 3 Char";
	mso-style-link:"Heading 3";
	font-family:"Cambria","serif";
	color:#4F81BD;
	font-weight:bold;}
span.TitleChar
	{mso-style-name:"Title Char";
	mso-style-link:Title;
	font-family:"Franklin Gothic Demi","sans-serif";
	color:black;
	letter-spacing:.25pt;}
span.Definition
	{mso-style-name:Definition;
	font-weight:bold;}
span.HeaderChar
	{mso-style-name:"Header Char";
	mso-style-link:Header;
	font-family:"Times New Roman","serif";}
span.FooterChar
	{mso-style-name:"Footer Char";
	mso-style-link:Footer;
	font-family:"Times New Roman","serif";}
span.BalloonTextChar
	{mso-style-name:"Balloon Text Char";
	mso-style-link:"Balloon Text";
	font-family:"Tahoma","sans-serif";}
span.TableHeading
	{mso-style-name:"Table Heading";
	font-weight:bold;}
p.ChapterTitle, li.ChapterTitle, div.ChapterTitle
	{mso-style-name:"Chapter Title";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:15.0pt;
	margin-left:0in;
	border:none;
	padding:0in;
	font-size:36.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;}
p.ChapterTitleCxSpFirst, li.ChapterTitleCxSpFirst, div.ChapterTitleCxSpFirst
	{mso-style-name:"Chapter TitleCxSpFirst";
	margin:0in;
	margin-bottom:.0001pt;
	border:none;
	padding:0in;
	font-size:36.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;}
p.ChapterTitleCxSpMiddle, li.ChapterTitleCxSpMiddle, div.ChapterTitleCxSpMiddle
	{mso-style-name:"Chapter TitleCxSpMiddle";
	margin:0in;
	margin-bottom:.0001pt;
	border:none;
	padding:0in;
	font-size:36.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;}
p.ChapterTitleCxSpLast, li.ChapterTitleCxSpLast, div.ChapterTitleCxSpLast
	{mso-style-name:"Chapter TitleCxSpLast";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:15.0pt;
	margin-left:0in;
	border:none;
	padding:0in;
	font-size:36.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;}
span.URL
	{mso-style-name:URL;
	color:black;
	text-decoration:underline;}
p.SourceCodeFeatured, li.SourceCodeFeatured, div.SourceCodeFeatured
	{mso-style-name:"Source Code \(Featured\)";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0in;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Courier";}
p.SourceCodeFeaturedCxSpFirst, li.SourceCodeFeaturedCxSpFirst, div.SourceCodeFeaturedCxSpFirst
	{mso-style-name:"Source Code \(Featured\)CxSpFirst";
	margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Courier";}
p.SourceCodeFeaturedCxSpMiddle, li.SourceCodeFeaturedCxSpMiddle, div.SourceCodeFeaturedCxSpMiddle
	{mso-style-name:"Source Code \(Featured\)CxSpMiddle";
	margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Courier";}
p.SourceCodeFeaturedCxSpLast, li.SourceCodeFeaturedCxSpLast, div.SourceCodeFeaturedCxSpLast
	{mso-style-name:"Source Code \(Featured\)CxSpLast";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0in;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Courier";}
p.SampleRun, li.SampleRun, div.SampleRun
	{mso-style-name:"Sample Run";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0in;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Courier";
	color:#1F497D;}
p.SampleRunCxSpFirst, li.SampleRunCxSpFirst, div.SampleRunCxSpFirst
	{mso-style-name:"Sample RunCxSpFirst";
	margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Courier";
	color:#1F497D;}
p.SampleRunCxSpMiddle, li.SampleRunCxSpMiddle, div.SampleRunCxSpMiddle
	{mso-style-name:"Sample RunCxSpMiddle";
	margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Courier";
	color:#1F497D;}
p.SampleRunCxSpLast, li.SampleRunCxSpLast, div.SampleRunCxSpLast
	{mso-style-name:"Sample RunCxSpLast";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0in;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Courier";
	color:#1F497D;}
span.SampleRunResponse
	{mso-style-name:"Sample Run Response";
	color:black;}
span.SourceCodeComment
	{mso-style-name:"Source Code Comment";
	color:#7F7F7F;}
span.SourceLineNumber
	{mso-style-name:"Source Line Number";
	color:gray;}
p.CodeExample, li.CodeExample, div.CodeExample
	{mso-style-name:"Code Example";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Courier";}
p.CodeExampleCxSpFirst, li.CodeExampleCxSpFirst, div.CodeExampleCxSpFirst
	{mso-style-name:"Code ExampleCxSpFirst";
	margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Courier";}
p.CodeExampleCxSpMiddle, li.CodeExampleCxSpMiddle, div.CodeExampleCxSpMiddle
	{mso-style-name:"Code ExampleCxSpMiddle";
	margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Courier";}
p.CodeExampleCxSpLast, li.CodeExampleCxSpLast, div.CodeExampleCxSpLast
	{mso-style-name:"Code ExampleCxSpLast";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Courier";}
span.Literal
	{mso-style-name:Literal;
	font-family:Courier;}
p.SourceCodeHeadline, li.SourceCodeHeadline, div.SourceCodeHeadline
	{mso-style-name:"Source Code Headline";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0in;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Calibri","sans-serif";
	font-weight:bold;}
p.SourceCodeHeadlineCxSpFirst, li.SourceCodeHeadlineCxSpFirst, div.SourceCodeHeadlineCxSpFirst
	{mso-style-name:"Source Code HeadlineCxSpFirst";
	margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Calibri","sans-serif";
	font-weight:bold;}
p.SourceCodeHeadlineCxSpMiddle, li.SourceCodeHeadlineCxSpMiddle, div.SourceCodeHeadlineCxSpMiddle
	{mso-style-name:"Source Code HeadlineCxSpMiddle";
	margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Calibri","sans-serif";
	font-weight:bold;}
p.SourceCodeHeadlineCxSpLast, li.SourceCodeHeadlineCxSpLast, div.SourceCodeHeadlineCxSpLast
	{mso-style-name:"Source Code HeadlineCxSpLast";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0in;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Calibri","sans-serif";
	font-weight:bold;}
span.CommentTextChar
	{mso-style-name:"Comment Text Char";
	mso-style-link:"Comment Text";
	font-family:"Times New Roman","serif";}
span.CommentSubjectChar
	{mso-style-name:"Comment Subject Char";
	mso-style-link:"Comment Subject";
	font-family:"Times New Roman","serif";
	font-weight:bold;}
span.XXX
	{mso-style-name:XXX;
	font-family:Courier;
	color:red;}
p.TableListing, li.TableListing, div.TableListing
	{mso-style-name:"Table Listing";
	margin:0in;
	margin-bottom:.0001pt;
	text-align:center;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
span.msoIns
	{mso-style-name:"";
	text-decoration:underline;
	color:teal;}
span.msoDel
	{mso-style-name:"";
	text-decoration:line-through;
	color:red;}
.MsoChpDefault
	{font-family:"Calibri","sans-serif";}
.MsoPapDefault
	{margin-bottom:10.0pt;
	line-height:115%;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>

</head>

<body lang=EN-US link=blue vlink=purple style="background-color: #fffeee;">


<div style="background-color: #eeeddd; float: right; height: 310px; font-family: sans-serif;" id="otherbooks">Other programming books by Al Sweigart:<br>
  <a href="#" onclick="document.getElementById('otherbooks').outerHTML='';" style="vertical-align: top;">X</a>

  <a target="_blank" href="https://www.amazon.com/gp/product/1593275994/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=1593275994&linkCode=as2&tag=playwithpyth-20&linkId=385b77199fa1e9f4fd21652cc57dab33" onclick="javascript: pageTracker._trackPageview('/affiliate_chapters_automate.link');"><img src="/images/cover_automate_thumb.webp" style="height: 200px; border: solid black 1px;" /></a>
  <a target="_blank" href="https://www.amazon.com/gp/product/1503212300?ie=UTF8&amp;tag=playwithpyth-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=1503212300" onclick="javascript: pageTracker._trackPageview('/affiliate_chapters_invent.link');"><img src="/images/cover_invent4th_thumb.webp" style="height: 200px; border: solid black 1px;" /></a>
  <a target="_blank" href="https://www.amazon.com/Making-Games-Python-Pygame-Sweigart/dp/1469901730?ie=UTF8&amp;tag=playwithpyth-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=1469901730" onclick="javascript: pageTracker._trackPageview('/affiliate_chapters_pygame.link');"><img src="/images/cover_makinggames_thumb.webp" style="height: 200px; border: solid black 1px; /"></a>
  <a target="_blank" href="https://www.amazon.com/gp/product/1482614375/ref=as_li_qf_sp_asin_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=1482614375&amp;linkCode=as2&amp;tag=playwithpyth-20" onclick="javascript: pageTracker._trackPageview('/affiliate_chapters_hacking.link');"><img src="/images/cover_crackingcodes_thumb.webp" style="height: 200px; border: solid black 1px;" /></a>
  <a target="_blank" href="https://www.amazon.com/gp/product/1593277628/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=1593277628&linkCode=as2&tag=playwithpyth-20&linkId=0f1bd157c25d2e97db13d6434e5476a8"><img src="/images/cover_scratchprogrammingplayground_thumb.webp" style="height: 200px; border: solid black 1px;" /></a>
  <br />
  <a href="https://www.udemy.com/automate/?couponCode=INVENT_WITH_PYTHON">Use this link to get 80%% off the Automate the Boring Stuff online video course.</a><br />
  <a href="https://www.patreon.com/AlSweigart">Support me on Patreon</a>
</div>




<div class=WordSection1>

<div style='border:none;border-bottom:solid #4F81BD 1.0pt;padding:0in 0in 4.0pt 0in'>

<h1><a name="_Toc316488660"><span style='font-variant:normal !important;
text-transform:uppercase'>Chapter 7 - Tetromino</span></a></h1>

</div>

<p class=MsoNormal align=center style='text-align:center'><img width=286
height=226 id="Picture 31" src="chapter7_files/image001.webp"></p>

<h2><a name="_Toc316488661">How to Play Tetromino</a></h2>

<p class=MsoNormal>Tetromino is a Tetris clone. Differently shaped blocks (each
made up of four boxes) fall from the top of the screen, and the player must
guide them down to form complete rows that have no gaps in them. When a complete
row is formed, the row disappears and each row above it moves down one row. The
player tries to keep forming complete lines until the screen fills up and a new
falling block cannot fit on the screen.</p>

<h2><a name="_Toc316488662">Some Tetromino Nomenclature</a></h2>

<p class=MsoNormal>In this chapter, I have come up with a set of terms for the
different things in the game program.</p>

<p class=MsoListParagraphCxSpFirst style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><strong>Board</strong> – The board is made up of 10 x 20 spaces
that the blocks fall and stack up in.</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><strong>Box</strong> – A box is a single filled-in square space
on the board.</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><strong>Piece</strong> – The things that fall from the top of the
board that the player can rotate and position. Each piece has a shape and is
made up of 4 boxes.</p>

<p class=MsoListParagraphCxSpLast style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><strong>Shape</strong> – The shapes are the different types of
pieces in the game. The names of the shapes are T, S, Z, J, L, I, and O.</p>

<p class=MsoNormal align=center style='text-align:center'><img width=284
height=89 id="Picture 68" src="chapter7_files/image002.webp"></p>

<p class=MsoListParagraphCxSpFirst style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><strong>Template</strong> – A list of shape data structures that
represents all the possible rotations of a shape. These are store in variables
with names like <span class=Literal>S_SHAPE_TEMPLATE</span> or <span
class=Literal>J_SHAPE_TEMPLATE</span>.</p>

<p class=MsoListParagraphCxSpLast style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><strong>Landed</strong> – When a piece has either reached the
bottom of the board or is touching a box on the board, we say that the piece
has landed. At that point, the next piece should start falling.</p>

<h2><a name="_Toc316488663">Source Code to Tetromino</a></h2>

<p class=MsoNormal>This source code can be downloaded from <span class=URL><a href="http://invpy.com/tetromino.py">http://invpy.com/tetromino.py</a></span>.
If you get any error messages, look at the line number that is mentioned in the
error message and check your code for any typos. You can also copy and paste
your code into the web form at <span class=URL><a href="http://invpy.com/diff/tetromino">http://invpy.com/diff/tetromino</a></span>
to see if the differences between your code and the code in the book.</p>

<p class=MsoNormal>You will also need the background music files in the same
folder of as the <em>tetromino.py</em> file. You can download them from here:</p>

<p class=MsoListParagraphCxSpFirst style='text-indent:-.25in'><span class=URL><span
style='font-family:Symbol;text-decoration:none'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span class=URL><a href="http://invpy.com/tetrisb.mid">http://invpy.com/tetrisb.mid</a></span></p>

<p class=MsoListParagraphCxSpLast style='text-indent:-.25in'><span
style='font-family:Symbol;color:black'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span class=URL><a href="http://invpy.com/tetrisc.mid">http://invpy.com/tetrisc.mid</a></span></p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst>  <span class=SourceLineNumber>1. </span><span
class=SourceCodeComment># Tetromino (a Tetris clone)</span></p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>2. </span><span
class=SourceCodeComment># By Al Sweigart al@inventwithpython.com</span></p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>3. </span><span
class=SourceCodeComment># http://inventwithpython.com/pygame</span></p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>4. </span><span
class=SourceCodeComment># Creative Commons BY-NC-SA 3.0 US</span></p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>5. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>6. </span>import
random, time, pygame, sys</p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>7. </span>from
pygame.locals import *</p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>8. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>9. </span>FPS
= 25</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>10. </span>WINDOWWIDTH
= 640</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>11. </span>WINDOWHEIGHT
= 480</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>12. </span>BOXSIZE
= 20</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>13. </span>BOARDWIDTH
= 10</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>14. </span>BOARDHEIGHT
= 20</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>15. </span>BLANK
= '.'</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>16. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber> 17. </span>MOVESIDEWAYSFREQ
= 0.15</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>18. </span>MOVEDOWNFREQ
= 0.1</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>19. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber> 20. </span>XMARGIN
= int((WINDOWWIDTH - BOARDWIDTH * BOXSIZE) / 2)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>21. </span>TOPMARGIN
= WINDOWHEIGHT - (BOARDHEIGHT * BOXSIZE) - 5</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>22. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber> 23. </span><span
class=SourceCodeComment>#               R    G    B</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>24. </span>WHITE
      = (255, 255, 255)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>25. </span>GRAY       
= (185, 185, 185)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>26. </span>BLACK      
= (  0,   0,   0)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>27. </span>RED        
= (155,   0,   0)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>28. </span>LIGHTRED   
= (175,  20,  20)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>29. </span>GREEN      
= (  0, 155,   0)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>30. </span>LIGHTGREEN 
= ( 20, 175,  20)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>31. </span>BLUE       
= (  0,   0, 155)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>32. </span>LIGHTBLUE  
= ( 20,  20, 175)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>33. </span>YELLOW     
= (155, 155,   0)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>34. </span>LIGHTYELLOW
= (175, 175,  20)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber> 35. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>36. </span>BORDERCOLOR
= BLUE</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>37. </span>BGCOLOR
= BLACK</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>38. </span>TEXTCOLOR
= WHITE</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>39. </span>TEXTSHADOWCOLOR
= GRAY</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>40. </span>COLORS     
= (     BLUE,      GREEN,      RED,      YELLOW)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>41. </span>LIGHTCOLORS
= (LIGHTBLUE, LIGHTGREEN, LIGHTRED, LIGHTYELLOW)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>42. </span>assert
len(COLORS) == len(LIGHTCOLORS) <span class=SourceCodeComment># each color must
have light color</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber> 43. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber> 44. </span>TEMPLATEWIDTH
= 5</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>45. </span>TEMPLATEHEIGHT
= 5</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>46. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>47. </span>S_SHAPE_TEMPLATE
= [['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>48. </span>                     '.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>49. </span>                     '..OO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>50. </span>                     '.OO..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>51. </span>                     '.....'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>52. </span>                    ['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>53. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>54. </span>                     '..OO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>55. </span>                     '...O.',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>56. </span>                     '.....']]</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>57. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>58. </span>Z_SHAPE_TEMPLATE
= [['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>59. </span>                     '.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>60. </span>                     '.OO..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>61. </span>                     '..OO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>62. </span>                     '.....'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>63. </span>                    ['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>64. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>65. </span>                     '.OO..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>66. </span>                     '.O...',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>67. </span>                     '.....']]</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>68. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>69. </span>I_SHAPE_TEMPLATE
= [['..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>70. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>71. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>72. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>73. </span>                     '.....'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>74. </span>                    ['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>75. </span>                     '.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>76. </span>                     'OOOO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>77. </span>                     '.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>78. </span>                     '.....']]</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>79. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>80. </span>O_SHAPE_TEMPLATE
= [['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>81. </span>                     '.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>82. </span>                     '.OO..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>83. </span>                     '.OO..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>84. </span>                     '.....']]</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>85. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>86. </span>J_SHAPE_TEMPLATE
= [['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>87. </span>                     '.O...',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>88. </span>                     '.OOO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>89. </span>                     '.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>90. </span>                     '.....'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>91. </span>                    ['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>92. </span>                     '..OO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>93. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>94. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>95. </span>                     '.....'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>96. </span>                    ['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>97. </span>                     '.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>98. </span>                     '.OOO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>99. </span>                     '...O.',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>100. </span>                     '.....'],</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>101. </span>                    ['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>102. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>103. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>104. </span>                     '.OO..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>105. </span>                     '.....']]</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>106. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>107. </span>L_SHAPE_TEMPLATE
= [['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>108. </span>                     '...O.',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>109. </span>                     '.OOO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>110. </span>                     '.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>111. </span>                     '.....'],</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>112. </span>                    ['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>113. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>114. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>115. </span>                     '..OO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>116. </span>                     '.....'],</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>117. </span>                    ['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>118. </span>                     '.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>119. </span>                     '.OOO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>120. </span>                     '.O...',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>121. </span>                     '.....'],</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>122. </span>                    ['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>123. </span>                     '.OO..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>124. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>125. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>126. </span>                     '.....']]</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>127. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>128. </span>T_SHAPE_TEMPLATE
= [['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>129. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>130. </span>                     '.OOO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>131. </span>                     '.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>132. </span>                     '.....'],</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>133. </span>                    ['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>134. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>135. </span>                     '..OO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>136. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>137. </span>                     '.....'],</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>138. </span>                    ['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>139. </span>                     '.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>140. </span>                     '.OOO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>141. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>142. </span>                     '.....'],</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>143. </span>                    ['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>144. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>145. </span>                     '.OO..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>146. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>147. </span>                     '.....']]</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>148. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>149. </span>SHAPES
= {'S': S_SHAPE_TEMPLATE,</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>150. </span>          'Z':
Z_SHAPE_TEMPLATE,</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>151. </span>          'J':
J_SHAPE_TEMPLATE,</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>152. </span>          'L':
L_SHAPE_TEMPLATE,</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>153. </span>          'I':
I_SHAPE_TEMPLATE,</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>154. </span>          'O':
O_SHAPE_TEMPLATE,</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>155. </span>          'T':
T_SHAPE_TEMPLATE}</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>156. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>157.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>158. </span>def
main():</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>159. </span>    global
FPSCLOCK, DISPLAYSURF, BASICFONT, BIGFONT</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>160. </span>    pygame.init()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>161. </span>    FPSCLOCK
= pygame.time.Clock()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>162. </span>    DISPLAYSURF
= pygame.display.set_mode((WINDOWWIDTH, WINDOWHEIGHT))</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>163. </span>    BASICFONT
= pygame.font.Font('freesansbold.ttf', 18)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>164. </span>    BIGFONT
= pygame.font.Font('freesansbold.ttf', 100)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>165. </span>    pygame.display.set_caption('Tetromino')</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>166. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>167. </span>    showTextScreen('Tetromino')</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>168. </span>    while
True: <span class=SourceCodeComment># game loop</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>169. </span>        if
random.randint(0, 1) == 0:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>170. </span>            pygame.mixer.music.load('tetrisb.mid')</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>171. </span>        else:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>172. </span>            pygame.mixer.music.load('tetrisc.mid')</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>173. </span>        pygame.mixer.music.play(-1,
0.0)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>174. </span>        runGame()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>175. </span>        pygame.mixer.music.stop()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>176. </span>        showTextScreen('Game
Over')</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>177. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>178. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>179. </span>def
runGame():</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>180. </span>    <span
class=SourceCodeComment># setup variables for the start of the game</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>181. </span>    board
= getBlankBoard()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>182. </span>    lastMoveDownTime
= time.time()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>183. </span>    lastMoveSidewaysTime
= time.time()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>184. </span>    lastFallTime
= time.time()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>185. </span>    movingDown
= False <span class=SourceCodeComment># note: there is no movingUp variable</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>186. </span>    movingLeft
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>187. </span>    movingRight
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>188. </span>    score
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>189. </span>    level,
fallFreq = calculateLevelAndFallFreq(score)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>190. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>191. </span>    fallingPiece
= getNewPiece()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>192. </span>    nextPiece
= getNewPiece()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>193. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>194. </span>    while
True: <span class=SourceCodeComment># main game loop</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>195. </span>        if
fallingPiece == None:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>196. </span>            <span
class=SourceCodeComment># No falling piece in play, so start a new piece at the
top</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>197. </span>            fallingPiece
= nextPiece</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>198. </span>            nextPiece
= getNewPiece()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>199. </span>            lastFallTime
= time.time() <span class=SourceCodeComment># reset lastFallTime</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>200. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>201. </span>            if
not isValidPosition(board, fallingPiece):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>202. </span>                return
<span class=SourceCodeComment># can't fit a new piece on the board, so game
over</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>203. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>204. </span>        checkForQuit()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>205. </span>        for
event in pygame.event.get(): <span class=SourceCodeComment># event handling
loop</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>206. </span>            if
event.type == KEYUP:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>207. </span>                if
(event.key == K_p):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>208. </span>                    <span
class=SourceCodeComment># Pausing the game</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>209. </span>                    DISPLAYSURF.fill(BGCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>210. </span>                    pygame.mixer.music.stop()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>211. </span>                    showTextScreen('Paused')
<span class=SourceCodeComment># pause until a key press</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>212. </span>                    pygame.mixer.music.play(-1,
0.0)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>213. </span>                    lastFallTime
= time.time()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>214. </span>                    lastMoveDownTime
= time.time()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>215. </span>                    lastMoveSidewaysTime
= time.time()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>216. </span>                elif
(event.key == K_LEFT or event.key == K_a):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>217. </span>                    movingLeft
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>218. </span>                elif
(event.key == K_RIGHT or event.key == K_d):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>219. </span>                    movingRight
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>220. </span>                elif
(event.key == K_DOWN or event.key == K_s):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>221. </span>                    movingDown
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>222. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>223. </span>            elif
event.type == KEYDOWN:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>224. </span>                <span
class=SourceCodeComment># moving the block sideways</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>225. </span>                if
(event.key == K_LEFT or event.key == K_a) and isValidPosition(board,
fallingPiece, adjX=-1):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>226. </span>                    fallingPiece['x']
-= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>227. </span>                    movingLeft
= True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>228. </span>                    movingRight
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>229. </span>                    lastMoveSidewaysTime
= time.time()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>230.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>231. </span>                elif
(event.key == K_RIGHT or event.key == K_d) and isValidPosition(board,
fallingPiece, adjX=1):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>232. </span>                    fallingPiece['x']
+= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>233. </span>                    movingRight
= True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>234. </span>                    movingLeft
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>235. </span>                    lastMoveSidewaysTime
= time.time()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>236. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>237. </span>                <span
class=SourceCodeComment># rotating the block (if there is room to rotate)</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>238. </span>                elif
(event.key == K_UP or event.key == K_w):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>239. </span>                    fallingPiece['rotation']
= (fallingPiece['rotation'] + 1) % len(SHAPES[fallingPiece['shape']])</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>240. </span>                    if
not isValidPosition(board, fallingPiece):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>241. </span>                        fallingPiece['rotation']
= (fallingPiece['rotation'] - 1) % len(SHAPES[fallingPiece['shape']])</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>242. </span>                elif
(event.key == K_q): <span class=SourceCodeComment># rotate the other direction</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>243. </span>                    fallingPiece['rotation']
= (fallingPiece['rotation'] - 1) % len(SHAPES[fallingPiece['shape']])</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>244. </span>                    if
not isValidPosition(board, fallingPiece):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>245. </span>                        fallingPiece['rotation']
= (fallingPiece['rotation'] + 1) % len(SHAPES[fallingPiece['shape']])</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>246. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>247. </span>                <span
class=SourceCodeComment># making the block fall faster with the down key</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>248. </span>                elif
(event.key == K_DOWN or event.key == K_s):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>249. </span>                    movingDown
= True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>250. </span>                    if
isValidPosition(board, fallingPiece, adjY=1):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>251. </span>                        fallingPiece['y']
+= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>252. </span>                    lastMoveDownTime
= time.time()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>253. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>254. </span>                <span
class=SourceCodeComment># move the current block all the way down</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>255. </span>                elif
event.key == K_SPACE:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>256. </span>                    movingDown
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>257. </span>                    movingLeft
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>258. </span>                    movingRight
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>259. </span>                    for
i in range(1, BOARDHEIGHT):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>260. </span>                        if
not isValidPosition(board, fallingPiece, adjY=i):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>261. </span>                            break</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>262. </span>                    fallingPiece['y']
+= i - 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>263. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>264. </span>        <span
class=SourceCodeComment># handle moving the block because of user input</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>265. </span>        if
(movingLeft or movingRight) and time.time() - lastMoveSidewaysTime &gt; MOVESIDEWAYSFREQ:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>266. </span>            if
movingLeft and isValidPosition(board, fallingPiece, adjX=-1):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>267. </span>                fallingPiece['x']
-= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>268. </span>            elif
movingRight and isValidPosition(board, fallingPiece, adjX=1):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>269. </span>                fallingPiece['x']
+= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>270. </span>            lastMoveSidewaysTime
= time.time()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>271. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>272. </span>        if
movingDown and time.time() - lastMoveDownTime &gt; MOVEDOWNFREQ and
isValidPosition(board, fallingPiece, adjY=1):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>273. </span>            fallingPiece['y']
+= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>274. </span>            lastMoveDownTime
= time.time()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>275. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>276. </span>        <span
class=SourceCodeComment># let the piece fall if it is time to fall</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>277. </span>        if
time.time() - lastFallTime &gt; fallFreq:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>278. </span>            <span
class=SourceCodeComment># see if the piece has landed</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>279. </span>            if
not isValidPosition(board, fallingPiece, adjY=1):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>280. </span>                <span
class=SourceCodeComment># falling piece has landed, set it on the board</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>281. </span>                addToBoard(board,
fallingPiece)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>282. </span>                score
+= removeCompleteLines(board)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>283. </span>                level,
fallFreq = calculateLevelAndFallFreq(score)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>284. </span>                fallingPiece
= None</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>285. </span>            else:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>286. </span>                <span
class=SourceCodeComment># piece did not land, just move the block down</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>287. </span>                fallingPiece['y']
+= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>288. </span>                lastFallTime
= time.time()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>289. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>290. </span>        <span
class=SourceCodeComment># drawing everything on the screen</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>291. </span>        DISPLAYSURF.fill(BGCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>292. </span>        drawBoard(board)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>293. </span>        drawStatus(score,
level)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>294. </span>        drawNextPiece(nextPiece)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>295. </span>        if
fallingPiece != None:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>296. </span>            drawPiece(fallingPiece)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>297. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>298. </span>        pygame.display.update()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>299. </span>        FPSCLOCK.tick(FPS)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>300. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>301. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>302. </span>def
makeTextObjs(text, font, color):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>303. </span>    surf
= font.render(text, True, color)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>304. </span>    return
surf, surf.get_rect()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>305. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>306. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>307. </span>def
terminate():</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>308. </span>    pygame.quit()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>309. </span>    sys.exit()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>310. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>311. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>312. </span>def
checkForKeyPress():</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>313. </span>    <span
class=SourceCodeComment># Go through event queue looking for a KEYUP event.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>314. </span>    <span
class=SourceCodeComment># Grab KEYDOWN events to remove them from the event
queue.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>315. </span>    checkForQuit()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>316.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>317. </span>    for
event in pygame.event.get([KEYDOWN, KEYUP]):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>318. </span>        if
event.type == KEYDOWN:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>319. </span>            continue</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>320. </span>        return
event.key</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>321. </span>    return
None</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>322. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>323. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>324. </span>def
showTextScreen(text):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>325. </span>    <span
class=SourceCodeComment># This function displays large text in the</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>326. </span>    <span
class=SourceCodeComment># center of the screen until a key is pressed.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>327. </span>    <span
class=SourceCodeComment># Draw the text drop shadow</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>328. </span>    titleSurf,
titleRect = makeTextObjs(text, BIGFONT, TEXTSHADOWCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>329. </span>    titleRect.center
= (int(WINDOWWIDTH / 2), int(WINDOWHEIGHT / 2))</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>330. </span>    DISPLAYSURF.blit(titleSurf,
titleRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>331. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>332. </span>    <span
class=SourceCodeComment># Draw the text</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>333. </span>    titleSurf,
titleRect = makeTextObjs(text, BIGFONT, TEXTCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>334. </span>    titleRect.center
= (int(WINDOWWIDTH / 2) - 3, int(WINDOWHEIGHT / 2) - 3)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>335. </span>    DISPLAYSURF.blit(titleSurf,
titleRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>336. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>337. </span>    <span
class=SourceCodeComment># Draw the additional &quot;Press a key to play.&quot;
text.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>338. </span>    pressKeySurf,
pressKeyRect = makeTextObjs('Press a key to play.', BASICFONT, TEXTCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>339. </span>    pressKeyRect.center
= (int(WINDOWWIDTH / 2), int(WINDOWHEIGHT / 2) + 100)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>340. </span>    DISPLAYSURF.blit(pressKeySurf,
pressKeyRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>341. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>342. </span>    while
checkForKeyPress() == None:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>343. </span>        pygame.display.update()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>344. </span>        FPSCLOCK.tick()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>345. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>346. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>347. </span>def
checkForQuit():</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>348. </span>    for
event in pygame.event.get(QUIT): <span class=SourceCodeComment># get all the QUIT
events</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>349. </span>        terminate()
<span class=SourceCodeComment># terminate if any QUIT events are present</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>350. </span>    for
event in pygame.event.get(KEYUP): <span class=SourceCodeComment># get all the
KEYUP events</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>351. </span>        if
event.key == K_ESCAPE:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>352. </span>            terminate()
<span class=SourceCodeComment># terminate if the KEYUP event was for the Esc
key</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>353. </span>        pygame.event.post(event)
<span class=SourceCodeComment># put the other KEYUP event objects back</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>354. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>355.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>356. </span>def
calculateLevelAndFallFreq(score):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>357. </span>    <span
class=SourceCodeComment># Based on the score, return the level the player is on
and</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>358. </span>    <span
class=SourceCodeComment># how many seconds pass until a falling piece falls one
space.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>359. </span>    level
= int(score / 10) + 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>360. </span>    fallFreq
= 0.27 - (level * 0.02)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>361.     </span>return
level, fallFreq</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>362. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>363. </span>def
getNewPiece():</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>364. </span>    <span
class=SourceCodeComment># return a random new piece in a random rotation and
color</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>365. </span>    shape
= random.choice(list(SHAPES.keys()))</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>366. </span>    newPiece
= {'shape': shape,</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>367. </span>                'rotation':
random.randint(0, len(SHAPES[shape]) - 1),</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>368. </span>                'x':
int(BOARDWIDTH / 2) - int(TEMPLATEWIDTH / 2),</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>369. </span>                'y':
-2, <span class=SourceCodeComment># start it above the board (i.e. less than 0)</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>370. </span>                'color':
random.randint(0, len(COLORS)-1)}</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>371. </span>    return
newPiece</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>372. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>373. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>374. </span>def
addToBoard(board, piece):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>375. </span>    <span
class=SourceCodeComment># fill in the board based on piece's location, shape,
and rotation</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>376. </span>    for
x in range(TEMPLATEWIDTH):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>377. </span>        for
y in range(TEMPLATEHEIGHT):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>378. </span>            if
SHAPES[piece['shape']][piece['rotation']][y][x] != BLANK:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>379. </span>                board[x
+ piece['x']][y + piece['y']] = piece['color']</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>380. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>381. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>382. </span>def
getBlankBoard():</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>383. </span>    <span
class=SourceCodeComment># create and return a new blank board data structure</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>384. </span>    board
= []</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>385. </span>    for
i in range(BOARDWIDTH):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>386. </span>        board.append([BLANK]
* BOARDHEIGHT)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>387. </span>    return
board</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>388. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>389. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>390. </span>def
isOnBoard(x, y):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>391. </span>    return
x &gt;= 0 and x &lt; BOARDWIDTH and y &lt; BOARDHEIGHT</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>392. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>393. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>394. </span>def
isValidPosition(board, piece, adjX=0, adjY=0):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>395. </span>    <span
class=SourceCodeComment># Return True if the piece is within the board and not
colliding</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>396. </span>    for
x in range(TEMPLATEWIDTH):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>397. </span>        for
y in range(TEMPLATEHEIGHT):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>398.</span>            
isAboveBoard = y + piece['y'] + adjY &lt; 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>399. </span>            if
isAboveBoard or SHAPES[piece['shape']][piece['rotation']][y][x] == BLANK:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>400. </span>                continue</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>401. </span>            if
not isOnBoard(x + piece['x'] + adjX, y + piece['y'] + adjY):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>402. </span>                return
False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>403. </span>            if
board[x + piece['x'] + adjX][y + piece['y'] + adjY] != BLANK:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>404. </span>                return
False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>405. </span>    return
True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>406. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>407. </span>def
isCompleteLine(board, y):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>408. </span>    <span
class=SourceCodeComment># Return True if the line filled with boxes with no
gaps.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>409. </span>    for
x in range(BOARDWIDTH):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>410. </span>        if
board[x][y] == BLANK:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>411. </span>            return
False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>412. </span>    return
True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>413. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>414. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>415. </span>def
removeCompleteLines(board):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>416. </span>    <span
class=SourceCodeComment># Remove any completed lines on the board, move
everything above them down, and return the number of complete lines.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>417. </span>    numLinesRemoved
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>418. </span>    y
= BOARDHEIGHT - 1 <span class=SourceCodeComment># start y at the bottom of the
board</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>419. </span>    while
y &gt;= 0:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>420. </span>        if
isCompleteLine(board, y):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>421. </span>            <span
class=SourceCodeComment># Remove the line and pull boxes down by one line.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>422. </span>            for
pullDownY in range(y, 0, -1):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>423. </span>                for
x in range(BOARDWIDTH):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>424. </span>                    board[x][pullDownY]
= board[x][pullDownY-1]</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>425. </span>            <span
class=SourceCodeComment># Set very top line to blank.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>426. </span>            for
x in range(BOARDWIDTH):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>427. </span>                board[x][0]
= BLANK</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>428. </span>            numLinesRemoved
+= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>429. </span>            <span
class=SourceCodeComment># Note on the next iteration of the loop, y is the
same.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>430. </span>            <span
class=SourceCodeComment># This is so that if the line that was pulled down is
also</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>431. </span>            <span
class=SourceCodeComment># complete, it will be removed.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>432. </span>        else:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>433. </span>            y
-= 1 <span class=SourceCodeComment># move on to check next row up</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>434. </span>    return
numLinesRemoved</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>435. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>436. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>437. </span>def
convertToPixelCoords(boxx, boxy):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>438. </span>    <span
class=SourceCodeComment># Convert the given xy coordinates of the board to xy </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>439. </span>    <span
class=SourceCodeComment># coordinates of the</span> <span
class=SourceCodeComment>location on the screen.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>440. </span>    return
(XMARGIN + (boxx * BOXSIZE)), (TOPMARGIN + (boxy * BOXSIZE))</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>441. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>442. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>443. </span>def
drawBox(boxx, boxy, color, pixelx=None, pixely=None):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>444. </span>    <span
class=SourceCodeComment># draw a single box (each tetromino piece has four
boxes)</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>445. </span>    <span
class=SourceCodeComment># at xy coordinates on the board. Or, if pixelx &amp;
pixely</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>446. </span>    <span
class=SourceCodeComment># are specified, draw to the pixel coordinates stored
in</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>447. </span>    <span
class=SourceCodeComment># pixelx &amp; pixely (this is used for the
&quot;Next&quot; piece).</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>448. </span>    if
color == BLANK:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>449. </span>        return</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>450. </span>    if
pixelx == None and pixely == None:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>451. </span>        pixelx,
pixely = convertToPixelCoords(boxx, boxy)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>452. </span>    pygame.draw.rect(DISPLAYSURF,
COLORS[color], (pixelx + 1, pixely + 1, BOXSIZE - 1, BOXSIZE - 1))</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>453. </span>    pygame.draw.rect(DISPLAYSURF,
LIGHTCOLORS[color], (pixelx + 1, pixely + 1, BOXSIZE - 4, BOXSIZE - 4))</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>454. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>455. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>456. </span>def
drawBoard(board):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>457. </span>    <span
class=SourceCodeComment># draw the border around the board</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>458. </span>    pygame.draw.rect(DISPLAYSURF,
BORDERCOLOR, (XMARGIN - 3, TOPMARGIN - 7, (BOARDWIDTH * BOXSIZE) + 8,
(BOARDHEIGHT * BOXSIZE) + 8), 5)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>459. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>460. </span>    <span
class=SourceCodeComment># fill the background of the board</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>461. </span>    pygame.draw.rect(DISPLAYSURF,
BGCOLOR, (XMARGIN, TOPMARGIN, BOXSIZE * BOARDWIDTH, BOXSIZE * BOARDHEIGHT))</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>462. </span>    <span
class=SourceCodeComment># draw the individual boxes on the board</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>463. </span>    for
x in range(BOARDWIDTH):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>464. </span>        for
y in range(BOARDHEIGHT):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>465. </span>            drawBox(x,
y, board[x][y])</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>466. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>467. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>468. </span>def
drawStatus(score, level):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>469. </span>    <span
class=SourceCodeComment># draw the score text</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>470. </span>    scoreSurf
= BASICFONT.render('Score: %s' % score, True, TEXTCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>471. </span>    scoreRect
= scoreSurf.get_rect()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>472. </span>    scoreRect.topleft
= (WINDOWWIDTH - 150, 20)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>473. </span>    DISPLAYSURF.blit(scoreSurf,
scoreRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>474. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>475. </span>    <span
class=SourceCodeComment># draw the level text</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>476. </span>    levelSurf
= BASICFONT.render('Level: %s' % level, True, TEXTCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>477. </span>    levelRect
= levelSurf.get_rect()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>478. </span>    levelRect.topleft
= (WINDOWWIDTH - 150, 50)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>479. </span>    DISPLAYSURF.blit(levelSurf,
levelRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>480. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>481. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>482. </span>def
drawPiece(piece, pixelx=None, pixely=None):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>483. </span>    shapeToDraw
= SHAPES[piece['shape']][piece['rotation']]</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>484. </span>    if
pixelx == None and pixely == None:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>485. </span>        <span
class=SourceCodeComment># if pixelx &amp; pixely hasn't been specified, use the
location stored in the piece data structure</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>486. </span>        pixelx,
pixely = convertToPixelCoords(piece['x'], piece['y'])</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>487. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>488. </span>    <span
class=SourceCodeComment># draw each of the blocks that make up the piece</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>489. </span>    for
x in range(TEMPLATEWIDTH):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>490. </span>        for
y in range(TEMPLATEHEIGHT):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>491. </span>            if
shapeToDraw[y][x] != BLANK:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>492. </span>                drawBox(None,
None, piece['color'], pixelx + (x * BOXSIZE), pixely + (y * BOXSIZE))</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>493.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>494.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>495. </span>def
drawNextPiece(piece):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>496. </span>    <span
class=SourceCodeComment># draw the &quot;next&quot; text</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>497. </span>    nextSurf
= BASICFONT.render('Next:', True, TEXTCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>498. </span>    nextRect
= nextSurf.get_rect()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>499. </span>    nextRect.topleft
= (WINDOWWIDTH - 120, 80)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>500. </span>    DISPLAYSURF.blit(nextSurf,
nextRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>501. </span>    <span
class=SourceCodeComment># draw the &quot;next&quot; piece</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>502. </span>    drawPiece(piece,
pixelx=WINDOWWIDTH-120, pixely=100)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>503. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>504. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>505. </span>if
__name__ == '__main__':</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>506. </span>    main()</p>

</div>

<h2><a name="_Toc316488664">The Usual Setup Code</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst>  <span class=SourceLineNumber>1. </span><span
class=SourceCodeComment># Tetromino (a Tetris clone)</span></p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>2. </span><span
class=SourceCodeComment># By Al Sweigart al@inventwithpython.com</span></p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>3. </span><span
class=SourceCodeComment># http://inventwithpython.com/pygame</span></p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>4. </span><span
class=SourceCodeComment># Creative Commons BY-NC-SA 3.0 US</span></p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>5. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>6. </span>import
random, time, pygame, sys</p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>7. </span>from
pygame.locals import *</p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>8. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>9. </span>FPS
= 25</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>10. </span>WINDOWWIDTH
= 640</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>11. </span>WINDOWHEIGHT
= 480</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>12. </span>BOXSIZE
= 20</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>13. </span>BOARDWIDTH
= 10</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>14. </span>BOARDHEIGHT
= 20</p>

<p class=SourceCodeFeaturedCxSpLast> <span class=SourceLineNumber>15. </span>BLANK
= '.'</p>

</div>

<p class=MsoNormal>These are the constants used by our Tetromino game. Each box
is a square that is 20 pixels wide and high. The board itself is 10 boxes wide
and 20 boxes tall. The <span class=Literal>BLANK</span> constant will be used
as a value to represent blank spaces in the board’s data structure.</p>

<h2><a name="_Toc316488665">Setting up Timing Constants for Holding Down Keys</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst> <span class=SourceLineNumber>17. </span>MOVESIDEWAYSFREQ
= 0.15</p>

<p class=SourceCodeFeaturedCxSpLast> <span class=SourceLineNumber>18. </span>MOVEDOWNFREQ
= 0.1</p>

</div>

<p class=MsoNormal>Every time the player pushes the left or right arrow key
down, the falling piece should move one box over to the left or right,
respectively. However, the player can also hold down the left or right arrow
key to keep moving the falling piece. The <span class=Literal>MOVESIDEWAYSFREQ</span>
constant will set it so that every 0.15 seconds that passes with the left or
right arrow key held down, the piece will move another space over.</p>

<p class=MsoNormal>The <span class=Literal>MOVEDOWNFREQ</span> constant is the
same thing except it tells how frequently the piece drops by one box while the
player has the down arrow key held down.</p>

<h2><a name="_Toc316488666">More Setup Code</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst> <span class=SourceLineNumber>20. </span>XMARGIN
= int((WINDOWWIDTH - BOARDWIDTH * BOXSIZE) / 2)</p>

<p class=SourceCodeFeaturedCxSpLast> <span class=SourceLineNumber>21. </span>TOPMARGIN
= WINDOWHEIGHT - (BOARDHEIGHT * BOXSIZE) - 5</p>

</div>

<p class=MsoNormal>The program needs to calculate how many pixels are to the left
and right side of the board to use later in the program. <span class=Literal>WINDOWWIDTH</span>
is the total number of pixels wide the entire window is. The board is <span
class=Literal>BOARDWIDTH</span> boxes wide and each box is <span class=Literal>BOXSIZE</span>
pixels wide. If we subtract <span class=Literal>BOXSIZE</span> pixels from this
for each of the boxes wide in the board (which is <span class=Literal>BOARDWIDTH
* BOXSIZE</span>), we’ll have the size of the margin to the left and right of
the board. If we divide this by <span class=Literal>2</span>, then we will have
the size of just one margin. Since the margins are the same size, we can use <span
class=Literal>XMARGIN</span> for either the left-side or right-side margin.</p>

<p class=MsoNormal>We can calculate the size of the space between the top of
the board and the top of the window in a similar manner. The board will be
drawn 5 pixels above the bottom of the window, so <span class=Literal>5</span>
is subtracted from <span class=Literal>topmargin</span> to account for this.</p>

<p class=MsoNormal align=center style='text-align:center'><img width=331
height=271 id="Picture 57" src="chapter7_files/image003.webp"></p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst> <span class=SourceLineNumber>23. </span><span
class=SourceCodeComment>#               R    G    B</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>24. </span>WHITE      
= (255, 255, 255)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>25. </span>GRAY       
= (185, 185, 185)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>26. </span>BLACK      
= (  0,   0,   0)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>27. </span>RED        
= (155,   0,   0)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>28. </span>LIGHTRED   
= (175,  20,  20)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>29. </span>GREEN      
= (  0, 155,   0)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>30. </span>LIGHTGREEN 
= ( 20, 175,  20)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>31. </span>BLUE       
= (  0,   0, 155)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>32. </span>LIGHTBLUE  
= ( 20,  20, 175)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>33. </span>YELLOW     
= (155, 155,   0)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>34. </span>LIGHTYELLOW
= (175, 175,  20)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber> 35. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>36. </span>BORDERCOLOR
= BLUE</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>37. </span>BGCOLOR
= BLACK</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>38. </span>TEXTCOLOR
= WHITE</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>39. </span>TEXTSHADOWCOLOR
= GRAY</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>40. </span>COLORS     
= (     BLUE,      GREEN,      RED,      YELLOW)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>41. </span>LIGHTCOLORS
= (LIGHTBLUE, LIGHTGREEN, LIGHTRED, LIGHTYELLOW)</p>

<p class=SourceCodeFeaturedCxSpLast> <span class=SourceLineNumber>42. </span>assert
len(COLORS) == len(LIGHTCOLORS) <span class=SourceCodeComment># each color must
have light color</span></p>

</div>

<p class=MsoNormal>The pieces will come in four colors: blue, green, red, and
yellow. When we draw the boxes though, there will be a thin highlight on the
box in a lighter color. So this means we need to create light blue, light
green, light red, and light yellow colors as well.</p>

<p class=MsoNormal>Each of these four colors will be stored in tuples named <span
class=Literal>COLORS</span> (for the normal colors) and <span class=Literal>LIGHTCOLORS</span>
(for the lighter colors).</p>

<h2><a name="_Toc316488667">Setting Up the Piece Templates</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst> <span class=SourceLineNumber>44. </span>TEMPLATEWIDTH
= 5</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>45. </span>TEMPLATEHEIGHT
= 5</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>46. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>47. </span>S_SHAPE_TEMPLATE
= [['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>48. </span>                     '.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>49. </span>                     '..OO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>50. </span>                     '.OO..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>51. </span>                     '.....'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>52. </span>                    ['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>53. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>54. </span>                     '..OO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>55. </span>                     '...O.',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>56. </span>                     '.....']]</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>57. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>58. </span>Z_SHAPE_TEMPLATE
= [['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>59. </span>                     '.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>60. </span>                     '.OO..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>61. </span>                     '..OO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>62. </span>                     '.....'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>63. </span>                    ['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>64. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>65. </span>                     '.OO..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>66. </span>                     '.O...',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>67. </span>                     '.....']]</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>68. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>69. </span>I_SHAPE_TEMPLATE
= [['..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>70. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>71. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>72. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>73. </span>                     '.....'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>74. </span>                    ['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>75. </span>                     '.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>76. </span>                     'OOOO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>77. </span>                     '.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>78. </span>                     '.....']]</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>79. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>80. </span>O_SHAPE_TEMPLATE
= [['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>81. </span>                     '.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>82. </span>                     '.OO..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>83. </span>                     '.OO..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>84. </span>                     '.....']]</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>85. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>86. </span>J_SHAPE_TEMPLATE
= [['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>87. </span>                     '.O...',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>88. </span>                     '.OOO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>89. </span>                     '.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>90. </span>                     '.....'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>91. </span>                    ['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>92. </span>                     '..OO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>93. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>94. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>95. </span>                     '.....'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>96. </span>                    ['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>97. </span>                     '.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>98. </span>                     '.OOO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>99. </span>                     '...O.',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>100. </span>                     '.....'],</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>101. </span>                    ['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>102. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>103. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>104. </span>                     '.OO..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>105. </span>                     '.....']]</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>106. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>107. </span>L_SHAPE_TEMPLATE
= [['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>108. </span>                     '...O.',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>109. </span>                     '.OOO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>110. </span>                     '.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>111. </span>                     '.....'],</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>112. </span>                    ['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>113. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>114. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>115. </span>                     '..OO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>116. </span>                     '.....'],</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>117. </span>                    ['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>118. </span>                     '.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>119. </span>                     '.OOO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>120. </span>                     '.O...',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>121. </span>                     '.....'],</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>122. </span>                    ['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>123. </span>                     '.OO..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>124. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>125. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>126. </span>                     '.....']]</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>127. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>128. </span>T_SHAPE_TEMPLATE
= [['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>129. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>130. </span>                     '.OOO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>131. </span>                     '.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>132. </span>                     '.....'],</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>133. </span>                    ['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>134. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>135. </span>                     '..OO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>136. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>137. </span>                     '.....'],</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>138. </span>                    ['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>139. </span>                     '.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>140. </span>                     '.OOO.',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>141. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>142. </span>                     '.....'],</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>143. </span>                    ['.....',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>144. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>145. </span>                     '.OO..',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>146. </span>                     '..O..',</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>147. </span>                     '.....']]</p>

</div>

<p class=MsoNormal>Our game program needs to know how each of the shapes are
shaped, including for all of their possible rotations. In order to do this, we
will create lists of lists of strings. The inner list of strings will represent
a single rotation of a shape, like this:</p>

<div style='border:solid windowtext 1.0pt;padding:4.0pt 4.0pt 4.0pt 4.0pt'>

<p class=CodeExampleCxSpFirst style='border:none;padding:0in'>['.....',</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'> '.....',</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'> '..OO.',</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'> '.OO..',</p>

<p class=CodeExampleCxSpLast style='border:none;padding:0in'> '.....']</p>

</div>

<p class=MsoNormal>We will write the rest of our code so that it interprets a
list of strings like the one above to represent a shape where the periods are
empty spaces and the O’s are boxes, like this:</p>

<p class=MsoNormal align=center style='text-align:center'><img width=95
height=77 id="Picture 23" src="chapter7_files/image004.webp"></p>

<h2><a name="_Toc316488668">Splitting a “Line of Code” Across Multiple Lines</a></h2>

<p class=MsoNormal>You can see that this list is spread across many lines in
the file editor. This is perfectly valid Python, because the Python interpreter
realizes that until it sees the <span class=Literal>]</span> closing square
bracket, the list isn’t finished. The indentation doesn’t matter because Python
knows you won’t have different indentation for a new block in the middle of a
list. This code below works just fine:</p>

<div style='border:solid windowtext 1.0pt;padding:4.0pt 4.0pt 4.0pt 4.0pt'>

<p class=CodeExampleCxSpFirst style='border:none;padding:0in'>spam = ['hello',
3.14, 'world', 42, 10, 'fuzz']</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>eggs = ['hello',
3.14,</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>   'world'</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>         , 42,</p>

<p class=CodeExampleCxSpLast style='border:none;padding:0in'>       10, 'fuzz']</p>

</div>

<p class=MsoNormal>Though, of course, the code for the <span class=Literal>eggs</span>
list would be much more readable if we lined up all the items in the list or
put on a single line like <span class=Literal>spam</span>.</p>

<p class=MsoNormal>Normally, splitting a line of code across multiple lines in
the file editor would require putting a <span class=Literal>\</span> character
at the end of the line. The <span class=Literal>\</span> tells Python, “This
code continues onto the next line.” (This slash was first used in the Sliding
Puzzle game in the <span class=Literal>isValidMove()</span> function.)</p>

<p class=MsoNormal>We will make “template” data structures of the shapes by
creating a list of these list of strings, and store them in variables such as <span
class=Literal>S_SHAPE_TEMPLATE</span>. This way, <span class=Literal>len(S_SHAPE_TEMPLATE)</span>
will represent how many possible rotations there are for the S shape, and <span
class=Literal>S_SHAPE_TEMPLATE[0]</span> will represent the S shape’s first
possible rotation. Lines 47 to 147 will create “template” data structures for
each of the shapes.</p>

<p class=MsoNormal>Imagine that each possible piece in a tiny 5 x 5 board of
empty space, with some of the spaces on the board filled in with boxes. The
following expressions that use <span class=Literal>S_SHAPE_TEMPLATE[0]</span>
are <span class=Literal>True</span>:</p>

<div style='border:solid windowtext 1.0pt;padding:4.0pt 4.0pt 4.0pt 4.0pt'>

<p class=CodeExampleCxSpFirst style='border:none;padding:0in'>S_SHAPE_TEMPLATE[0][2][2]
== 'O'</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>S_SHAPE_TEMPLATE[0][2][3]
== 'O'</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>S_SHAPE_TEMPLATE[0][3][1]
== 'O'</p>

<p class=CodeExampleCxSpLast style='border:none;padding:0in'>S_SHAPE_TEMPLATE[0][3][2]
== 'O'</p>

</div>

<p class=MsoNormal>If we represented this shape on paper, it would look
something like this:</p>

<p class=MsoNormal align=center style='text-align:center'><img width=228
height=226 id="Picture 25" src="chapter7_files/image005.webp"></p>

<p class=MsoNormal>This is how we can represent things like Tetromino pieces as
Python values such as strings and lists. The <span class=Literal>TEMPLATEWIDTH</span>
and <span class=Literal>TEMPLATEHEIGHT</span> constants simply set how large
each row and column for each shape’s rotation should be. (The templates will
always be 5x5.)</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>149. </span>SHAPES
= {'S': S_SHAPE_TEMPLATE,</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>150. </span>          'Z':
Z_SHAPE_TEMPLATE,</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>151. </span>          'J':
J_SHAPE_TEMPLATE,</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>152. </span>          'L':
L_SHAPE_TEMPLATE,</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>153. </span>          'I':
I_SHAPE_TEMPLATE,</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>154. </span>          'O':
O_SHAPE_TEMPLATE,</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>155. </span>          'T':
T_SHAPE_TEMPLATE}</p>

</div>

<p class=MsoNormal>The <span class=Literal>SHAPES</span> variable will be a
dictionary that stores all of the different templates. Because each template
has all the possible rotations of a single shape, this means that the <span
class=Literal>SHAPES</span> variable contains all possible rotations of every
possible shape. This will be the data structure that contains all of the shape
data in our game.</p>

<h2><a name="_Toc316488669">The </a><span class=Literal>main()</span> Function</h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>158. </span>def
main():</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>159. </span>    global
FPSCLOCK, DISPLAYSURF, BASICFONT, BIGFONT</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>160. </span>    pygame.init()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>161. </span>    FPSCLOCK
= pygame.time.Clock()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>162. </span>    DISPLAYSURF
= pygame.display.set_mode((WINDOWWIDTH, WINDOWHEIGHT))</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>163. </span>    BASICFONT
= pygame.font.Font('freesansbold.ttf', 18)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>164. </span>    BIGFONT
= pygame.font.Font('freesansbold.ttf', 100)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>165. </span>    pygame.display.set_caption('Tetromino')</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>166. </span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>167. </span>    showTextScreen('Tetromino')</p>

</div>

<p class=MsoNormal>The <span class=Literal>main()</span> function handles
creating some more global constants and showing the start screen that appears
when the program is run. </p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>168. </span>    while
True: <span class=SourceCodeComment># game loop</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>169. </span>        if
random.randint(0, 1) == 0:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>170. </span>            pygame.mixer.music.load('tetrisb.mid')</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>171. </span>        else:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>172. </span>            pygame.mixer.music.load('tetrisc.mid')</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>173. </span>        pygame.mixer.music.play(-1,
0.0)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>174. </span>        runGame()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>175. </span>        pygame.mixer.music.stop()</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>176. </span>        showTextScreen('Game
Over')</p>

</div>

<p class=MsoNormal>The code for the actual game is all in <span class=Literal>runGame()</span>.
The <span class=Literal>main()</span> function here simply randomly decides
what background music to start playing (either the <em>tetrisb.mid</em> or <em>tetrisc.mid</em>
MIDI music file), then calls <span class=Literal>runGame()</span> to begin the
game. When the player loses, <span class=Literal>runGame()</span> will return
to <span class=Literal>main()</span>, which then stops the background music and
displays the game over screen.</p>

<p class=MsoNormal>When the player presses a key, the <span class=Literal>showTextScreen()</span>
function that displays the game over screen will return. The game loop will
loop back to the beginning at line 169 and start another game.</p>

<h2><a name="_Toc316488670">The Start of a New Game</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>179. </span>def
runGame():</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>180. </span>    <span
class=SourceCodeComment># setup variables for the start of the game</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>181. </span>    board
= getBlankBoard()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>182. </span>    lastMoveDownTime
= time.time()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>183. </span>    lastMoveSidewaysTime
= time.time()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>184. </span>    lastFallTime
= time.time()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>185. </span>    movingDown
= False <span class=SourceCodeComment># note: there is no movingUp variable</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>186. </span>    movingLeft
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>187. </span>    movingRight
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>188. </span>    score
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>189. </span>    level,
fallFreq = calculateLevelAndFallFreq(score)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>190. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>191. </span>    fallingPiece
= getNewPiece()</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>192. </span>    nextPiece
= getNewPiece()</p>

</div>

<p class=MsoNormal>Before the game begins and pieces start falling, we need to
initialize some variables to their start-of-game values. On line 191 the <span
class=Literal>fallingPiece</span> variable will be set to the currently falling
piece that can be rotated by the player. On line 192 the <span class=Literal>nextPiece</span>
variable will be set to the piece that shows up in the “Next” part of the
screen so that player knows what piece is coming up after setting the falling
piece.</p>

<h2><a name="_Toc316488671">The Game Loop</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>194. </span>    while
True: <span class=SourceCodeComment># main game loop</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>195. </span>        if
fallingPiece == None:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>196. </span>            <span
class=SourceCodeComment># No falling piece in play, so start a new piece at the
top</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>197. </span>            fallingPiece
= nextPiece</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>198. </span>            nextPiece
= getNewPiece()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>199. </span>            lastFallTime
= time.time() <span class=SourceCodeComment># reset lastFallTime</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>200. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>201. </span>            if
not isValidPosition(board, fallingPiece):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>202. </span>                return
<span class=SourceCodeComment># can't fit a new piece on the board, so game
over</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>203. </span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>204. </span>        checkForQuit()</p>

</div>

<p class=MsoNormal>The main game loop that starts on line 194 handles all of
the code for the main part of the game when pieces are falling to the bottom.
The <span class=Literal>fallingPiece</span> variable is set to <span
class=Literal>None</span> after the falling piece has landed. This means that
the piece in <span class=Literal>nextPiece</span> should be copied to the <span
class=Literal>fallingPiece</span> variable, and a random new piece should be
put into the <span class=Literal>nextPiece</span> variable. A new piece can be
generated from the <span class=Literal>getNewPiece()</span> function. The <span
class=Literal>lastFallTime</span> variable is also reset to the current time so
that the piece will fall in however many seconds is in <span class=Literal>fallFreq</span>.
</p>

<p class=MsoNormal>The pieces that <span class=Literal>getNewPiece()</span> are
positioned a little bit above the board, usually with part of the piece already
on the board. But if this is an invalid position because the board is already
filled up there (in which case the <span class=Literal>isValidPosition()</span>
call on line 201 will return <span class=Literal>False</span>), then we know
that the board is full and the player should lose the game. When this happens,
the <span class=Literal>runGame()</span> function returns.</p>

<h2><a name="_Toc316488672">The Event Handling Loop</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>205. </span>        for
event in pygame.event.get(): <span class=SourceCodeComment># event handling
loop</span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>206. </span>            if
event.type == KEYUP:</p>

</div>

<p class=MsoNormal>The event handling loop takes care of when the player
rotates the falling piece, moves the falling piece, or pauses the game.</p>

<h2><a name="_Toc316488673">Pausing the Game</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>207. </span>                if
(event.key == K_p):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>208. </span>                    <span
class=SourceCodeComment># Pausing the game</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>209. </span>                    DISPLAYSURF.fill(BGCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>210. </span>                    pygame.mixer.music.stop()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>211. </span>                    showTextScreen('Paused')
<span class=SourceCodeComment># pause until a key press</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>212. </span>                    pygame.mixer.music.play(-1,
0.0)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>213. </span>                    lastFallTime
= time.time()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>214. </span>                    lastMoveDownTime
= time.time()</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>215. </span>                    lastMoveSidewaysTime
= time.time()</p>

</div>

<p class=MsoNormal>If the player has pressed the P key, then the game should
pause. We need to hide the board from the player (otherwise the player could
cheat by pausing the game and taking time to decide where to move the piece).</p>

<p class=MsoNormal>The code blanks out the display Surface with a call to <span
class=Literal>DISPLAYSURF.fill(BGCOLOR)</span> and stops the music. The <span
class=Literal>showTextScreen()</span> function is called to display the
“Paused” text and wait for the player to press a key to continue.</p>

<p class=MsoNormal>Once the player has pressed a key, <span class=Literal>showTextScreen()</span>
will return. Line 212 will restart the background music. Also, since a large
amount of time could have passed since the player paused the game, the <span
class=Literal>lastFallTime</span>, <span class=Literal>lastMoveDownTime</span>,
and <span class=Literal>lastMoveSidewaysTime</span> variables should all be
reset to the current time (which is done on lines 213 to 215).</p>

<h2><a name="_Toc316488674">Using Movement Variables to Handle User Input</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>216. </span>                elif
(event.key == K_LEFT or event.key == K_a):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>217. </span>                    movingLeft
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>218. </span>                elif
(event.key == K_RIGHT or event.key == K_d):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>219. </span>                    movingRight
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>220. </span>                elif
(event.key == K_DOWN or event.key == K_s):</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>221. </span>                    movingDown
= False</p>

</div>

<p class=MsoNormal>Letting up on one of the arrow keys (or the WASD keys) will
set the <span class=Literal>movingLeft</span>, <span class=Literal>movingRight</span>,
or <span class=Literal>movingDown</span> variables back to <span class=Literal>False</span>,
indicating that the player no longer wants to move the piece in those
directions. The code later will handle what to do based on the Boolean values
inside these “moving” variables. Note that the up arrow and W keys are used for
rotating the piece, not moving the piece up. This is why there is no <span
class=Literal>movingUp</span> variable.</p>

<h2><a name="_Toc316488675">Checking if a Slide or Rotation is Valid</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>223. </span>            elif
event.type == KEYDOWN:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>224. </span>                <span
class=SourceCodeComment># moving the block sideways</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>225. </span>                if
(event.key == K_LEFT or event.key == K_a) and isValidPosition(board, fallingPiece,
adjX=-1):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>226. </span>                    fallingPiece['x']
-= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>227. </span>                    movingLeft
= True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>228. </span>                    movingRight
= False</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>229. </span>                    lastMoveSidewaysTime
= time.time()</p>

</div>

<p class=MsoNormal>When the left arrow key is pressed down (and moving to the
left is a valid move for the falling piece, as determined by the call to <span
class=Literal>isValidPosition()</span>), then we should change the position to
one space to the left by subtracting the value of <span class=Literal>fallingPiece['x']</span>
by <span class=Literal>1</span>. The <span class=Literal>isValidPosition()</span>
function has optional parameters called <span class=Literal>adjX</span> and <span
class=Literal>adjY</span>. Normally the <span class=Literal>isValidPosition()</span>
function checks the position of the data provided by the piece object that is
passed for the second parameter. However, sometimes we don’t want to check
where the piece is currently located, but rather a few spaces over from that
position.</p>

<p class=MsoNormal>If we pass <span class=Literal>-1</span> for the <span
class=Literal>adjX</span> (a short name for “adjusted X”), then it doesn’t
check the validity of the position in the piece’s data structure, but rather if
the position of where the piece would be if it was one space to the left.
Passing <span class=Literal>1</span> for <span class=Literal>adjX</span> would
check one space to the right. There is also an <span class=Literal>adjY</span>
optional parameter. Passing <span class=Literal>-1</span> for <span
class=Literal>adjY</span> checks one space above where the piece is currently
positioned, and passing a value like <span class=Literal>3</span> for <span
class=Literal>adjY</span> would check three spaces down from where the piece
is.</p>

<p class=MsoNormal>The <span class=Literal>movingLeft</span> variable is set to
<span class=Literal>True</span>, and just to make sure the falling piece won’t
move both left <em>and</em> right, the <span class=Literal>movingRight</span>
variable is set to <span class=Literal>False</span> on line 228. The <span
class=Literal>lastMoveSidewaysTime</span> variable will be updated to the current
time on line 229.</p>

<p class=MsoNormal>These variables are set so that the player can just hold
down the arrow key to keep moving the piece over. If the <span class=Literal>movingLeft</span>
variable is set to <span class=Literal>True</span>, the program can know that
the left arrow key (or A key) has been pressed and not yet let go. And if 0.15
seconds (the number stored in <span class=Literal>MOVESIDEWAYSFREQ</span>) has
passed since the time stored in <span class=Literal>lastMoveSidewaysTime</span>,
then it is time for the program to move the falling piece to the left again.</p>

<p class=MsoNormal>The <span class=Literal>lastMoveSidewaysTime</span> works
just like how the <span class=Literal>lastClickTime</span> variable did in the
Simulate chapter.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>231. </span>                elif
(event.key == K_RIGHT or event.key == K_d) and isValidPosition(board, fallingPiece,
adjX=1):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>232. </span>                    fallingPiece['x']
+= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>233. </span>                    movingRight
= True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>234. </span>                    movingLeft
= False</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>235. </span>                    lastMoveSidewaysTime
= time.time()</p>

</div>

<p class=MsoNormal>The code on lines 231 to 235 is almost identical to lines
225 to 229, except that it handles moving the falling piece to the right when
the right arrow key (or D key) has been pressed.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>237. </span>                <span
class=SourceCodeComment># rotating the block (if there is room to rotate)</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>238. </span>                elif
(event.key == K_UP or event.key == K_w):</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>239. </span>                    fallingPiece['rotation']
= (fallingPiece['rotation'] + 1) % len(SHAPES[fallingPiece['shape']])</p>

</div>

<p class=MsoNormal>The up arrow key (or W key) will rotate the falling piece to
its next rotation. All the code has to do is increment the <span class=Literal>'rotation'</span>
key’s value in the <span class=Literal>fallingPiece</span> dictionary by <span
class=Literal>1</span>. However, if incrementing the <span class=Literal>'rotation'</span>
key’s value makes it larger than the total number of rotations, then “modding”
by the total number of possible rotations for that shape (which is what <span
class=Literal>len(SHAPES[fallingPiece['shape']]</span>) is) then it will “roll
over” to <span class=Literal>0</span>.</p>

<p class=MsoNormal>Here’s an example of this modding with the J shape, which
has 4 possible rotations:</p>

<div style='border:solid windowtext 1.0pt;padding:4.0pt 4.0pt 4.0pt 4.0pt'>

<p class=CodeExampleCxSpFirst style='border:none;padding:0in'>&gt;&gt;&gt; 0 %
4</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>0</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>&gt;&gt;&gt; 1 %
4</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>1</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>&gt;&gt;&gt; 2 %
4</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>2</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>&gt;&gt;&gt; 3 %
4</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>3</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>&gt;&gt;&gt; 5 %
4</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>1</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>&gt;&gt;&gt; 6 %
4</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>2</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>&gt;&gt;&gt; 7 %
4</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>3</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>&gt;&gt;&gt; 8 %
4</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>0</p>

<p class=CodeExampleCxSpLast style='border:none;padding:0in'>&gt;&gt;&gt;&nbsp;</p>

</div>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>240. </span>                    if
not isValidPosition(board, fallingPiece):</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>241. </span>                        fallingPiece['rotation']
= (fallingPiece['rotation'] - 1) % len(SHAPES[fallingPiece['shape']])</p>

</div>

<p class=MsoNormal>If the new rotated position is not valid because it overlaps
some boxes already on the board, then we want to switch it back to the original
rotation by subtracting <span class=Literal>1</span> from <span class=Literal>fallingPiece['rotation']</span>.
We can also mod it by <span class=Literal>len(SHAPES[fallingPiece['shape']])</span>
so that if the new value is <span class=Literal>-1</span>, the modding will
change it back to the last rotation in the list. Here’s an example of modding a
negative number:</p>

<div style='border:solid windowtext 1.0pt;padding:4.0pt 4.0pt 4.0pt 4.0pt'>

<p class=CodeExampleCxSpFirst style='border:none;padding:0in'>&gt;&gt;&gt; -1 %
4</p>

<p class=CodeExampleCxSpLast style='border:none;padding:0in'>3</p>

</div>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>242. </span>                elif
(event.key == K_q): <span class=SourceCodeComment># rotate the other direction</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>243. </span>                    fallingPiece['rotation']
= (fallingPiece['rotation'] - 1) % len(SHAPES[fallingPiece['shape']])</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>244. </span>                    if
not isValidPosition(board, fallingPiece):</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>245. </span>                        fallingPiece['rotation']
= (fallingPiece['rotation'] + 1) % len(SHAPES[fallingPiece['shape']])</p>

</div>

<p class=MsoNormal>Lines 242 to 245 do the same thing 238 to 241, except they
handle the case where the player has pressed the Q key which rotates the piece
in the opposite direction. In this case, we <em>subtract</em> <span
class=Literal>1</span> from <span class=Literal>fallingPiece['rotation']</span>
(which is done on line 243) instead of adding <span class=Literal>1</span>.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>247. </span>                <span
class=SourceCodeComment># making the block fall faster with the down key</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>248. </span>                elif
(event.key == K_DOWN or event.key == K_s):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>249. </span>                    movingDown
= True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>250. </span>                    if
isValidPosition(board, fallingPiece, adjY=1):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>251. </span>                        fallingPiece['y']
+= 1</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>252. </span>                    lastMoveDownTime
= time.time()</p>

</div>

<p class=MsoNormal>If the down arrow or S key is pressed down, then the player
wants the piece to fall faster than normal. Line 251 moves the piece down one
space on the board (but only if it is a valid space). The <span class=Literal>movingDown</span>
variable is set to <span class=Literal>True</span> and <span class=Literal>lastMoveDownTime</span>
is reset to the current time. These variables will be checked later so that the
piece keeps falling at the faster rate as long as the down arrow or S key is
held down.</p>

<h2><a name="_Toc316488676">Finding the Bottom</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>254. </span>                <span
class=SourceCodeComment># move the current block all the way down</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>255. </span>                elif
event.key == K_SPACE:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>256. </span>                    movingDown
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>257. </span>                    movingLeft
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>258. </span>                    movingRight
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>259. </span>                    for
i in range(1, BOARDHEIGHT):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>260. </span>                        if
not isValidPosition(board, fallingPiece, adjY=i):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>261. </span>                            break</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>262. </span>                    fallingPiece['y']
+= i - 1</p>

</div>

<p class=MsoNormal>When the player presses the space key the falling piece will
immediately drop down as far as it can go on the board and land. The program
first needs to find out how many spaces the piece can move until it lands.</p>

<p class=MsoNormal>Lines 256 to 258 will set all the moving variables to <span
class=Literal>False</span> (which makes the code in later parts of the
programming think that the user has let up on any arrow keys that were held
down). This is done because this code will move the piece to the absolute
bottom and begin falling the next piece, and we don’t want to surprise the
player by having those pieces immediately start moving just because they were holding
down an arrow key when they hit the space key.</p>

<p class=MsoNormal>To find the farthest that the piece can fall, we should first
call <span class=Literal>isValidPosition()</span> and pass the integer <span
class=Literal>1</span> for the <span class=Literal>adjY</span> parameter. If <span
class=Literal>isValidPosition()</span> returns <span class=Literal>False</span>,
we know that the piece cannot fall any further and is already at the bottom. If
<span class=Literal>isValidPosition()</span> returns <span class=Literal>True</span>,
then we know that it can fall <span class=Literal>1</span> space down.</p>

<p class=MsoNormal>In that case, we should call <span class=Literal>isValidPosition()</span>
with <span class=Literal>adjY</span> set to <span class=Literal>2</span>. If it
returns <span class=Literal>True</span> again, we will call <span
class=Literal>isValidPosition()</span> with <span class=Literal>adjY</span> set
to <span class=Literal>3</span>, and so on. This is what the <span
class=Literal>for</span> loop on line 259 handles: calling <span class=Literal>isValidPosition()</span>
with increasing integer values to pass for <span class=Literal>adjY</span>
until the function call returns <span class=Literal>False</span>. At that
point, we know that the value in i is one space more past the bottom. This is
why line 262 increases <span class=Literal>fallingPiece['y']</span> by <span
class=Literal>i - 1</span> instead of <span class=Literal>i</span>.</p>

<p class=MsoNormal>(Also note that the second parameter to <span class=Literal>range()</span>
on line 259’s <span class=Literal>for</span> statement is set to <span
class=Literal>BOARDHEIGHT</span> because this is the maximum amount that the
piece could fall before it must hit the bottom of the board.)</p>

<h2><a name="_Toc316488677">Moving by Holding Down the Key</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>264. </span>        <span
class=SourceCodeComment># handle moving the block because of user input</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>265. </span>        if
(movingLeft or movingRight) and time.time() - lastMoveSidewaysTime &gt;
MOVESIDEWAYSFREQ:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>266. </span>            if
movingLeft and isValidPosition(board, fallingPiece, adjX=-1):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>267. </span>                fallingPiece['x']
-= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>268. </span>            elif
movingRight and isValidPosition(board, fallingPiece, adjX=1):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>269. </span>                fallingPiece['x']
+= 1</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>270. </span>            lastMoveSidewaysTime
= time.time()</p>

</div>

<p class=MsoNormal>Remember that on line 227 the <span class=Literal>movingLeft</span>
variable was set to <span class=Literal>True</span> if the player pressed down
on the left arrow key? (The same for line 233 where <span class=Literal>movingRight</span>
was set to <span class=Literal>True</span> if the player pressed down on the
right arrow key.) The moving variables were set back to <span class=Literal>False</span>
if the user let up on these keys also (see line 217 and 219).</p>

<p class=MsoNormal>What also happened when the player pressed down on the left
or right arrow key was that the <span class=Literal>lastMoveSidewaysTime</span>
variable was set to the current time (which was the return value of <span
class=Literal>time.time()</span>). If the player continued to hold down the
arrow key without letting up on it, then the <span class=Literal>movingLeft</span>
or <span class=Literal>movingRight</span> variable would still be set to <span
class=Literal>True</span>.</p>

<p class=MsoNormal>If the user held down on the key for longer than 0.15
seconds (the value stored in <span class=Literal>MOVESIDEWAYSFREQ</span> is the
float <span class=Literal>0.15</span>) then the expression <span class=Literal>time.time()
- lastMoveSidewaysTime &gt; MOVESIDEWAYSFREQ</span> would evaluate to <span
class=Literal>True</span>. Line 265’s condition is <span class=Literal>True</span>
if the user has both held down the arrow key and 0.15 seconds has passed, and
in that case we should move the falling piece to the left or right even though
the user hasn’t pressed the arrow key again.</p>

<p class=MsoNormal>This is very useful because it would become tiresome for the
player to repeatedly hit the arrow keys to get the falling piece to move over
multiple spaces on the board. Instead, they can just hold down an arrow key and
the piece will keep moving over until they let up on the key. When that
happens, the code on lines 216 to 221 will set the moving variable to <span
class=Literal>False</span> and the condition on line 265 will be <span
class=Literal>False</span>. That is what stops the falling piece from sliding
over more.</p>

<p class=MsoNormal>To demonstrate why the <span class=Literal>time.time() -
lastMoveSidewaysTime &gt; MOVESIDEWAYSFREQ</span> returns <span class=Literal>True</span>
after the number of seconds in <span class=Literal>MOVESIDEWAYSFREQ</span> has
passed, run this short program:</p>

<div style='border:solid windowtext 1.0pt;padding:4.0pt 4.0pt 4.0pt 4.0pt'>

<p class=CodeExampleCxSpFirst style='border:none;padding:0in'>import time</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>&nbsp;</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>WAITTIME = 4</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>begin =
time.time()</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>&nbsp;</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>while True:</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>    now =
time.time()</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>    message =
'%s, %s, %s' % (begin, now, (now - begin))</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>    if now -
begin &gt; WAITTIME:</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>       
print(message + ' PASSED WAIT TIME!')</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>    else:</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>       
print(message + ' Not yet...')</p>

<p class=CodeExampleCxSpLast style='border:none;padding:0in'>    time.sleep(0.2)</p>

</div>

<p class=MsoNormal>This program has an infinite loop, so in order to terminate
it, press Ctrl-C. The output of this program will look something like this:</p>

<div style='border:solid windowtext 1.0pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SampleRunCxSpFirst>1322106392.2, 1322106392.2, 0.0 Not yet...</p>

<p class=SampleRunCxSpMiddle>1322106392.2, 1322106392.42, 0.219000101089 Not
yet...</p>

<p class=SampleRunCxSpMiddle>1322106392.2, 1322106392.65, 0.449000120163 Not
yet...</p>

<p class=SampleRunCxSpMiddle>1322106392.2, 1322106392.88, 0.680999994278 Not
yet...</p>

<p class=SampleRunCxSpMiddle>1322106392.2, 1322106393.11, 0.910000085831 Not
yet...</p>

<p class=SampleRunCxSpMiddle>1322106392.2, 1322106393.34, 1.1400001049 Not
yet...</p>

<p class=SampleRunCxSpMiddle>1322106392.2, 1322106393.57, 1.3710000515 Not yet...</p>

<p class=SampleRunCxSpMiddle>1322106392.2, 1322106393.83, 1.6360001564 Not
yet...</p>

<p class=SampleRunCxSpMiddle>1322106392.2, 1322106394.05, 1.85199999809 Not
yet...</p>

<p class=SampleRunCxSpMiddle>1322106392.2, 1322106394.28, 2.08000016212 Not
yet...</p>

<p class=SampleRunCxSpMiddle>1322106392.2, 1322106394.51, 2.30900001526 Not
yet...</p>

<p class=SampleRunCxSpMiddle>1322106392.2, 1322106394.74, 2.54100012779 Not
yet...</p>

<p class=SampleRunCxSpMiddle>1322106392.2, 1322106394.97, 2.76999998093 Not
yet...</p>

<p class=SampleRunCxSpMiddle>1322106392.2, 1322106395.2, 2.99800014496 Not
yet...</p>

<p class=SampleRunCxSpMiddle>1322106392.2, 1322106395.42, 3.22699999809 Not
yet...</p>

<p class=SampleRunCxSpMiddle>1322106392.2, 1322106395.65, 3.45600008965 Not
yet...</p>

<p class=SampleRunCxSpMiddle>1322106392.2, 1322106395.89, 3.69200015068 Not
yet...</p>

<p class=SampleRunCxSpMiddle>1322106392.2, 1322106396.12, 3.92100000381 Not
yet...</p>

<p class=SampleRunCxSpMiddle>1322106392.2, 1322106396.35, 4.14899992943 PASSED
WAIT TIME!</p>

<p class=SampleRunCxSpMiddle>1322106392.2, 1322106396.58, 4.3789999485 PASSED
WAIT TIME!</p>

<p class=SampleRunCxSpMiddle>1322106392.2, 1322106396.81, 4.60700011253 PASSED WAIT
TIME!</p>

<p class=SampleRunCxSpMiddle>1322106392.2, 1322106397.04, 4.83700013161 PASSED
WAIT TIME!</p>

<p class=SampleRunCxSpMiddle>1322106392.2, 1322106397.26, 5.06500005722 PASSED
WAIT TIME!</p>

<p class=SampleRunCxSpMiddle>Traceback (most recent call last):</p>

<p class=SampleRunCxSpMiddle>  File &quot;C:\timetest.py&quot;, line 13, in
&lt;module&gt;</p>

<p class=SampleRunCxSpMiddle>    time.sleep(0.2)</p>

<p class=SampleRunCxSpLast>KeyboardInterrupt</p>

</div>

<p class=MsoNormal>The first number on each line of output is the return value
of <span class=Literal>time.time()</span> when the program first started (and
this value never changes). The second number is the latest return value from <span
class=Literal>time.time()</span> (this value keeps getting updated on each
iteration of the loop). And the third number is the current time minus the
start time. This third number is the number of seconds that have elapsed since
the <span class=Literal>begin = time.time()</span> line of code was executed.</p>

<p class=MsoNormal>If this number is greater than 4, the code will start
printing “PASSED WAIT TIME!” instead of “Not yet...”. This is how our game
program can know if a certain amount of time has passed since a line of code
was run.</p>

<p class=MsoNormal>In our Tetromino program, the <span class=Literal>time.time()
– lastMoveSidewaysTime</span> expression will evaluate to the number of seconds
that has elapsed since the last time <span class=Literal>lastMoveSidewaysTime</span>
was set to the current time. If this value is greater than the value in <span
class=Literal>MOVESIDEWAYSFREQ</span>, we know it is time for the code to move
the falling piece over one more space.</p>

<p class=MsoNormal>Don’t forget to update <span class=Literal>lastMoveSidewaysTime</span>
to the current time again! This is what we do on line 270.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>272. </span>        if
movingDown and time.time() - lastMoveDownTime &gt; MOVEDOWNFREQ and
isValidPosition(board, fallingPiece, adjY=1):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>273. </span>            fallingPiece['y']
+= 1</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>274. </span>            lastMoveDownTime
= time.time()</p>

</div>

<p class=MsoNormal>Lines 272 to 274 do almost the same thing as lines 265 to
270 do except for moving the falling piece down. This has a separate move
variable (<span class=Literal>movingDown</span>) and “last time” variable (<span
class=Literal>lastMoveDownTime</span>) as well as a different “move frequency”
variable (<span class=Literal>MOVEDOWNFREQ</span>). </p>

<h2><a name="_Toc316488678">Letting the Piece “Naturally” Fall</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>276. </span>        <span
class=SourceCodeComment># let the piece fall if it is time to fall</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>277. </span>        if
time.time() - lastFallTime &gt; fallFreq:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>278. </span>            <span
class=SourceCodeComment># see if the piece has landed</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>279. </span>            if
not isValidPosition(board, fallingPiece, adjY=1):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>280. </span>                <span
class=SourceCodeComment># falling piece has landed, set it on the board</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>281. </span>                addToBoard(board,
fallingPiece)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>282. </span>                score
+= removeCompleteLines(board)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>283. </span>                level,
fallFreq = calculateLevelAndFallFreq(score)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>284. </span>                fallingPiece
= None</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>285. </span>            else:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>286. </span>                <span
class=SourceCodeComment># piece did not land, just move the block down</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>287. </span>                fallingPiece['y']
+= 1</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>288. </span>                lastFallTime
= time.time()</p>

</div>

<p class=MsoNormal>The rate that the piece is naturally moving down (that is,
falling) is tracked by the <span class=Literal>lastFallTime</span> variable. If
enough time has elapsed since the falling piece last fell down one space, lines
279 to 288 will handle dropping the piece by one space.</p>

<p class=MsoNormal>If the condition on line 279 is <span class=Literal>True</span>,
then the piece has landed. The call to <span class=Literal>addToBoard()</span>
will make the piece part of the board data structure (so that future pieces can
land on it), and the <span class=Literal>removeCompleteLines()</span> call will
handle erasing any complete lines on the board and pulling the boxes down. The <span
class=Literal>removeCompleteLines()</span> function also returns an integer
value of how many lines were removed, so we add this number to the score. </p>

<p class=MsoNormal>Because the score may have changed, we call the <span
class=Literal>calculateLevelAndFallFreq()</span> function to update the current
level and frequency that the pieces fall. And finally, we set the <span
class=Literal>fallingPiece</span> variable to <span class=Literal>None</span>
to indicate that the next piece should become the new falling piece, and a
random new piece should be generated for the new next piece. (That is done on
lines 195 to 199 at the beginning of the game loop.)</p>

<p class=MsoNormal>If the piece has not landed, we simply set its Y position
down one space (on line 287) and reset <span class=Literal>lastFallTime</span>
to the current time (on line 288).</p>

<h2><a name="_Toc316488679">Drawing Everything on the Screen</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>290. </span>        <span
class=SourceCodeComment># drawing everything on the screen</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>291. </span>        DISPLAYSURF.fill(BGCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>292. </span>        drawBoard(board)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>293. </span>        drawStatus(score,
level)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>294. </span>        drawNextPiece(nextPiece)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>295. </span>        if
fallingPiece != None:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>296. </span>            drawPiece(fallingPiece)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>297. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>298. </span>        pygame.display.update()</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>299. </span>        FPSCLOCK.tick(FPS)</p>

</div>

<p class=MsoNormal>Now that the game loop has handled all events and updated
the game state, the game loop just needs to draw the game state to the screen.
Most of the drawing is handled by other functions, so the game loop code just
needs to call those functions. Then the call to <span class=Literal>pygame.display.update()</span>
makes the display Surface appear on the actual computer screen, and the <span
class=Literal>tick()</span> method call adds a slight pause so the game doesn’t
run too fast.</p>

<h2><a name="_Toc316488680"><span class=Literal>makeTextObjs()</span>, A
Shortcut Function for Making Text</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>302. </span>def
makeTextObjs(text, font, color):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>303. </span>    surf
= font.render(text, True, color)</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>304. </span>    return
surf, surf.get_rect()</p>

</div>

<p class=MsoNormal>The <span class=Literal>makeTextObjs()</span> function just
provides us with a shortcut. Given the text, Font object, and a Color object,
it calls <span class=Literal>render()</span> for us and returns the Surface and
Rect object for this text. This just saves us from typing out the code to
create the Surface and Rect object each time we need them.</p>

<h2><a name="_Toc316488681">The Same Old </a><span class=Literal>terminate()</span>
Function</h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>307. </span>def
terminate():</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>308. </span>    pygame.quit()</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>309. </span>    sys.exit()</p>

</div>

<p class=MsoNormal>The <span class=Literal>terminate()</span> function works
the same as in the previous game programs.</p>

<h2><a name="_Toc316488682">Waiting for a Key Press Event with the </a><span
class=Literal>checkForKeyPress()</span> Function</h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>312. </span>def
checkForKeyPress():</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>313. </span>    <span
class=SourceCodeComment># Go through event queue looking for a KEYUP event.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>314. </span>    <span
class=SourceCodeComment># Grab KEYDOWN events to remove them from the event
queue.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>315. </span>    checkForQuit()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>316.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>317. </span>    for
event in pygame.event.get([KEYDOWN, KEYUP]):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>318. </span>        if
event.type == KEYDOWN:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>319. </span>            continue</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>320. </span>        return
event.key</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>321. </span>    return
None</p>

</div>

<p class=MsoNormal>The <span class=Literal>checkForKeyPress()</span> function
works almost the same as it did in the Wormy game. First it calls <span
class=Literal>checkForQuit()</span> to handle any <span class=Literal>QUIT</span>
events (or <span class=Literal>KEYUP</span> events specifically for the Esc
key) and terminates the program if there are any. Then it pulls out all the <span
class=Literal>KEYUP</span> and <span class=Literal>KEYDOWN</span> events from
the event queue. It ignores any <span class=Literal>KEYDOWN</span> events (<span
class=Literal>KEYDOWN</span> was specified to <span class=Literal>pygame.event.get()</span>
only to clear those events out of the event queue).</p>

<p class=MsoNormal>If there were no <span class=Literal>KEYUP</span> events in
the event queue, then the function returns <span class=Literal>None</span>.</p>

<h2><a name="_Toc316488683"><span class=Literal>showTextScreen()</span>, A
Generic Text Screen Function</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>324. </span>def
showTextScreen(text):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>325. </span>    <span
class=SourceCodeComment># This function displays large text in the</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>326. </span>    <span
class=SourceCodeComment># center of the screen until a key is pressed.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>327. </span>    <span
class=SourceCodeComment># Draw the text drop shadow</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>328. </span>    titleSurf,
titleRect = makeTextObjs(text, BIGFONT, TEXTSHADOWCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>329. </span>    titleRect.center
= (int(WINDOWWIDTH / 2), int(WINDOWHEIGHT / 2))</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>330. </span>    DISPLAYSURF.blit(titleSurf,
titleRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>331. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>332. </span>    <span
class=SourceCodeComment># Draw the text</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>333. </span>    titleSurf,
titleRect = makeTextObjs(text, BIGFONT, TEXTCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>334. </span>    titleRect.center
= (int(WINDOWWIDTH / 2) - 3, int(WINDOWHEIGHT / 2) - 3)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>335. </span>    DISPLAYSURF.blit(titleSurf,
titleRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>336. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>337. </span>    <span
class=SourceCodeComment># Draw the additional &quot;Press a key to play.&quot;
text.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>338. </span>    pressKeySurf,
pressKeyRect = makeTextObjs('Press a key to play.', BASICFONT, TEXTCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>339. </span>    pressKeyRect.center
= (int(WINDOWWIDTH / 2), int(WINDOWHEIGHT / 2) + 100)</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>340. </span>    DISPLAYSURF.blit(pressKeySurf,
pressKeyRect)</p>

</div>

<p class=MsoNormal>Instead of separate functions for the start screen and game
over screens, we will create one generic function named <span class=Literal>showTextScreen()</span>.
The <span class=Literal>showTextScreen()</span> function will draw whatever
text we pass for the text parameter. Also, the text “Press a key to play.” will
be displayed in addition.</p>

<p class=MsoNormal>Notice that lines 328 to 330 draw the text in a darker
shadow color first, and then lines 333 to 335 draw the same text again, except
offset by 3 pixels to the left and 3 pixels upward. This creates a “drop
shadow” effect that makes the text look a bit prettier. You can compare the
difference by commenting out lines 328 to 330 to see the text without a drop
shadow.</p>

<p class=MsoNormal>The <span class=Literal>showTextScreen()</span> will be used
for the start screen, the game over screen, and also for a pause screen. (The
pause screen is explained later in this chapter.)</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>342. </span>    while
checkForKeyPress() == None:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>343. </span>        pygame.display.update()</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>344. </span>        FPSCLOCK.tick()</p>

</div>

<p class=MsoNormal>We want the text to stay on the screen until the user
presses a key. This small loop will constantly call <span class=Literal>pygame.display.update()</span>
and <span class=Literal>FPSCLOCK.tick()</span> until <span class=Literal>checkForKeyPress()</span>
returns a value other than <span class=Literal>None</span>. This happens when
the user presses a key.</p>

<h2><a name="_Toc316488684">The </a><span class=Literal>checkForQuit()</span>
Function</h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>347. </span>def
checkForQuit():</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>348. </span>    for
event in pygame.event.get(QUIT): <span class=SourceCodeComment># get all the
QUIT events</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>349. </span>        terminate()
<span class=SourceCodeComment># terminate if any QUIT events are present</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>350. </span>    for
event in pygame.event.get(KEYUP): <span class=SourceCodeComment># get all the
KEYUP events</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>351. </span>        if
event.key == K_ESCAPE:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>352. </span>            terminate()
<span class=SourceCodeComment># terminate if the KEYUP event was for the Esc
key</span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>353. </span>        pygame.event.post(event)
<span class=SourceCodeComment># put the other KEYUP event objects back</span></p>

</div>

<p class=MsoNormal>The <span class=Literal>checkForQuit()</span> function can
be called to handle any events that will cause the program to terminate. This
happens if there are any <span class=Literal>QUIT</span> events in the event
queue (this is handle by lines 348 and 349), or if there is a <span
class=Literal>KEYUP</span> event of the Esc key. The player should be able to
press the Esc key at any time to quit the program.</p>

<p class=MsoNormal>Because the <span class=Literal>pygame.event.get()</span>
call on line 350 pulls out all of the <span class=Literal>KEYUP</span> events
(including events for keys other than the Esc key), if the event is not for the
Esc key, we want to put it back into the event queue by calling the <span
class=Literal>pygame.event.post()</span> function.</p>

<h2><a name="_Toc316488685">The </a><span class=Literal>calculateLevelAndFallFreq()</span>
Function</h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>356. </span>def
calculateLevelAndFallFreq(score):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>357. </span>    <span
class=SourceCodeComment># Based on the score, return the level the player is on
and</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>358. </span>    <span
class=SourceCodeComment># how many seconds pass until a falling piece falls one
space.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>359. </span>    level
= int(score / 10) + 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>360. </span>    fallFreq
= 0.27 - (level * 0.02)</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>361.     </span>return
level, fallFreq</p>

</div>

<p class=MsoNormal>Every time the player completes a line, their score will
increase by one point. Every ten points, the game goes up a level and the
pieces start falling down faster. Both the level and the falling frequency can
be calculated from the score that is passed to this function.</p>

<p class=MsoNormal>To calculate the level, we use the <span class=Literal>int()</span>
function to round down the score divided by <span class=Literal>10</span>. So
if the score any number between <span class=Literal>0</span> and <span
class=Literal>9</span>, the <span class=Literal>int()</span> call will round it
down to <span class=Literal>0</span>. The <span class=Literal>+ 1</span> part
of the code is there because we want the first level to be level 1, not level
0. When the score reaches <span class=Literal>10</span>, then <span
class=Literal>int(10 / 10)</span> will evaluate to 1, and the <span
class=Literal>+ 1</span> will make the level 2. Here is a graph showing the
values of level for the scores 1 to 34:</p>

<p class=MsoNormal align=center style='text-align:center'><img width=481
height=241 id="Chart 39" src="chapter7_files/image006.webp"></p>

<p class=MsoNormal>To calculate the falling frequency, we start with a base
time of <span class=Literal>0.27</span> (meaning that the piece will naturally
fall once every 0.27 seconds). Then we multiply the level by <span
class=Literal>0.02</span>, and subtract that from the <span class=Literal>0.27</span>
base time. So on level 1, we subtract <span class=Literal>0.02 * 1</span> (that
is, <span class=Literal>0.02</span>) from <span class=Literal>0.27</span> to
get <span class=Literal>0.25</span>. On level 2, we subtract <span
class=Literal>0.02 * 2</span> (that is, <span class=Literal>0.04</span>) to get
<span class=Literal>0.23</span>. You can think of the <span class=Literal>level
* 0.02</span> part of the equation as “for every level, the piece will fall
0.02 seconds faster than the previous level.”</p>

<p class=MsoNormal>We can also make a graph showing how fast the pieces will
fall at each level of the game:</p>

<p class=MsoNormal align=center style='text-align:center'><img width=481
height=241 id="Chart 44" src="chapter7_files/image007.webp"></p>

<p class=MsoNormal>You can see that at level 14, the falling frequency will be
less than <span class=Literal>0</span>. This won’t cause any bugs with our
code, because line 277 just checks that the elapsed time since the falling
piece last fell one space is greater than the calculated falling frequency. So
if the falling frequency is negative, then the condition on line 277 will
always be <span class=Literal>True</span> and the piece will fall on every
iteration of the game loop. From level 14 and beyond, the piece cannot fall any
faster.</p>

<p class=MsoNormal>If the <span class=Literal>FPS</span> is set at <span
class=Literal>25</span>, this means that at reaching level 14, the falling
piece will fall 25 spaces a second. Considering that the board is only 20
spaces tall, that means the player will have less than a second to set each
piece!</p>

<p class=MsoNormal>If you want the pieces to start (if you can see what I mean)
falling faster at a slower rate, you can change the equation that the <span
class=Literal>calculateLevelAndFallFreq()</span> uses. For example, let’s say
line 360 was this:</p>

<div style='border:solid windowtext 1.0pt;padding:4.0pt 4.0pt 4.0pt 4.0pt'>

<p class=CodeExample style='border:none;padding:0in'><span
class=SourceLineNumber>360. </span>    fallFreq = 0.27 - (level * 0.01)</p>

</div>

<p class=MsoNormal>In the above case, the pieces would only fall 0.01 seconds
faster on each level rather than 0.02 seconds faster. The graph would look like
this (the original line is also in the graph in light grey):</p>

<p class=MsoNormal align=center style='text-align:center'><img width=481
height=241 id="Chart 45" src="chapter7_files/image008.webp"></p>

<p class=MsoNormal>As you can see, with this new equation, level 14 would only
be as hard as the original level 7. You can change the game to be as difficult
or easy as you like by changing the equations in <span class=Literal>calculateLevelAndFallFreq()</span>.</p>

<h2><a name="_Toc316488686">Generating Pieces with the </a><span class=Literal>getNewPiece()</span>
Function</h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>363. </span>def
getNewPiece():</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>364. </span>    <span
class=SourceCodeComment># return a random new piece in a random rotation and color</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>365. </span>    shape
= random.choice(list(SHAPES.keys()))</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>366. </span>    newPiece
= {'shape': shape,</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>367. </span>                'rotation':
random.randint(0, len(SHAPES[shape]) - 1),</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>368. </span>                'x':
int(BOARDWIDTH / 2) - int(TEMPLATEWIDTH / 2),</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>369. </span>                'y':
-2, <span class=SourceCodeComment># start it above the board (i.e. less than 0)</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>370. </span>                'color':
random.randint(0, len(COLORS)-1)}</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>371. </span>    return
newPiece</p>

</div>

<p class=MsoNormal>The <span class=Literal>getNewPiece()</span> function
generates a random piece that is positioned at the top of the board. First, to
randomly choose the shape of the piece, we create a list of all the possible
shapes by calling <span class=Literal>list(SHAPES.keys())</span> on line 365.
The <span class=Literal>keys()</span> dictionary method returns a value of the
data type “dict_keys”, which must be converted to a list value with the <span
class=Literal>list()</span> function before being passed to <span
class=Literal>random.choice()</span>. This is because the <span class=Literal>random.choice()</span>
function only accepts list values for its parameter. The <span class=Literal>random.choice()</span>
function then randomly returns the value of an item from the list.</p>

<p class=MsoNormal>The piece data structures are simply a dictionary value with
the keys <span class=Literal>'shape'</span>, <span class=Literal>'rotation'</span>,
<span class=Literal>'x'</span>, <span class=Literal>'y'</span>, and <span
class=Literal>'color'</span>.</p>

<p class=MsoNormal>The value for the <span class=Literal>'rotation'</span> key
is a random integer between <span class=Literal>0</span> to one less than
however many possible rotations there are for that shape. The number of
rotations for a shape can be found from the expression <span class=Literal>len(SHAPES[shape])</span>.</p>

<p class=MsoNormal>Notice that we don’t store the list of string values (like
the ones store in the constants like <span class=Literal>S_SHAPE_TEMPLATE</span>)
in each piece data structure to represent the boxes of each piece. Instead, we
just store an index for the shape and rotation which refer to the <span
class=Literal>PIECES</span> constant.</p>

<p class=MsoNormal>The <span class=Literal>'x'</span> key’s value is always set
to the middle of the board (also accounting for the width of the pieces
themselves, which is found from our <span class=Literal>TEMPLATEWIDTH</span>
constant). The <span class=Literal>'y'</span> key’s value is always set to <span
class=Literal>-2</span> to place it slightly above the board. (The top row of
the board is row 0.)</p>

<p class=MsoNormal>Since the <span class=Literal>COLORS</span> constant is a
tuple of the different colors, selecting a random number from <span
class=Literal>0</span> to the length of <span class=Literal>COLORS</span>
(subtracting one) will give us a random index value for the piece’s color.</p>

<p class=MsoNormal>Once all of the values in the <span class=Literal>newPiece</span>
dictionary are set, the <span class=Literal>getNewPiece()</span> function
returns <span class=Literal>newPiece</span>. </p>

<h2><a name="_Toc316488687">Adding Pieces to the Board Data Structure</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>374. </span>def
addToBoard(board, piece):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>375. </span>    <span
class=SourceCodeComment># fill in the board based on piece's location, shape,
and rotation</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>376. </span>    for
x in range(TEMPLATEWIDTH):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>377. </span>        for
y in range(TEMPLATEHEIGHT):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>378. </span>            if
SHAPES[piece['shape']][piece['rotation']][y][x] != BLANK:</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>379. </span>                board[x
+ piece['x']][y + piece['y']] = piece['color']</p>

</div>

<p class=MsoNormal>The board data structure is a data representation for the
rectangular space where pieces that have previously landed are tracked. The currently
falling piece is not marked on the board data structure. What the <span
class=Literal>addToBoard()</span> function does is takes a piece data structure
and adds its boxes to the board data structure. This happens after a piece has
landed.</p>

<p class=MsoNormal>The nested <span class=Literal>for</span> loops on lines 376
and 377 go through every space in the piece data structure, and if it finds a
box in the space (line 378), it adds it to the board (line 379).</p>

<h2><a name="_Toc316488688">Creating a New Board Data Structure</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>382. </span>def
getBlankBoard():</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>383. </span>    <span
class=SourceCodeComment># create and return a new blank board data structure</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>384. </span>    board
= []</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>385. </span>    for
i in range(BOARDWIDTH):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>386. </span>        board.append([BLANK]
* BOARDHEIGHT)</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>387. </span>    return
board</p>

</div>

<p class=MsoNormal>The data structure used for the board is fairly simple: it’s
a list of lists of values. If the value is the same as the value in <span
class=Literal>BLANK</span>, then it is an empty space. If the value is an
integer, then it represents a box that is the color that the integer indexes in
the <span class=Literal>COLORS</span> constant list. That is, <span
class=Literal>0</span> is blue, <span class=Literal>1</span> is green, <span
class=Literal>2</span> is red, and <span class=Literal>3</span> is yellow.</p>

<p class=MsoNormal>In order to create a blank board, list replication is used
to create the lists of <span class=Literal>BLANK</span> values which represents
a column. This is done on line 386. One of these lists is created for each of
the columns in the board (this is what the <span class=Literal>for</span> loop
on line 385 does).</p>

<h2><a name="_Toc316488689">The </a><span class=Literal>isOnBoard()</span> and <span
class=Literal>isValidPosition()</span> Functions</h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>390. </span>def
isOnBoard(x, y):</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>391. </span>    return
x &gt;= 0 and x &lt; BOARDWIDTH and y &lt; BOARDHEIGHT</p>

</div>

<p class=MsoNormal>The <span class=Literal>isOnBoard()</span> is a simple
function which checks that the XY coordinates that are passed represent valid
values that exist on the board. As long as both the XY coordinates are not less
<span class=Literal>0</span> or greater than or equal to the <span
class=Literal>BOARDWIDTH</span> and <span class=Literal>BOARDHEIGHT</span>
constants, then the function returns <span class=Literal>True</span>. </p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>394. </span>def
isValidPosition(board, piece, adjX=0, adjY=0):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>395. </span>    <span
class=SourceCodeComment># Return True if the piece is within the board and not
colliding</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>396. </span>    for
x in range(TEMPLATEWIDTH):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>397. </span>        for
y in range(TEMPLATEHEIGHT):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>398.</span>            
isAboveBoard = y + piece['y'] + adjY &lt; 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>399. </span>            if
isAboveBoard or SHAPES[piece['shape']][piece['rotation']][y][x] == BLANK:</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>400. </span>                continue</p>

</div>

<p class=MsoNormal>The <span class=Literal>isValidPosition()</span> function is
given a board data structure and a piece data structure, and returns <span
class=Literal>True</span> if all the boxes in the piece are both on the board
and not overlapping any boxes on the board. This is done by taking the piece’s
XY coordinates (which is really the coordinate of the upper right box on the
5x5 boxes for the piece) and adding the coordinate inside the piece data
structure. Here’s a couple pictures to help illustrate this:</p>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td width=265 valign=top style='width:198.9pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><img width=180
  height=321 id="Picture 26" src="chapter7_files/image009.webp"></p>
  </td>
  <td width=325 valign=top style='width:243.9pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'><img width=180
  height=321 id="Picture 27" src="chapter7_files/image010.webp"></p>
  </td>
 </tr>
 <tr>
  <td width=265 valign=top style='width:198.9pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'>The board with a
  falling piece in a valid position.</p>
  </td>
  <td width=325 valign=top style='width:243.9pt;padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal align=center style='text-align:center'>The board with the
  falling piece in an invalid position.</p>
  </td>
 </tr>
</table>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>On the left board, the falling piece’s (that is, the top
left corner of the falling piece’s) XY coordinates are (2, 3) on the board. But
the boxes inside the falling piece’s coordinate system have their own
coordinates. To find the “board” coordinates of these pieces, we just have to
add the “board” coordinates of the falling piece’s top left box and the “piece”
coordinates of the boxes.</p>

<p class=MsoNormal>On the left board, the falling piece’s boxes are at the
following “piece” coordinates:</p>

<p class=MsoNormal>            (2, 2)    (3, 2)    (1, 3)    (2, 3)</p>

<p class=MsoNormal>When we add the (2, 3) coordinate (the piece’s coordinates
on the board) to these coordinates, it looks like this:</p>

<p class=MsoNormal>            (2 + 2, 2 + 3)    (3 + 2, 2 + 3)    (1 + 2, 3 +
3)    (2 + 2, 3 + 3)</p>

<p class=MsoNormal>After adding the (2, 3) coordinate the boxes are at the
following “board” coordinates:</p>

<p class=MsoNormal>            (4, 5)    (5, 5)    (3, 6)    (4, 6)</p>

<p class=MsoNormal>And now that we can figure out where the falling piece’s
boxes are as board coordinates, we can see if they overlap with the landed
boxes that are already on the board. The nested <span class=Literal>for</span>
loops on lines 396 and 397 go through each of the possible coordinates on the
falling piece.</p>

<p class=MsoNormal>We want to check if a box of the falling piece is either off
of the board or overlapping a box on the board. (Although one exception is if
the box is above the board, which is where it could be when the falling piece
just begins falling.) Line 398 creates a variable named <span class=Literal>isAboveBoard</span>
that is set to <span class=Literal>True</span> if the box on the falling piece
at the coordinates pointed to be x and y is above the board. Otherwise it is
set to <span class=Literal>False</span>.</p>

<p class=MsoNormal>The <span class=Literal>if</span> statement on line 399 checks
if the space on the piece is above the board or is blank. If either of those is
<span class=Literal>True</span>, then the code executes a <span class=Literal>continue</span>
statement and goes to the next iteration. (Note that the end of line 399 has <span
class=Literal>[y][x]</span> instead of <span class=Literal>[x][y]</span>. This
is because the coordinates in the <span class=Literal>PIECES</span> data
structure are reversed. See the previous section, “Setting Up the Piece
Templates”).</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>401. </span>            if
not isOnBoard(x + piece['x'] + adjX, y + piece['y'] + adjY):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>402. </span>                return
False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>403. </span>            if
board[x + piece['x'] + adjX][y + piece['y'] + adjY] != BLANK:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>404. </span>                return
False</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>405. </span>    return
True</p>

</div>

<p class=MsoNormal>The <span class=Literal>if</span> statement on line 401
checks that the piece’s box is not located on the board. The <span
class=Literal>if</span> statement on line 403 checks that the board space the
piece’s box is located is not blank. If either of these conditions are <span
class=Literal>True</span>, then the <span class=Literal>isValidPosition()</span>
function will return <span class=Literal>False</span>. Notice that these <span
class=Literal>if</span> statements also adjust the coordinates for the <span
class=Literal>adjX</span> and <span class=Literal>adjY</span> parameters that
were passed in to the function.</p>

<p class=MsoNormal>If the code goes through the nested <span class=Literal>for</span>
loop and hasn’t found a reason to return <span class=Literal>False</span>, then
the position of the piece must be valid and so the function returns <span
class=Literal>True</span> on line 405.</p>

<h2><a name="_Toc316488690">Checking for, and Removing, Complete Lines</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>407. </span>def
isCompleteLine(board, y):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>408. </span>    <span
class=SourceCodeComment># Return True if the line filled with boxes with no
gaps.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>409. </span>    for
x in range(BOARDWIDTH):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>410. </span>        if
board[x][y] == BLANK:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>411. </span>            return
False</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>412. </span>    return
True</p>

</div>

<p class=MsoNormal>The <span class=Literal>isCompleteLine</span> does a simple
check at the row specified by the <span class=Literal>y</span> parameter. A row
on the board is considered to be “complete” when every space is filled by a
box. The <span class=Literal>for</span> loop on line 409 goes through each
space in the row. If a space is blank (which is caused by it having the same
value as the <span class=Literal>BLANK</span> constant), then the function
return <span class=Literal>False</span>.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>415. </span>def
removeCompleteLines(board):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>416. </span>    <span
class=SourceCodeComment># Remove any completed lines on the board, move
everything above them down, and return the number of complete lines.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>417. </span>    numLinesRemoved
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>418. </span>    y
= BOARDHEIGHT - 1 <span class=SourceCodeComment># start y at the bottom of the
board</span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>419. </span>    while
y &gt;= 0:</p>

</div>

<p class=MsoNormal>The <span class=Literal>removeCompleteLines()</span>
function will find any complete lines in the passed board data structure,
remove the lines, and then shift all the boxes on the board above that line
down one row. The function will return the number of lines that were removed
(which is tracked by the <span class=Literal>numLinesRemoved</span> variable)
so that this can be added to the score.</p>

<p class=MsoNormal>The way this function works is by running in a loop starting
on line 419 with the <span class=Literal>y</span> variable starting at the
lowest row (which is <span class=Literal>BOARDHEIGHT - 1</span>). Whenever the
row specified by <span class=Literal>y</span> is not complete, <span
class=Literal>y</span> will be decremented to the next highest row. The loop
finally stops once y reaches <span class=Literal>-1</span>.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>420. </span>        if
isCompleteLine(board, y):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>421. </span>            <span
class=SourceCodeComment># Remove the line and pull boxes down by one line.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>422. </span>            for
pullDownY in range(y, 0, -1):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>423. </span>                for
x in range(BOARDWIDTH):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>424. </span>                    board[x][pullDownY]
= board[x][pullDownY-1]</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>425. </span>            <span
class=SourceCodeComment># Set very top line to blank.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>426. </span>            for
x in range(BOARDWIDTH):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>427. </span>                board[x][0]
= BLANK</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>428. </span>            numLinesRemoved
+= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>429. </span>            <span
class=SourceCodeComment># Note on the next iteration of the loop, y is the
same.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>430. </span>            <span
class=SourceCodeComment># This is so that if the line that was pulled down is
also</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>431. </span>            <span
class=SourceCodeComment># complete, it will be removed.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>432. </span>        else:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>433. </span>            y
-= 1 <span class=SourceCodeComment># move on to check next row up</span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>434. </span>    return
numLinesRemoved</p>

</div>

<p class=MsoNormal>The <span class=Literal>isCompleteLine()</span> function
will return <span class=Literal>True</span> if the line that <span
class=Literal>y</span> is referring to is complete. In that case, the program
needs to copy the values of each row above the removed line to the next lowest
line. This is what the <span class=Literal>for</span> loop on line 422 does
(which is why its call to the <span class=Literal>range()</span> function
begins at <span class=Literal>y</span>, rather than <span class=Literal>0</span>.
Also note that it uses the three argument form of <span class=Literal>range()</span>,
so that the list it returns starts at <span class=Literal>y</span>, ends at <span
class=Literal>0</span>, and after each iteration “increases” by <span
class=Literal>-1</span>.)</p>

<p class=MsoNormal>Let’s look at the following example. To save space, only the
top five rows of the board are shown. Row 3 is a complete line, which means
that all the rows above it (row 2, 1, and 0) must be “pulled down”. First, row
2 is copied down to row 3. The board on the right shows what the board will
look like after this is done:</p>

<p class=MsoNormal align=center style='text-align:center'><img width=393
height=89 id="Picture 78" src="chapter7_files/image011.webp"></p>

<p class=MsoNormal>This “pulling down” is really just copying the higher row’s
values to the row below it on line 424. After row 2 is copied to row 3, then
row 1 is copied to row 2 followed by row 0 copied to row 1:</p>

<p class=MsoNormal align=center style='text-align:center'><img width=393
height=89 id="Picture 79" src="chapter7_files/image012.webp"></p>

<p class=MsoNormal align=center style='text-align:center'><img width=393
height=89 id="Picture 92" src="chapter7_files/image013.webp"></p>

<p class=MsoNormal>Row 0 (the row at the very top) doesn’t have a row above it
to copy values down. But row 0 doesn’t need a row copied to it, it just needs
all the spaces set to <span class=Literal>BLANK</span>. This is what lines 426
and 427 do. After that, the board will have changed from the board shown below
on the left to the board shown below on the right:</p>

<p class=MsoNormal align=center style='text-align:center'><img width=393
height=89 id="Picture 93" src="chapter7_files/image014.webp"></p>

<p class=MsoNormal>After the complete line is removed, the execution reaches
the end of the <span class=Literal>while</span> loop that started on line 419,
so the execution jumps back to the beginning of the loop. Note that at no point
when the line was being removed and the rows being pulled down that the <span
class=Literal>y</span> variable changed at all. So on the next iteration, the <span
class=Literal>y</span> variable is pointing to the same row as before.</p>

<p class=MsoNormal>This is needed because if there were two complete lines,
then the second complete line would have been pulled down and would also have
to be removed. The code will then remove this complete line, and then go to the
next iteration. It is only when there is not a completed line that the <span
class=Literal>y</span> variable is decremented on line 433. Once the <span
class=Literal>y</span> variable has been decremented all the way to <span
class=Literal>0</span>, the execution will exit the <span class=Literal>while</span>
loop.</p>

<h2><a name="_Toc316488691">Convert from Board Coordinates to Pixel Coordinates</a>
</h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>437. </span>def
convertToPixelCoords(boxx, boxy):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>438. </span>    <span
class=SourceCodeComment># Convert the given xy coordinates of the board to xy </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>439. </span>    <span
class=SourceCodeComment># coordinates of the</span> <span
class=SourceCodeComment>location on the screen.</span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>440. </span>    return
(XMARGIN + (boxx * BOXSIZE)), (TOPMARGIN + (boxy * BOXSIZE))</p>

</div>

<p class=MsoNormal>This helper function converts the board’s box coordinates to
pixel coordinates. This function works the same way to the other “convert
coordinates” functions used in the previous game programs.</p>

<h2><a name="_Toc316488692">Drawing a Box on the Board or Elsewhere on the Screen</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>443. </span>def
drawBox(boxx, boxy, color, pixelx=None, pixely=None):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>444. </span>    <span
class=SourceCodeComment># draw a single box (each tetromino piece has four
boxes)</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>445. </span>    <span
class=SourceCodeComment># at xy coordinates on the board. Or, if pixelx &amp;
pixely</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>446. </span>    <span
class=SourceCodeComment># are specified, draw to the pixel coordinates stored
in</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>447. </span>    <span
class=SourceCodeComment># pixelx &amp; pixely (this is used for the
&quot;Next&quot; piece).</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>448. </span>    if
color == BLANK:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>449. </span>        return</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>450. </span>    if
pixelx == None and pixely == None:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>451. </span>        pixelx,
pixely = convertToPixelCoords(boxx, boxy)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>452. </span>    pygame.draw.rect(DISPLAYSURF,
COLORS[color], (pixelx + 1, pixely + 1, BOXSIZE - 1, BOXSIZE - 1))</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>453. </span>    pygame.draw.rect(DISPLAYSURF,
LIGHTCOLORS[color], (pixelx + 1, pixely + 1, BOXSIZE - 4, BOXSIZE - 4))</p>

</div>

<p class=MsoNormal>The <span class=Literal>drawBox()</span> function draws a
single box on the screen. The function can receive <span class=Literal>boxx</span>
and <span class=Literal>boxy</span> parameters for board coordinates where the
box should be drawn. However, if the <span class=Literal>pixelx</span> and <span
class=Literal>pixely</span> parameters are specified, then these pixel
coordinates will override the <span class=Literal>boxx</span> and <span
class=Literal>boxy</span> parameters. The <span class=Literal>pixelx</span> and
<span class=Literal>pixely</span> parameters are used to draw the boxes of the
“Next” piece, which is not on the board.</p>

<p class=MsoNormal>If the <span class=Literal>pixelx</span> and <span
class=Literal>pixely</span> parameters are not set, then they will be set to <span
class=Literal>None</span> by default when the function first begins. Then the <span
class=Literal>if</span> statement on line 450 will overwrite the <span
class=Literal>None</span> values with the return values from <span
class=Literal>convertToPixelCoords()</span>. This call gets the pixel
coordinates of the board coordinates specified by <span class=Literal>boxx</span>
and <span class=Literal>boxy</span>.</p>

<p class=MsoNormal>The code won’t fill the entire box’s space with color. To
have a black outline in between the boxes of a piece, the <span class=Literal>left
</span>and <span class=Literal>top</span> parameters in the <span
class=Literal>pygame.draw.rect()</span> call have <span class=Literal>+ 1</span>
added to them and a <span class=Literal>- 1</span> is added to the <span
class=Literal>width</span> and <span class=Literal>height</span> parameters. In
order to draw the highlighted box, first the box is drawn with the darker color
on line 452. Then, a slightly smaller box is drawn on top of the darker box on
line 453.</p>

<h2><a name="_Toc316488693">Drawing Everything to the Screen</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>456. </span>def
drawBoard(board):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>457. </span>    <span
class=SourceCodeComment># draw the border around the board</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>458. </span>    pygame.draw.rect(DISPLAYSURF,
BORDERCOLOR, (XMARGIN - 3, TOPMARGIN - 7, (BOARDWIDTH * BOXSIZE) + 8,
(BOARDHEIGHT * BOXSIZE) + 8), 5)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>459. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>460. </span>    <span
class=SourceCodeComment># fill the background of the board</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>461. </span>    pygame.draw.rect(DISPLAYSURF,
BGCOLOR, (XMARGIN, TOPMARGIN, BOXSIZE * BOARDWIDTH, BOXSIZE * BOARDHEIGHT))</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>462. </span>    <span
class=SourceCodeComment># draw the individual boxes on the board</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>463. </span>    for
x in range(BOARDWIDTH):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>464. </span>        for
y in range(BOARDHEIGHT):</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>465. </span>            drawBox(x,
y, board[x][y])</p>

</div>

<p class=MsoNormal>The <span class=Literal>drawBoard()</span> function is
responsible for calling the drawing functions for the board’s border and all
the boxes on the board. First the board’s border is drawn on <span
class=Literal>DISPLAYSURF</span>, followed by the background color of the
board. Then a call to <span class=Literal>drawBox()</span> is made for each
space on the board. The <span class=Literal>drawBox()</span> function is smart
enough to leave out the box if <span class=Literal>board[x][y]</span> is set to
<span class=Literal>BLANK</span>.</p>

<h2><a name="_Toc316488694">Drawing the Score and Level Text</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>468. </span>def
drawStatus(score, level):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>469. </span>    <span
class=SourceCodeComment># draw the score text</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>470. </span>    scoreSurf
= BASICFONT.render('Score: %s' % score, True, TEXTCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>471. </span>    scoreRect
= scoreSurf.get_rect()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>472. </span>    scoreRect.topleft
= (WINDOWWIDTH - 150, 20)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>473. </span>    DISPLAYSURF.blit(scoreSurf,
scoreRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>474. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>475. </span>    <span
class=SourceCodeComment># draw the level text</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>476. </span>    levelSurf
= BASICFONT.render('Level: %s' % level, True, TEXTCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>477. </span>    levelRect
= levelSurf.get_rect()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>478. </span>    levelRect.topleft
= (WINDOWWIDTH - 150, 50)</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>479. </span>    DISPLAYSURF.blit(levelSurf,
levelRect)</p>

</div>

<p class=MsoNormal>The <span class=Literal>drawStatus()</span> function is
responsible for rendering the text for the “Score:” and “Level:” information
that appears in the upper right of the corner of the screen.</p>

<h2><a name="_Toc316488695">Drawing a Piece on the Board or Elsewhere on the
Screen</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>482. </span>def
drawPiece(piece, pixelx=None, pixely=None):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>483. </span>    shapeToDraw
= SHAPES[piece['shape']][piece['rotation']]</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>484. </span>    if
pixelx == None and pixely == None:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>485. </span>        <span
class=SourceCodeComment># if pixelx &amp; pixely hasn't been specified, use the
location stored in the piece data structure</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>486. </span>        pixelx,
pixely = convertToPixelCoords(piece['x'], piece['y'])</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>487. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>488. </span>    <span
class=SourceCodeComment># draw each of the blocks that make up the piece</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>489. </span>    for
x in range(TEMPLATEWIDTH):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>490. </span>        for
y in range(TEMPLATEHEIGHT):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>491. </span>            if
shapeToDraw[y][x] != BLANK:</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>492. </span>                drawBox(None,
None, piece['color'], pixelx + (x * BOXSIZE), pixely + (y * BOXSIZE))</p>

</div>

<p class=MsoNormal>The <span class=Literal>drawPiece()</span> function will
draw the boxes of a piece according to the piece data structure that is passed
to it. This function will be used to draw the falling piece and the “Next”
piece. Since the piece data structure will contain all of the shape, position,
rotation, and color information, nothing else besides the piece data structure needs
to be passed to the function.</p>

<p class=MsoNormal>However, the “Next” piece is not drawn on the board. In this
case, we ignore the position information stored inside the piece data structure
and instead let the caller of the <span class=Literal>drawPiece()</span>
function pass in arguments for the optional <span class=Literal>pixelx</span>
and <span class=Literal>pixely</span> parameters to specify where exactly on
the window the piece should be drawn.</p>

<p class=MsoNormal>If no <span class=Literal>pixelx</span> and <span
class=Literal>pixely</span> arguments are passed in, then lines 484 and 486
will overwrite those variables with the return values of <span class=Literal>convertToPixelCoords()</span>
call.</p>

<p class=MsoNormal>The nested <span class=Literal>for</span> loops on line 489
and 490 will then call <span class=Literal>drawBox()</span> for each box of the
piece that needs to be drawn.</p>

<h2><a name="_Toc316488696">Drawing the “Next” Piece</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>495. </span>def
drawNextPiece(piece):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>496. </span>    <span
class=SourceCodeComment># draw the &quot;next&quot; text</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>497. </span>    nextSurf
= BASICFONT.render('Next:', True, TEXTCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>498. </span>    nextRect
= nextSurf.get_rect()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>499. </span>    nextRect.topleft
= (WINDOWWIDTH - 120, 80)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>500. </span>    DISPLAYSURF.blit(nextSurf,
nextRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>501. </span>    <span
class=SourceCodeComment># draw the &quot;next&quot; piece</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>502. </span>    drawPiece(piece,
pixelx=WINDOWWIDTH-120, pixely=100)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>503. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>504. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>505. </span>if
__name__ == '__main__':</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>506. </span>    main()</p>

</div>

<p class=MsoNormal>The <span class=Literal>drawNextPiece()</span> draws the
“Next” piece in the upper right corner of the screen. It does this by calling
the <span class=Literal>drawPiece()</span> function and passing in arguments
for <span class=Literal>drawPiece()</span>’s <span class=Literal>pixelx</span>
and <span class=Literal>pixely</span> parameters.</p>

<p class=MsoNormal>That’s the last function. Line 505 and 506 are run after all
the function definitions have been executed, and then the <span class=Literal>main()</span>
function is called to begin the main part of the program.</p>

<h2><a name="_Toc316488697">Summary</a></h2>

<p class=MsoNormal>The Tetromino game (which is a clone of the more popular game,
“Tetris”) is pretty easy to explain to someone in English: “Blocks fall from
the top of a board, and the player moves and rotates them so that they form
complete lines. The complete lines disappear (giving the player points) and the
lines above them move down. The game keeps going until the blocks fill up the
entire board and the player loses.”</p>

<p class=MsoNormal>Explaining it in plain English is one thing, but when we
have to tell a computer exactly what to do there are many details we have to
fill in. The original Tetris game was designed and programmed one person, Alex
Pajitnov, in the Soviet Union in 1984. The game is simple, fun, and addictive.
It is one of the most popular video games ever made, and has sold 100 million
copies with many people creating their own clones and variations of it.</p>

<p class=MsoNormal>And it was all created by one person who knew how to
program.</p>

<p class=MsoNormal>With the right idea and some programming knowledge you can
create incredibly fun games. And with some practice, you will be able to turn
your game ideas into real programs that might become as popular as Tetris!</p>

<p class=MsoNormal>For additional programming practice, you can download buggy
versions of Tetromino from <span class=URL><a href="http://invpy.com/buggy/tetromino">http://invpy.com/buggy/tetromino</a></span>
and try to figure out how to fix the bugs.</p>

<p class=MsoNormal>There are also variations of the Tetromino game on the
book’s website. “Pentomino” is a version of this game with pieces made up of
five boxes. There is also “Tetromino for Idiots”, where all of the pieces are
made up of just one box.</p>

<p class=MsoNormal align=center style='text-align:center'><img width=286
height=226 id="Picture 94" src="chapter7_files/image015.webp"></p>

<p class=MsoNormal>These variations can be downloaded from:</p>

<p class=MsoListParagraphCxSpFirst style='text-indent:-.25in'><span class=URL><span
style='font-family:Symbol;text-decoration:none'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span class=URL><a href="http://invpy.com/pentomino.py">http://invpy.com/pentomino.py</a></span></p>

<p class=MsoListParagraphCxSpLast style='text-indent:-.25in'><span
style='font-family:Symbol;color:black'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span class=URL><a href="http://invpy.com/tetrominoforidiots.py">http://invpy.com/tetrominoforidiots.py</a></span></p>

<p class=MsoNormal>&nbsp;</p>

</div>

</body>

</html>
