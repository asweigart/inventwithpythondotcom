<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=UTF-8">
<meta name=Generator content="Microsoft Word 14 (filtered)">
<style>
<!--
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
h1
	{mso-style-link:"Heading 1 Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:15.0pt;
	margin-left:0in;
	border:none;
	padding:0in;
	font-size:36.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;
	font-weight:normal;}
h1.CxSpFirst
	{mso-style-link:"Heading 1 Char";
	margin:0in;
	margin-bottom:.0001pt;
	border:none;
	padding:0in;
	font-size:36.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;
	font-weight:normal;}
h1.CxSpMiddle
	{mso-style-link:"Heading 1 Char";
	margin:0in;
	margin-bottom:.0001pt;
	border:none;
	padding:0in;
	font-size:36.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;
	font-weight:normal;}
h1.CxSpLast
	{mso-style-link:"Heading 1 Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:15.0pt;
	margin-left:0in;
	border:none;
	padding:0in;
	font-size:36.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;
	font-weight:normal;}
h2
	{mso-style-link:"Heading 2 Char";
	margin-top:10.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Cambria","serif";
	color:black;}
h3
	{mso-style-link:"Heading 3 Char";
	margin-top:10.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:12.0pt;
	font-family:"Cambria","serif";
	color:#4F81BD;}
p.MsoToc1, li.MsoToc1, div.MsoToc1
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:0in;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoToc2, li.MsoToc2, div.MsoToc2
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:11.0pt;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoToc3, li.MsoToc3, div.MsoToc3
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:22.0pt;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoToc4, li.MsoToc4, div.MsoToc4
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:33.0pt;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoToc5, li.MsoToc5, div.MsoToc5
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:44.0pt;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoToc6, li.MsoToc6, div.MsoToc6
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:55.0pt;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoToc7, li.MsoToc7, div.MsoToc7
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:66.0pt;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoToc8, li.MsoToc8, div.MsoToc8
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:77.0pt;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoToc9, li.MsoToc9, div.MsoToc9
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:5.0pt;
	margin-left:88.0pt;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Calibri","sans-serif";}
p.MsoCommentText, li.MsoCommentText, div.MsoCommentText
	{mso-style-link:"Comment Text Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoHeader, li.MsoHeader, div.MsoHeader
	{mso-style-link:"Header Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoFooter, li.MsoFooter, div.MsoFooter
	{mso-style-link:"Footer Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoCaption, li.MsoCaption, div.MsoCaption
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";
	color:#4F81BD;
	font-weight:bold;}
p.MsoTitle, li.MsoTitle, div.MsoTitle
	{mso-style-link:"Title Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:15.0pt;
	margin-left:0in;
	border:none;
	padding:0in;
	font-size:48.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	color:black;
	letter-spacing:.25pt;}
p.MsoTitleCxSpFirst, li.MsoTitleCxSpFirst, div.MsoTitleCxSpFirst
	{mso-style-link:"Title Char";
	margin:0in;
	margin-bottom:.0001pt;
	border:none;
	padding:0in;
	font-size:48.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	color:black;
	letter-spacing:.25pt;}
p.MsoTitleCxSpMiddle, li.MsoTitleCxSpMiddle, div.MsoTitleCxSpMiddle
	{mso-style-link:"Title Char";
	margin:0in;
	margin-bottom:.0001pt;
	border:none;
	padding:0in;
	font-size:48.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	color:black;
	letter-spacing:.25pt;}
p.MsoTitleCxSpLast, li.MsoTitleCxSpLast, div.MsoTitleCxSpLast
	{mso-style-link:"Title Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:15.0pt;
	margin-left:0in;
	border:none;
	padding:0in;
	font-size:48.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	color:black;
	letter-spacing:.25pt;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;}
p.MsoCommentSubject, li.MsoCommentSubject, div.MsoCommentSubject
	{mso-style-link:"Comment Subject Char";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";
	font-weight:bold;}
p.MsoAcetate, li.MsoAcetate, div.MsoAcetate
	{mso-style-link:"Balloon Text Char";
	margin:0in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Tahoma","sans-serif";}
span.MsoPlaceholderText
	{color:gray;}
p.MsoRMPane, li.MsoRMPane, div.MsoRMPane
	{margin:0in;
	margin-bottom:.0001pt;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:.5in;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoListParagraphCxSpFirst, li.MsoListParagraphCxSpFirst, div.MsoListParagraphCxSpFirst
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoListParagraphCxSpMiddle, li.MsoListParagraphCxSpMiddle, div.MsoListParagraphCxSpMiddle
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:.5in;
	margin-bottom:.0001pt;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoListParagraphCxSpLast, li.MsoListParagraphCxSpLast, div.MsoListParagraphCxSpLast
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:.5in;
	line-height:115%;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
p.MsoTocHeading, li.MsoTocHeading, div.MsoTocHeading
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:15.0pt;
	margin-left:0in;
	border:none;
	padding:0in;
	font-size:36.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;}
p.MsoTocHeadingCxSpFirst, li.MsoTocHeadingCxSpFirst, div.MsoTocHeadingCxSpFirst
	{margin:0in;
	margin-bottom:.0001pt;
	border:none;
	padding:0in;
	font-size:36.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;}
p.MsoTocHeadingCxSpMiddle, li.MsoTocHeadingCxSpMiddle, div.MsoTocHeadingCxSpMiddle
	{margin:0in;
	margin-bottom:.0001pt;
	border:none;
	padding:0in;
	font-size:36.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;}
p.MsoTocHeadingCxSpLast, li.MsoTocHeadingCxSpLast, div.MsoTocHeadingCxSpLast
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:15.0pt;
	margin-left:0in;
	border:none;
	padding:0in;
	font-size:36.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;}
span.Heading1Char
	{mso-style-name:"Heading 1 Char";
	mso-style-link:"Heading 1";
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;}
span.Heading2Char
	{mso-style-name:"Heading 2 Char";
	mso-style-link:"Heading 2";
	font-family:"Cambria","serif";
	color:black;
	font-weight:bold;}
span.Heading3Char
	{mso-style-name:"Heading 3 Char";
	mso-style-link:"Heading 3";
	font-family:"Cambria","serif";
	color:#4F81BD;
	font-weight:bold;}
span.TitleChar
	{mso-style-name:"Title Char";
	mso-style-link:Title;
	font-family:"Franklin Gothic Demi","sans-serif";
	color:black;
	letter-spacing:.25pt;}
span.Definition
	{mso-style-name:Definition;
	font-weight:bold;}
span.HeaderChar
	{mso-style-name:"Header Char";
	mso-style-link:Header;
	font-family:"Times New Roman","serif";}
span.FooterChar
	{mso-style-name:"Footer Char";
	mso-style-link:Footer;
	font-family:"Times New Roman","serif";}
span.BalloonTextChar
	{mso-style-name:"Balloon Text Char";
	mso-style-link:"Balloon Text";
	font-family:"Tahoma","sans-serif";}
span.TableHeading
	{mso-style-name:"Table Heading";
	font-weight:bold;}
p.ChapterTitle, li.ChapterTitle, div.ChapterTitle
	{mso-style-name:"Chapter Title";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:15.0pt;
	margin-left:0in;
	border:none;
	padding:0in;
	font-size:36.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;}
p.ChapterTitleCxSpFirst, li.ChapterTitleCxSpFirst, div.ChapterTitleCxSpFirst
	{mso-style-name:"Chapter TitleCxSpFirst";
	margin:0in;
	margin-bottom:.0001pt;
	border:none;
	padding:0in;
	font-size:36.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;}
p.ChapterTitleCxSpMiddle, li.ChapterTitleCxSpMiddle, div.ChapterTitleCxSpMiddle
	{mso-style-name:"Chapter TitleCxSpMiddle";
	margin:0in;
	margin-bottom:.0001pt;
	border:none;
	padding:0in;
	font-size:36.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;}
p.ChapterTitleCxSpLast, li.ChapterTitleCxSpLast, div.ChapterTitleCxSpLast
	{mso-style-name:"Chapter TitleCxSpLast";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:15.0pt;
	margin-left:0in;
	border:none;
	padding:0in;
	font-size:36.0pt;
	font-family:"Franklin Gothic Demi","sans-serif";
	font-variant:small-caps;
	color:black;
	letter-spacing:.25pt;}
span.URL
	{mso-style-name:URL;
	color:black;
	text-decoration:underline;}
p.SourceCodeFeatured, li.SourceCodeFeatured, div.SourceCodeFeatured
	{mso-style-name:"Source Code \(Featured\)";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0in;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Courier";}
p.SourceCodeFeaturedCxSpFirst, li.SourceCodeFeaturedCxSpFirst, div.SourceCodeFeaturedCxSpFirst
	{mso-style-name:"Source Code \(Featured\)CxSpFirst";
	margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Courier";}
p.SourceCodeFeaturedCxSpMiddle, li.SourceCodeFeaturedCxSpMiddle, div.SourceCodeFeaturedCxSpMiddle
	{mso-style-name:"Source Code \(Featured\)CxSpMiddle";
	margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Courier";}
p.SourceCodeFeaturedCxSpLast, li.SourceCodeFeaturedCxSpLast, div.SourceCodeFeaturedCxSpLast
	{mso-style-name:"Source Code \(Featured\)CxSpLast";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0in;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Courier";}
p.SampleRun, li.SampleRun, div.SampleRun
	{mso-style-name:"Sample Run";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0in;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Courier";
	color:#1F497D;}
p.SampleRunCxSpFirst, li.SampleRunCxSpFirst, div.SampleRunCxSpFirst
	{mso-style-name:"Sample RunCxSpFirst";
	margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Courier";
	color:#1F497D;}
p.SampleRunCxSpMiddle, li.SampleRunCxSpMiddle, div.SampleRunCxSpMiddle
	{mso-style-name:"Sample RunCxSpMiddle";
	margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Courier";
	color:#1F497D;}
p.SampleRunCxSpLast, li.SampleRunCxSpLast, div.SampleRunCxSpLast
	{mso-style-name:"Sample RunCxSpLast";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0in;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Courier";
	color:#1F497D;}
span.SampleRunResponse
	{mso-style-name:"Sample Run Response";
	color:black;}
span.SourceCodeComment
	{mso-style-name:"Source Code Comment";
	color:#7F7F7F;}
span.SourceLineNumber
	{mso-style-name:"Source Line Number";
	color:gray;}
p.CodeExample, li.CodeExample, div.CodeExample
	{mso-style-name:"Code Example";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Courier";}
p.CodeExampleCxSpFirst, li.CodeExampleCxSpFirst, div.CodeExampleCxSpFirst
	{mso-style-name:"Code ExampleCxSpFirst";
	margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Courier";}
p.CodeExampleCxSpMiddle, li.CodeExampleCxSpMiddle, div.CodeExampleCxSpMiddle
	{mso-style-name:"Code ExampleCxSpMiddle";
	margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Courier";}
p.CodeExampleCxSpLast, li.CodeExampleCxSpLast, div.CodeExampleCxSpLast
	{mso-style-name:"Code ExampleCxSpLast";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Courier";}
span.Literal
	{mso-style-name:Literal;
	font-family:Courier;}
p.SourceCodeHeadline, li.SourceCodeHeadline, div.SourceCodeHeadline
	{mso-style-name:"Source Code Headline";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0in;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Calibri","sans-serif";
	font-weight:bold;}
p.SourceCodeHeadlineCxSpFirst, li.SourceCodeHeadlineCxSpFirst, div.SourceCodeHeadlineCxSpFirst
	{mso-style-name:"Source Code HeadlineCxSpFirst";
	margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Calibri","sans-serif";
	font-weight:bold;}
p.SourceCodeHeadlineCxSpMiddle, li.SourceCodeHeadlineCxSpMiddle, div.SourceCodeHeadlineCxSpMiddle
	{mso-style-name:"Source Code HeadlineCxSpMiddle";
	margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Calibri","sans-serif";
	font-weight:bold;}
p.SourceCodeHeadlineCxSpLast, li.SourceCodeHeadlineCxSpLast, div.SourceCodeHeadlineCxSpLast
	{mso-style-name:"Source Code HeadlineCxSpLast";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0in;
	line-height:115%;
	border:none;
	padding:0in;
	font-size:12.0pt;
	font-family:"Calibri","sans-serif";
	font-weight:bold;}
span.CommentTextChar
	{mso-style-name:"Comment Text Char";
	mso-style-link:"Comment Text";
	font-family:"Times New Roman","serif";}
span.CommentSubjectChar
	{mso-style-name:"Comment Subject Char";
	mso-style-link:"Comment Subject";
	font-family:"Times New Roman","serif";
	font-weight:bold;}
span.XXX
	{mso-style-name:XXX;
	font-family:Courier;
	color:red;}
p.TableListing, li.TableListing, div.TableListing
	{mso-style-name:"Table Listing";
	margin:0in;
	margin-bottom:.0001pt;
	text-align:center;
	font-size:12.0pt;
	font-family:"Times New Roman","serif";}
span.msoIns
	{mso-style-name:"";
	text-decoration:underline;
	color:teal;}
span.msoDel
	{mso-style-name:"";
	text-decoration:line-through;
	color:red;}
.MsoChpDefault
	{font-family:"Calibri","sans-serif";}
.MsoPapDefault
	{margin-bottom:10.0pt;
	line-height:115%;}
@page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>

</head>

<body lang=EN-US link=blue vlink=purple style="background-color: #fffeee;">


<div style="background-color: #eeeddd; float: right; height: 310px; font-family: sans-serif;" id="otherbooks">Other programming books by Al Sweigart:<br>
  <a href="#" onclick="document.getElementById('otherbooks').outerHTML='';" style="vertical-align: top;">X</a>

  <a target="_blank" href="https://www.amazon.com/gp/product/1593275994/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=1593275994&linkCode=as2&tag=playwithpyth-20&linkId=385b77199fa1e9f4fd21652cc57dab33" onclick="javascript: pageTracker._trackPageview('/affiliate_chapters_automate.link');"><img src="/images/cover_automate_thumb.webp" style="height: 200px; border: solid black 1px;" /></a>
  <a target="_blank" href="https://www.amazon.com/gp/product/1503212300?ie=UTF8&amp;tag=playwithpyth-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=1503212300" onclick="javascript: pageTracker._trackPageview('/affiliate_chapters_invent.link');"><img src="/images/cover_invent4th_thumb.webp" style="height: 200px; border: solid black 1px;" /></a>
  <a target="_blank" href="https://www.amazon.com/Making-Games-Python-Pygame-Sweigart/dp/1469901730?ie=UTF8&amp;tag=playwithpyth-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=1469901730" onclick="javascript: pageTracker._trackPageview('/affiliate_chapters_pygame.link');"><img src="/images/cover_makinggames_thumb.webp" style="height: 200px; border: solid black 1px; /"></a>
  <a target="_blank" href="https://www.amazon.com/gp/product/1482614375/ref=as_li_qf_sp_asin_tl?ie=UTF8&amp;camp=1789&amp;creative=9325&amp;creativeASIN=1482614375&amp;linkCode=as2&amp;tag=playwithpyth-20" onclick="javascript: pageTracker._trackPageview('/affiliate_chapters_hacking.link');"><img src="/images/cover_crackingcodes_thumb.webp" style="height: 200px; border: solid black 1px;" /></a>
  <a target="_blank" href="https://www.amazon.com/gp/product/1593277628/ref=as_li_tl?ie=UTF8&camp=1789&creative=9325&creativeASIN=1593277628&linkCode=as2&tag=playwithpyth-20&linkId=0f1bd157c25d2e97db13d6434e5476a8"><img src="/images/cover_scratchprogrammingplayground_thumb.webp" style="height: 200px; border: solid black 1px;" /></a>
  <br />
  <a href="https://www.udemy.com/automate/?couponCode=INVENT_WITH_PYTHON">Use this link to get 80%% off the Automate the Boring Stuff online video course.</a><br />
  <a href="https://www.patreon.com/AlSweigart">Support me on Patreon</a>
</div>




<div class=WordSection1>

<div style='border:none;border-bottom:solid #4F81BD 1.0pt;padding:0in 0in 4.0pt 0in'>

<h1><a name="_Toc316488736"><span style='font-variant:normal !important;
text-transform:uppercase'>Chapter 9 – Star Pusher</span></a></h1>

</div>

<p class=MsoNormal align=center style='text-align:center'><img width=249
height=195 id="Picture 33" src="chapter9_files/image001.webp">          <img
width=247 height=193 id="Picture 13" src="chapter9_files/image002.webp"></p>

<h2><a name="_Toc316488737">How to Play Star Pusher</a></h2>

<p class=MsoNormal>Star Pusher is a Sokoban or “Box Pusher” clone. The player
is in a room with several stars. There are star marks on the grounds of some of
the tile sprites in the room. The player must figure out how to push the stars
on top of the tiles with star marks. The player cannot push a star if there is
a wall or another star behind it. The player cannot pull stars, so if a star
gets pushed into a corner, the player will have to restart the level. When all
of the stars have been pushed onto star-marked floor tiles, the level is
complete and the next level starts.</p>

<p class=MsoNormal>Each level is made up of a 2D grid of tile images. <span
class=Definition>Tile sprites</span> are images of the same size that can be
placed next to each other to form more complex images. With a few floor and
wall tiles, we can create levels of many interesting shapes and sizes.</p>

<p class=MsoNormal>The level files are not included in the source code.
Instead, you can either create the level files yourself or download them. A
level file with 201 levels can be downloaded from <span class=URL><a href="http://invpy.com/starPusherLevels.txt">http://invpy.com/starPusherLevels.txt</a></span>.
When you run the Star Pusher program, make sure that this level file is in the
same folder as the <em>starpusher.py</em> file. Otherwise you will get this
error message: <span class=Literal>AssertionError: Cannot find the level file:
starPusherLevels.txt</span></p>

<p class=MsoNormal>The level designs were originally made David W. Skinner. You
can download more puzzles from his website at <span class=URL><a href="http://sneezingtiger.com/sokoban/levels.html">http://sneezingtiger.com/sokoban/levels.html</a></span>.</p>

<h2><a name="_Toc316488738">Source Code to Star Pusher</a></h2>

<p class=MsoNormal>This source code can be downloaded from <span class=URL><a href="http://invpy.com/starpusher.py">http://invpy.com/starpusher.py</a></span>.
If you get any error messages, look at the line number that is mentioned in the
error message and check your code for any typos. You can also copy and paste
your code into the web form at <span class=URL><a href="http://invpy.com/diff/starpusher">http://invpy.com/diff/starpusher</a></span>
to see if the differences between your code and the code in the book.</p>

<p class=MsoNormal>The level file can be downloaded from <span class=URL><a href="http://invpy.com/starPusherLevels.txt">http://invpy.com/starPusherLevels.txt</a></span>.
The tiles can be downloaded from <span class=URL><a href="http://invpy.com/starPusherImages.zip">http://invpy.com/starPusherImages.zip</a></span>.</p>

<p class=MsoNormal>Also, just like the squirrel, grass, and enemy “objects” in
the Squirrel Eat Squirrel game, when I say “map objects”, “game state objects”,
or “level objects” in this chapter, I do not mean objects in the Object-Oriented
Programming sense. These “objects” are really just dictionary values, but it is
easier to refer to them as objects since they represent things in the game
world.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst>  <span class=SourceLineNumber>1. </span><span
class=SourceCodeComment># Star Pusher (a Sokoban clone)</span></p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>2. </span><span
class=SourceCodeComment># By Al Sweigart al@inventwithpython.com</span></p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>3. </span><span
class=SourceCodeComment># http://inventwithpython.com/pygame</span></p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>4. </span><span
class=SourceCodeComment># Creative Commons BY-NC-SA 3.0 US</span></p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>5. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>6. </span>import
random, sys, copy, os, pygame</p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>7. </span>from
pygame.locals import *</p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>8. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>9. </span>FPS
= 30 <span class=SourceCodeComment># frames per second to update the screen</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>10. </span>WINWIDTH
= 800 <span class=SourceCodeComment># width of the program's window, in pixels</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>11. </span>WINHEIGHT
= 600 <span class=SourceCodeComment># height in pixels</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>12. </span>HALF_WINWIDTH
= int(WINWIDTH / 2)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>13. </span>HALF_WINHEIGHT
= int(WINHEIGHT / 2)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>14. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>15. </span><span
class=SourceCodeComment># The total width and height of each tile in pixels.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>16. </span>TILEWIDTH
= 50</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>17. </span>TILEHEIGHT
= 85</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>18. </span>TILEFLOORHEIGHT
= 45</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>19. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>20. </span>CAM_MOVE_SPEED
= 5 <span class=SourceCodeComment># how many pixels per frame the camera moves</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>21. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>22. </span><span
class=SourceCodeComment># The percentage of outdoor tiles that have additional</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>23. </span><span
class=SourceCodeComment># decoration on them, such as a tree or rock.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>24. </span>OUTSIDE_DECORATION_PCT
= 20</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>25. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>26. </span>BRIGHTBLUE
= (  0, 170, 255)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>27. </span>WHITE     
= (255, 255, 255)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>28. </span>BGCOLOR
= BRIGHTBLUE</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>29. </span>TEXTCOLOR
= WHITE</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>30. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>31. </span>UP
= 'up'</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>32. </span>DOWN
= 'down'</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>33. </span>LEFT
= 'left'</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>34. </span>RIGHT
= 'right'</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber> 35.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber> 36.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber> 37. </span>def
main():</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>38. </span>    global
FPSCLOCK, DISPLAYSURF, IMAGESDICT, TILEMAPPING, OUTSIDEDECOMAPPING, BASICFONT,
PLAYERIMAGES, currentImage</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>39. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>40. </span>    <span
class=SourceCodeComment># Pygame initialization and basic set up of the global variables.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>41. </span>    pygame.init()</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>42. </span>    FPSCLOCK
= pygame.time.Clock()</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>43. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>44. </span>    <span
class=SourceCodeComment># Because the Surface object stored in DISPLAYSURF was
returned</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>45. </span>    <span
class=SourceCodeComment># from the pygame.display.set_mode() function, this is
the</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>46. </span>    <span
class=SourceCodeComment># Surface object that is drawn to the actual computer
screen</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>47. </span>    <span
class=SourceCodeComment># when pygame.display.update() is called.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>48. </span>    DISPLAYSURF
= pygame.display.set_mode((WINWIDTH, WINHEIGHT))</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>49. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>50. </span>    pygame.display.set_caption('Star
Pusher')</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>51. </span>    BASICFONT
= pygame.font.Font('freesansbold.ttf', 18)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber> 52.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber> 53. </span>    <span
class=SourceCodeComment># A global dict value that will contain all the Pygame</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>54. </span>    <span
class=SourceCodeComment># Surface objects returned by pygame.image.load().</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>55. </span>    IMAGESDICT
= {'uncovered goal': pygame.image.load('RedSelector.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>56. </span>                  'covered
goal': pygame.image.load('Selector.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>57. </span>                  'star':
pygame.image.load('Star.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>58. </span>                  'corner':
pygame.image.load('Wall Block Tall.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>59. </span>                  'wall':
pygame.image.load('Wood Block Tall.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>60. </span>                  'inside
floor': pygame.image.load('Plain Block.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>61. </span>                  'outside
floor': pygame.image.load('Grass Block.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>62. </span>                  'title':
pygame.image.load('star_title.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>63. </span>                  'solved':
pygame.image.load('star_solved.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>64. </span>                  'princess':
pygame.image.load('princess.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>65. </span>                  'boy':
pygame.image.load('boy.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>66. </span>                  'catgirl':
pygame.image.load('catgirl.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>67. </span>                  'horngirl':
pygame.image.load('horngirl.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>68. </span>                  'pinkgirl':
pygame.image.load('pinkgirl.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>69. </span>                  'rock':
pygame.image.load('Rock.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>70. </span>                  'short
tree': pygame.image.load('Tree_Short.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>71. </span>                  'tall
tree': pygame.image.load('Tree_Tall.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>72. </span>                  'ugly
tree': pygame.image.load('Tree_Ugly.png')}</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>73. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber> 74. </span>    <span
class=SourceCodeComment># These dict values are global, and map the character
that appears</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>75. </span>    <span
class=SourceCodeComment># in the level file to the Surface object it
represents.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>76. </span>    TILEMAPPING
= {'x': IMAGESDICT['corner'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>77. </span>                   '#':
IMAGESDICT['wall'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>78. </span>                   'o':
IMAGESDICT['inside floor'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>79. </span>                   '
': IMAGESDICT['outside floor']}</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber> 80. </span>    OUTSIDEDECOMAPPING
= {'1': IMAGESDICT['rock'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>81. </span>                          '2':
IMAGESDICT['short tree'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>82. </span>                          '3':
IMAGESDICT['tall tree'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>83. </span>                          '4':
IMAGESDICT['ugly tree']}</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>84.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber> 85. </span>    <span
class=SourceCodeComment># PLAYERIMAGES is a list of all possible characters the
player can be.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>86. </span>    <span
class=SourceCodeComment># currentImage is the index of the player's current
player image.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber> 87. </span>    currentImage
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>88. </span>    PLAYERIMAGES
= [IMAGESDICT['princess'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>89. </span>                    IMAGESDICT['boy'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>90. </span>                    IMAGESDICT['catgirl'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>91. </span>                    IMAGESDICT['horngirl'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>92. </span>                    IMAGESDICT['pinkgirl']]</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber> 93.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber> 94. </span>    startScreen()
<span class=SourceCodeComment># show the title screen until the user presses a
key</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>95. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>96. </span>    <span
class=SourceCodeComment># Read in the levels from the text file. See the
readLevelsFile() for</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>97. </span>    <span
class=SourceCodeComment># details on the format of this file and how to make
your own levels.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>98. </span>    levels
= readLevelsFile('starPusherLevels.txt')</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber> 99. </span>    currentLevelIndex
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>100.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>101. </span>    <span
class=SourceCodeComment># The main game loop. This loop runs a single level,
when the user</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>102. </span>    <span
class=SourceCodeComment># finishes that level, the next/previous level is
loaded.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>103. </span>    while
True: <span class=SourceCodeComment># main game loop</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>104. </span>        <span
class=SourceCodeComment># Run the level to actually start playing the game:</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>105. </span>        result
= runLevel(levels, currentLevelIndex)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>106.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>107. </span>        if
result in ('solved', 'next'):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>108. </span>            <span
class=SourceCodeComment># Go to the next level.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>109. </span>            currentLevelIndex
+= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>110. </span>            if
currentLevelIndex &gt;= len(levels):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>111. </span>                <span
class=SourceCodeComment># If there are no more levels, go back to the first
one.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>112. </span>                currentLevelIndex
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>113. </span>        elif
result == 'back':</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>114. </span>            <span
class=SourceCodeComment># Go to the previous level.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>115. </span>            currentLevelIndex
-= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>116. </span>            if
currentLevelIndex &lt; 0:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>117. </span>                <span
class=SourceCodeComment># If there are no previous levels, go to the last one.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>118. </span>                currentLevelIndex
= len(levels)-1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>119. </span>        elif
result == 'reset':</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>120. </span>            pass
<span class=SourceCodeComment># Do nothing. Loop re-calls runLevel() to reset
the level</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>121.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>122.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>123. </span>def
runLevel(levels, levelNum):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>124.</span>    
global currentImage</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>125.</span>    
levelObj = levels[levelnum]</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>126. </span>    mapObj
= decorateMap(levelObj['mapObj'], levelObj['startState']['player'])</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>127. </span>    gameStateObj
= copy.deepcopy(levelObj['startState'])</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>128. </span>    mapNeedsRedraw
= True <span class=SourceCodeComment># set to True to call drawMap()</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>129. </span>    levelSurf
= BASICFONT.render('Level %s of %s' % (levelObj['levelNum'] + 1,
totalNumOfLevels), 1, TEXTCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>130. </span>    levelRect
= levelSurf.get_rect()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>131. </span>    levelRect.bottomleft
= (20, WINHEIGHT - 35)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>132. </span>    mapWidth
= len(mapObj) * TILEWIDTH</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>133. </span>    mapHeight
= (len(mapObj[0]) - 1) * (TILEHEIGHT - TILEFLOORHEIGHT) + TILEHEIGHT</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>134. </span>    MAX_CAM_X_PAN
= abs(HALF_WINHEIGHT - int(mapHeight / 2)) + TILEWIDTH</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>135. </span>    MAX_CAM_Y_PAN
= abs(HALF_WINWIDTH - int(mapWidth / 2)) + TILEHEIGHT</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>136. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>137. </span>    levelIsComplete
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>138. </span>    <span
class=SourceCodeComment># Track how much the camera has moved:</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>139. </span>    cameraOffsetX
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>140. </span>    cameraOffsetY
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>141. </span>    <span
class=SourceCodeComment># Track if the keys to move the camera are being held
down:</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>142. </span>    cameraUp
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>143. </span>    cameraDown
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>144. </span>    cameraLeft
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>145. </span>    cameraRight
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>146. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>147. </span>    while
True: <span class=SourceCodeComment># main game loop</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>148. </span>        <span
class=SourceCodeComment># Reset these variables:</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>149. </span>        playerMoveTo
= None</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>150. </span>        keyPressed
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>151. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>152. </span>        for
event in pygame.event.get(): <span class=SourceCodeComment># event handling
loop</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>153. </span>            if
event.type == QUIT:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>154. </span>                <span
class=SourceCodeComment># Player clicked the &quot;X&quot; at the corner of the
window.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>155. </span>                terminate()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>156. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>157. </span>            elif
event.type == KEYDOWN:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>158. </span>                <span
class=SourceCodeComment># Handle key presses</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>159. </span>                keyPressed
= True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>160. </span>                if
event.key == K_LEFT:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>161. </span>                    playerMoveTo
= LEFT</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>162. </span>                elif
event.key == K_RIGHT:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>163. </span>                    playerMoveTo
= RIGHT</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>164. </span>                elif
event.key == K_UP:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>165. </span>                    playerMoveTo
= UP</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>166. </span>                elif
event.key == K_DOWN:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>167. </span>                    playerMoveTo
= DOWN</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>168. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>169. </span>                <span
class=SourceCodeComment># Set the camera move mode.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>170. </span>                elif
event.key == K_a:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>171. </span>                    cameraLeft
= True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>172. </span>                elif
event.key == K_d:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>173. </span>                    cameraRight
= True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>174. </span>                elif
event.key == K_w:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>175. </span>                    cameraUp
= True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>176. </span>                elif
event.key == K_s:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>177. </span>                    cameraDown
= True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>178. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>179. </span>                elif
event.key == K_n:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>180. </span>                    return
'next'</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>181. </span>                elif
event.key == K_b:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>182. </span>                    return
'back'</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>183. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>184. </span>                elif
event.key == K_ESCAPE:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>185. </span>                    terminate()
<span class=SourceCodeComment># Esc key quits.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>186. </span>                elif
event.key == K_BACKSPACE:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>187. </span>                    return
'reset' <span class=SourceCodeComment># Reset the level.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>188. </span>                elif
event.key == K_p:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>189. </span>                    <span
class=SourceCodeComment># Change the player image to the next one.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>190. </span>                    currentImage
+= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>191. </span>                    if
currentImage &gt;= len(PLAYERIMAGES):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>192. </span>                        <span
class=SourceCodeComment># After the last player image, use the first one.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>193. </span>                        currentImage
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>194. </span>                    mapNeedsRedraw
= True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>195. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>196. </span>            elif
event.type == KEYUP:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>197. </span>                <span
class=SourceCodeComment># Unset the camera move mode.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>198. </span>                if
event.key == K_a:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>199. </span>                    cameraLeft
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>200. </span>                elif
event.key == K_d:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>201. </span>                    cameraRight
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>202. </span>                elif
event.key == K_w:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>203. </span>                    cameraUp
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>204. </span>                elif
event.key == K_s:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>205. </span>                    cameraDown
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>206. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>207. </span>        if
playerMoveTo != None and not levelIsComplete:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>208. </span>            <span
class=SourceCodeComment># If the player pushed a key to move, make the move</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>209. </span>            <span
class=SourceCodeComment># (if possible) and push any stars that are pushable.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>210. </span>            moved
= makeMove(mapObj, gameStateObj, playerMoveTo)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>211. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>212. </span>            if
moved:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>213. </span>                <span
class=SourceCodeComment># increment the step counter.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>214. </span>                gameStateObj['stepCounter']
+= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>215. </span>                mapNeedsRedraw
= True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>216. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>217. </span>            if
isLevelFinished(levelObj, gameStateObj):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>218. </span>                <span
class=SourceCodeComment># level is solved, we should show the
&quot;Solved!&quot; image.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>219. </span>                levelIsComplete
= True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>220. </span>                keyPressed
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>221. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>222. </span>        DISPLAYSURF.fill(BGCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>223. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>224. </span>        if
mapNeedsRedraw:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>225. </span>            mapSurf
= drawMap(mapObj, gameStateObj, levelObj['goals'])</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>226. </span>            mapNeedsRedraw
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>227. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>228. </span>        if
cameraUp and cameraOffsetY &lt; MAX_CAM_X_PAN:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>229. </span>            cameraOffsetY
+= CAM_MOVE_SPEED</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>230. </span>        elif
cameraDown and cameraOffsetY &gt; -MAX_CAM_X_PAN:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>231. </span>            cameraOffsetY
-= CAM_MOVE_SPEED</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>232. </span>        if
cameraLeft and cameraOffsetX &lt; MAX_CAM_Y_PAN:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>233. </span>            cameraOffsetX
+= CAM_MOVE_SPEED</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>234. </span>        elif
cameraRight and cameraOffsetX &gt; -MAX_CAM_Y_PAN:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>235. </span>            cameraOffsetX
-= CAM_MOVE_SPEED</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>236. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>237. </span>        <span
class=SourceCodeComment># Adjust mapSurf's Rect object based on the camera
offset.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>238. </span>        mapSurfRect
= mapSurf.get_rect()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>239. </span>        mapSurfRect.center
= (HALF_WINWIDTH + cameraOffsetX, HALF_WINHEIGHT + cameraOffsetY)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>240. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>241. </span>        <span
class=SourceCodeComment># Draw mapSurf to the DISPLAYSURF Surface object.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>242. </span>        DISPLAYSURF.blit(mapSurf,
mapSurfRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>243. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>244. </span>        DISPLAYSURF.blit(levelSurf,
levelRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>245. </span>        stepSurf
= BASICFONT.render('Steps: %s' % (gameStateObj['stepCounter']), 1, TEXTCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>246. </span>        stepRect
= stepSurf.get_rect()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>247. </span>        stepRect.bottomleft
= (20, WINHEIGHT - 10)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>248. </span>        DISPLAYSURF.blit(stepSurf,
stepRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>249. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>250. </span>        if
levelIsComplete:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>251. </span>            <span
class=SourceCodeComment># is solved, show the &quot;Solved!&quot; image until
the player</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>252. </span>            <span
class=SourceCodeComment># has pressed a key.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>253. </span>            solvedRect
= IMAGESDICT['solved'].get_rect()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>254. </span>            solvedRect.center
= (HALF_WINWIDTH, HALF_WINHEIGHT)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>255. </span>            DISPLAYSURF.blit(IMAGESDICT['solved'],
solvedRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>256. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>257. </span>            if
keyPressed:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>258. </span>                return
'solved'</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>259. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>260. </span>        pygame.display.update()
<span class=SourceCodeComment># draw DISPLAYSURF to the screen.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>261. </span>        FPSCLOCK.tick()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>262.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>263.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>274. </span>def
decorateMap(mapObj, startxy):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>275. </span>    <span
class=SourceCodeComment>&quot;&quot;&quot;Makes a copy of the given map object
and modifies it.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>276. </span>    <span
class=SourceCodeComment>Here is what is done to it:</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>277. </span>        <span
class=SourceCodeComment>* Walls that are corners are turned into corner pieces.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>278. </span>        <span
class=SourceCodeComment>* The outside/inside floor tile distinction is made.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>279. </span>        <span
class=SourceCodeComment>* Tree/rock decorations are randomly added to the
outside tiles.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>280. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>281. </span>    <span
class=SourceCodeComment>Returns the decorated map object.&quot;&quot;&quot;</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>282. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>283. </span>    startx,
starty = startxy <span class=SourceCodeComment># Syntactic sugar</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>284. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>285. </span>    <span
class=SourceCodeComment># Copy the map object so we don't modify the original
passed</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>286. </span>    mapObjCopy
= copy.deepcopy(mapObj)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>287. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>288. </span>    <span
class=SourceCodeComment># Remove the non-wall characters from the map data</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>289. </span>    for
x in range(len(mapObjCopy)):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>290. </span>        for
y in range(len(mapObjCopy[0])):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>291. </span>            if
mapObjCopy[x][y] in ('$', '.', '@', '+', '*'):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>292. </span>                mapObjCopy[x][y]
= ' '</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>293. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>294. </span>    <span
class=SourceCodeComment># Flood fill to determine inside/outside floor tiles.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>295. </span>    floodFill(mapObjCopy,
startx, starty, ' ', 'o')</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>296. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>297. </span>    <span
class=SourceCodeComment># Convert the adjoined walls into corner tiles.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>298. </span>    for
x in range(len(mapObjCopy)):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>299. </span>        for
y in range(len(mapObjCopy[0])):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>300.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>301. </span>            if
mapObjCopy[x][y] == '#':</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>302. </span>                if
(isWall(mapObjCopy, x, y-1) and isWall(mapObjCopy, x+1, y)) or \</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>303. </span>                   (isWall(mapObjCopy,
x+1, y) and isWall(mapObjCopy, x, y+1)) or \</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>304. </span>                   (isWall(mapObjCopy,
x, y+1) and isWall(mapObjCopy, x-1, y)) or \</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>305. </span>                   (isWall(mapObjCopy,
x-1, y) and isWall(mapObjCopy, x, y-1)):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>306. </span>                    mapObjCopy[x][y]
= 'x'</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>307.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>308. </span>            elif
mapObjCopy[x][y] == ' ' and random.randint(0, 99) &lt; OUTSIDE_DECORATION_PCT:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>309. </span>                mapObjCopy[x][y]
= random.choice(list(OUTSIDEDECOMAPPING.keys()))</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>310. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>311. </span>    return
mapObjCopy<span class=SourceLineNumber> </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>312.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>313.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>314. </span>def
isBlocked(mapObj, gameStateObj, x, y):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>315. </span>    <span
class=SourceCodeComment>&quot;&quot;&quot;Returns True if the (x, y) position
on the map is</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>316. </span>    <span
class=SourceCodeComment>blocked by a wall or star, otherwise return
False.&quot;&quot;&quot;</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>317.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>318. </span>    if
isWall(mapObj, x, y):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>319. </span>        return
True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>320.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>321. </span>    elif
x &lt; 0 or x &gt;= len(mapObj) or y &lt; 0 or y &gt;= len(mapObj[x]):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>322. </span>        return
True <span class=SourceCodeComment># x and y aren't actually on the map.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>323.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>324. </span>    elif
(x, y) in gameStateObj['stars']:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>325. </span>        return
True <span class=SourceCodeComment># a star is blocking</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>326. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>327. </span>    return
False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>328.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>329.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>330. </span>def
makeMove(mapObj, gameStateObj, playerMoveTo):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>331. </span>    <span
class=SourceCodeComment>&quot;&quot;&quot;Given a map and game state object,
see if it is possible for the</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>332. </span>    <span
class=SourceCodeComment>player to make the given move. If it is, then change
the player's</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>333. </span>    <span
class=SourceCodeComment>position (and the position of any pushed star). If not,
do nothing.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>334. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>335. </span>    <span
class=SourceCodeComment>Returns True if the player moved, otherwise
False.&quot;&quot;&quot;</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>336. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>337. </span>    <span
class=SourceCodeComment># Make sure the player can move in the direction they
want.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>338. </span>    playerx,
playery = gameStateObj['player']</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>339. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>340. </span>    <span
class=SourceCodeComment># This variable is &quot;syntactic sugar&quot;. Typing
&quot;stars&quot; is more</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>341. </span>    <span
class=SourceCodeComment># readable than typing
&quot;gameStateObj['stars']&quot; in our code.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>342. </span>    stars
= gameStateObj['stars']</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>343. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>344. </span>    <span
class=SourceCodeComment># The code for handling each of the directions is so
similar aside</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>345. </span>    <span
class=SourceCodeComment># from adding or subtracting 1 to the x/y coordinates.
We can</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>346. </span>    <span
class=SourceCodeComment># simplify it by using the xOffset and yOffset
variables.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>347. </span>    if
playerMoveTo == UP:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>348. </span>        xOffset
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>349. </span>        yOffset
= -1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>350. </span>    elif
playerMoveTo == RIGHT:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>351. </span>        xOffset
= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>352. </span>        yOffset
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>353. </span>    elif
playerMoveTo == DOWN:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>354. </span>        xOffset
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>355. </span>        yOffset
= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>356. </span>    elif
playerMoveTo == LEFT:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>357. </span>        xOffset
= -1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>358. </span>        yOffset
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>359. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>360. </span>    <span
class=SourceCodeComment># See if the player can move in that direction.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>361. </span>    if
isWall(mapObj, playerx + xOffset, playery + yOffset):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>362. </span>        return
False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>363. </span>    else:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>364. </span>        if
(playerx + xOffset, playery + yOffset) in stars:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>365. </span>            <span
class=SourceCodeComment># There is a star in the way, see if the player can
push it.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>366. </span>            if
not isBlocked(mapObj, gameStateObj, playerx + (xOffset*2), playery +
(yOffset*2)):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>367. </span>                <span
class=SourceCodeComment># Move the star.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>368. </span>                ind
= stars.index((playerx + xOffset, playery + yOffset))</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>369. </span>                stars[ind]
= (stars[ind][0] + xOffset, stars[ind][1] + yOffset)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>370. </span>            else:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>371. </span>                return
False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>372. </span>        <span
class=SourceCodeComment># Move the player upwards.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>373. </span>        gameStateObj['player']
= (playerx + xOffset, playery + yOffset)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>374. </span>        return
True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>375.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>376.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>377. </span>def
startScreen():</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>378. </span>    <span
class=SourceCodeComment>&quot;&quot;&quot;Display the start screen (which has
the title and instructions)</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>379. </span>    <span
class=SourceCodeComment>until the player presses a key. Returns
None.&quot;&quot;&quot;</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>380. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>381. </span>    <span
class=SourceCodeComment># Position the title image.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>382. </span>    titleRect
= IMAGESDICT['title'].get_rect()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>383. </span>    topCoord
= 50 <span class=SourceCodeComment># topCoord tracks where to position the top
of the text</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>384. </span>    titleRect.top
= topCoord</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>385. </span>    titleRect.centerx
= HALF_WINWIDTH</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>386. </span>    topCoord
+= titleRect.height</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>387. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>388. </span>    <span
class=SourceCodeComment># Unfortunately, Pygame's font &amp; text system only
shows one line at</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>389. </span>    <span
class=SourceCodeComment># a time, so we can't use strings with \n newline
characters in them.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>390. </span>    <span
class=SourceCodeComment># So we will use a list with each line in it.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>391. </span>    instructionText
= ['Push the stars over the marks.',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>392. </span>                       'Arrow
keys to move, WASD for camera control, P to change character.',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>393. </span>                       'Backspace
to reset level, Esc to quit.',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>394. </span>                       'N
for next level, B to go back a level.']</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>395. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>396. </span>    <span
class=SourceCodeComment># Start with drawing a blank color to the entire
window:</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>397. </span>    DISPLAYSURF.fill(BGCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>398. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>399. </span>    <span
class=SourceCodeComment># Draw the title image to the window:</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>400. </span>    DISPLAYSURF.blit(IMAGESDICT['title'],
titleRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>401. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>402. </span>    <span
class=SourceCodeComment># Position and draw the text.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>403. </span>    for
i in range(len(instructionText)):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>404. </span>        instSurf
= BASICFONT.render(instructionText[i], 1, TEXTCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>405. </span>        instRect
= instSurf.get_rect()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>406. </span>        topCoord
+= 10 <span class=SourceCodeComment># 10 pixels will go in between each line of
text.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>407. </span>        instRect.top
= topCoord</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>408. </span>        instRect.centerx
= HALF_WINWIDTH</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>409. </span>        topCoord
+= instRect.height <span class=SourceCodeComment># Adjust for the height of the
line.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>410. </span>        DISPLAYSURF.blit(instSurf,
instRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>411. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>412. </span>    while
True: <span class=SourceCodeComment># Main loop for the start screen.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>413. </span>        for
event in pygame.event.get():</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>414. </span>            if
event.type == QUIT:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>415. </span>                terminate()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>416. </span>            elif
event.type == KEYDOWN:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>417. </span>                if
event.key == K_ESCAPE:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>418. </span>                    terminate()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>419. </span>                return
<span class=SourceCodeComment># user has pressed a key, so return.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>420. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>421. </span>        <span
class=SourceCodeComment># Display the DISPLAYSURF contents to the actual
screen.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>422. </span>        pygame.display.update()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>423. </span>        FPSCLOCK.tick()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>424.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>425.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>426. </span>def
readLevelsFile(filename):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>427. </span>    assert
os.path.exists(filename), 'Cannot find the level file: %s' % (filename)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>428. </span>    mapFile
= open(filename, 'r')</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>429. </span>    <span
class=SourceCodeComment># Each level must end with a blank line</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>430. </span>    content
= mapFile.readlines() + ['\r\n']</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>431.</span>    
mapFile.close()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>432.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>433. </span>    levels
= [] <span class=SourceCodeComment># Will contain a list of level objects.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>434. </span>    levelNum
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>435. </span>    mapTextLines
= [] <span class=SourceCodeComment># contains the lines for a single level's
map.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>436. </span>    mapObj
= [] <span class=SourceCodeComment># the map object made from the data in mapTextLines</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>437. </span>    for
lineNum in range(len(content)):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>438. </span>        <span
class=SourceCodeComment># Process each line that was in the level file.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>439. </span>        line
= content[lineNum].rstrip('\r\n')</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>440. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>441. </span>        if
';' in line:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>442. </span>            <span
class=SourceCodeComment># Ignore the ; lines, they're comments in the level
file.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>443. </span>            line
= line[:line.find(';')]</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>444. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>445. </span>        if
line != '':</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>446. </span>            <span
class=SourceCodeComment># This line is part of the map.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>447. </span>            mapTextLines.append(line)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>448. </span>        elif
line == '' and len(mapTextLines) &gt; 0:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>449. </span>            <span
class=SourceCodeComment># A blank line indicates the end of a level's map in
the file.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>450. </span>            <span
class=SourceCodeComment># Convert the text in mapTextLines into a level object.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>451. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>452. </span>            <span
class=SourceCodeComment># Find the longest row in the map.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>453. </span>            maxWidth
= -1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>454. </span>            for
i in range(len(mapTextLines)):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>455. </span>                if
len(mapTextLines[i]) &gt; maxWidth:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>456. </span>                    maxWidth
= len(mapTextLines[i])</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>457. </span>            <span
class=SourceCodeComment># Add spaces to the ends of the shorter rows. This</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>458. </span>            <span
class=SourceCodeComment># ensures the map will be rectangular.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>459. </span>            for
i in range(len(mapTextLines)):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>460. </span>                mapTextLines[i]
+= ' ' * (maxWidth - len(mapTextLines[i]))</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>461. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>462. </span>            <span
class=SourceCodeComment># Convert mapTextLines to a map object.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>463. </span>            for
x in range(len(mapTextLines[0])):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>464. </span>                mapObj.append([])</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>465. </span>            for
y in range(len(mapTextLines)):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>466. </span>                for
x in range(maxWidth):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>467. </span>                    mapObj[x].append(mapTextLines[y][x])</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>468. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>469. </span>            <span
class=SourceCodeComment># Loop through the spaces in the map and find the @, .,
and $</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>470. </span>            <span
class=SourceCodeComment># characters for the starting game state.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>471. </span>            startx
= None <span class=SourceCodeComment># The x and y for the player's starting
position</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>472. </span>            starty
= None</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>473. </span>            goals
= [] <span class=SourceCodeComment># list of (x, y) tuples for each goal.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>474. </span>            stars
= [] <span class=SourceCodeComment># list of (x, y) for each star's starting
position.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>475. </span>            for
x in range(maxWidth):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>476. </span>                for
y in range(len(mapObj[x])):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>477. </span>                    if
mapObj[x][y] in ('@', '+'):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>478. </span>                        <span
class=SourceCodeComment># '@' is player, '+' is player &amp; goal</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>479. </span>                        startx
= x</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>480. </span>                        starty
= y</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>481. </span>                    if
mapObj[x][y] in ('.', '+', '*'):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>482. </span>                        <span
class=SourceCodeComment># '.' is goal, '*' is star &amp; goal</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>483. </span>                        goals.append((x,
y))</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>484. </span>                    if
mapObj[x][y] in ('$', '*'):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>485. </span>                        <span
class=SourceCodeComment># '$' is star</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>486. </span>                        stars.append((x,
y))</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>487. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>488. </span>            <span
class=SourceCodeComment># Basic level design sanity checks:</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>489. </span>            assert
startx != None and starty != None, 'Level %s (around line %s) in %s is missing
a &quot;@&quot; or &quot;+&quot; to mark the start point.' % (levelNum+1,
lineNum, filename)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>490. </span>            assert
len(goals) &gt; 0, 'Level %s (around line %s) in %s must have at least one
goal.' % (levelNum+1, lineNum, filename)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>&nbsp;</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>491. </span>            assert
len(stars) &gt;= len(goals), 'Level %s (around line %s) in %s is impossible to
solve. It has %s goals but only %s stars.' % (levelNum+1, lineNum, filename,
len(goals), len(stars))</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>492. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>493. </span>            <span
class=SourceCodeComment># Create level object and starting game state object.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>494. </span>            gameStateObj
= {'player': (startx, starty),</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>495. </span>                            'stepCounter':
0,</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>496. </span>                            'stars':
stars}</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>497. </span>            levelObj
= {'width': maxWidth,</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>498. </span>                        'height':
len(mapObj),</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>499. </span>                        'mapObj':
mapObj,</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>500. </span>                        'goals':
goals,</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>501. </span>                        'startState':
gameStateObj}</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>502.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>503. </span>            levels.append(levelObj)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>504. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>505. </span>            <span
class=SourceCodeComment># Reset the variables for reading the next map.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>506. </span>            mapTextLines
= []</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>507. </span>            mapObj
= []</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>508. </span>            gameStateObj
= {}</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>509. </span>            levelNum
+= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>510. </span>    return
levels</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceCodeComment>511.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceCodeComment>512.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>513. </span>def
floodFill(mapObj, x, y, oldCharacter, newCharacter):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>514. </span>    <span
class=SourceCodeComment>&quot;&quot;&quot;Changes any values matching
oldCharacter on the map object to</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>515. </span>    <span
class=SourceCodeComment>newCharacter at the (x, y) position, and does the same
for the</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>516. </span>    <span
class=SourceCodeComment>positions to the left, right, down, and up of (x, y),
recursively.&quot;&quot;&quot;</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>517. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>518. </span>    <span
class=SourceCodeComment># In this game, the flood fill algorithm creates the
inside/outside</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>519. </span>    <span
class=SourceCodeComment># floor distinction. This is a &quot;recursive&quot;
function.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>520. </span>    <span
class=SourceCodeComment># For more info on the Flood Fill algorithm, see:</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>521. </span>    <span
class=SourceCodeComment>#   http://en.wikipedia.org/wiki/Flood_fill</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>522. </span>    if
mapObj[x][y] == oldCharacter:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>523. </span>        mapObj[x][y]
= newCharacter</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>524. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>525. </span>    if
x &lt; len(mapObj) - 1 and mapObj[x+1][y] == oldCharacter:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>526. </span>        floodFill(mapObj,
x+1, y, oldCharacter, newCharacter) <span class=SourceCodeComment># call right</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>527. </span>    if
x &gt; 0 and mapObj[x-1][y] == oldCharacter:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>528. </span>        floodFill(mapObj,
x-1, y, oldCharacter, newCharacter) <span class=SourceCodeComment># call left</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>529. </span>    if
y &lt; len(mapObj[x]) - 1 and mapObj[x][y+1] == oldCharacter:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>530. </span>        floodFill(mapObj,
x, y+1, oldCharacter, newCharacter) <span class=SourceCodeComment># call down</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>531. </span>    if
y &gt; 0 and mapObj[x][y-1] == oldCharacter:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>532. </span>        floodFill(mapObj,
x, y-1, oldCharacter, newCharacter) <span class=SourceCodeComment># call up</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>533.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>534.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>535. </span>def
drawMap(mapObj, gameStateObj, goals):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>536. </span>    <span
class=SourceCodeComment>&quot;&quot;&quot;Draws the map to a Surface object,
including the player and</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>537. </span>    <span
class=SourceCodeComment>stars. This function does not call
pygame.display.update(), nor</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>538. </span>    <span
class=SourceCodeComment>does it draw the &quot;Level&quot; and
&quot;Steps&quot; text in the corner.&quot;&quot;&quot;</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>539. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>540. </span>    <span
class=SourceCodeComment># mapSurf will be the single Surface object that the
tiles are drawn</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>541. </span>    <span
class=SourceCodeComment># on, so that it is easy to position the entire map on
the DISPLAYSURF</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>542. </span>    <span
class=SourceCodeComment># Surface object. First, the width and height must be
calculated.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>543. </span>    mapSurfWidth
= len(mapObj) * TILEWIDTH</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>544. </span>    mapSurfHeight
= (len(mapObj[0]) - 1) * (TILEHEIGHT - TILEFLOORHEIGHT) + TILEHEIGHT</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>545. </span>    mapSurf
= pygame.Surface((mapSurfWidth, mapSurfHeight))</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>546. </span>    mapSurf.fill(BGCOLOR)
<span class=SourceCodeComment># start with a blank color on the surface.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>547. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>548. </span>    <span
class=SourceCodeComment># Draw the tile sprites onto this surface.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>549. </span>    for
x in range(len(mapObj)):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>550. </span>        for
y in range(len(mapObj[x])):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>551. </span>            spaceRect
= pygame.Rect((x * TILEWIDTH, y * (TILEHEIGHT - TILEFLOORHEIGHT), TILEWIDTH,
TILEHEIGHT))</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>552. </span>            if
mapObj[x][y] in TILEMAPPING:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>553. </span>                baseTile
= TILEMAPPING[mapObj[x][y]]</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>554. </span>            elif
mapObj[x][y] in OUTSIDEDECOMAPPING:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>555. </span>                baseTile
= TILEMAPPING[' ']</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>556. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>557. </span>            <span
class=SourceCodeComment># First draw the base ground/wall tile.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>558. </span>            mapSurf.blit(baseTile,
spaceRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>559. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>560. </span>            if
mapObj[x][y] in OUTSIDEDECOMAPPING:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>561. </span>                <span
class=SourceCodeComment># Draw any tree/rock decorations that are on this tile.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>562. </span>                mapSurf.blit(OUTSIDEDECOMAPPING[mapObj[x][y]],
spaceRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>563. </span>            elif
(x, y) in gameStateObj['stars']:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>564. </span>                if
(x, y) in goals:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>565. </span>                    <span
class=SourceCodeComment># A goal AND star are on this space, draw goal first.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>566. </span>                    mapSurf.blit(IMAGESDICT['covered
goal'], spaceRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>567. </span>                <span
class=SourceCodeComment># Then draw the star sprite.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>568. </span>                mapSurf.blit(IMAGESDICT['star'],
spaceRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>569. </span>            elif
(x, y) in goals:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>570. </span>                <span
class=SourceCodeComment># Draw a goal without a star on it.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>571. </span>                mapSurf.blit(IMAGESDICT['uncovered
goal'], spaceRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>572. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>573. </span>            <span
class=SourceCodeComment># Last draw the player on the board.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>574. </span>            if
(x, y) == gameStateObj['player']:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>575. </span>                <span
class=SourceCodeComment># Note: The value &quot;currentImage&quot; refers</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>576. </span>                <span
class=SourceCodeComment># to a key in &quot;PLAYERIMAGES&quot; which has the</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>577. </span>                <span
class=SourceCodeComment># specific player image we want to show.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>578. </span>                mapSurf.blit(PLAYERIMAGES[currentImage],
spaceRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>579. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>580. </span>    return
mapSurf</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>581.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>582.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>583. </span>def
isLevelFinished(levelObj, gameStateObj):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>584. </span>    <span
class=SourceCodeComment>&quot;&quot;&quot;Returns True if all the goals have
stars in them.&quot;&quot;&quot;</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>585. </span>    for
goal in levelObj['goals']:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>586. </span>        if
goal not in gameStateObj['stars']:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>587. </span>            <span
class=SourceCodeComment># Found a space with a goal but no star on it.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>588. </span>            return
False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>589. </span>    return
True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>590.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>591.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>592. </span>def
terminate():</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>593. </span>    pygame.quit()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>594. </span>    sys.exit()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>595.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>596.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>597. </span>if
__name__ == '__main__':</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>598. </span>    main()</p>

</div>

<h2><a name="_Toc316488739">The Initial Setup</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst>  <span class=SourceLineNumber>1. </span><span
class=SourceCodeComment># Star Pusher (a Sokoban clone)</span></p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>2. </span><span
class=SourceCodeComment># By Al Sweigart al@inventwithpython.com</span></p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>3. </span><span
class=SourceCodeComment># http://inventwithpython.com/pygame</span></p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>4. </span><span
class=SourceCodeComment># Creative Commons BY-NC-SA 3.0 US</span></p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>5. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>6. </span>import
random, sys, copy, os, pygame</p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>7. </span>from
pygame.locals import *</p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>8. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle>  <span class=SourceLineNumber>9. </span>FPS
= 30 <span class=SourceCodeComment># frames per second to update the screen</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>10. </span>WINWIDTH
= 800 <span class=SourceCodeComment># width of the program's window, in pixels</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>11. </span>WINHEIGHT
= 600 <span class=SourceCodeComment># height in pixels</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>12. </span>HALF_WINWIDTH
= int(WINWIDTH / 2)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>13. </span>HALF_WINHEIGHT
= int(WINHEIGHT / 2)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>14. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>15. </span><span
class=SourceCodeComment># The total width and height of each tile in pixels.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>16. </span>TILEWIDTH
= 50</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>17. </span>TILEHEIGHT
= 85</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>18. </span>TILEFLOORHEIGHT
= 45</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>19. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>20. </span>CAM_MOVE_SPEED
= 5 <span class=SourceCodeComment># how many pixels per frame the camera moves</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>21. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>22. </span><span
class=SourceCodeComment># The percentage of outdoor tiles that have additional</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>23. </span><span
class=SourceCodeComment># decoration on them, such as a tree or rock.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>24. </span>OUTSIDE_DECORATION_PCT
= 20</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>25. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>26. </span>BRIGHTBLUE
= (  0, 170, 255)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>27. </span>WHITE     
= (255, 255, 255)</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>28. </span>BGCOLOR
= BRIGHTBLUE</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>29. </span>TEXTCOLOR
= WHITE</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>30. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>31. </span>UP
= 'up'</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>32. </span>DOWN
= 'down'</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>33. </span>LEFT
= 'left'</p>

<p class=SourceCodeFeaturedCxSpLast> <span class=SourceLineNumber>34. </span>RIGHT
= 'right'</p>

</div>

<p class=MsoNormal>These constants are used in various parts of the program. The
<span class=Literal>TILEWIDTH</span> and <span class=Literal>TILEHEIGHT</span>
variables show that each of the tile images are 50 pixels wide and 85 pixels
tall. However, these tiles overlap with each other when drawn on the screen.
(This is explained later.) The <span class=Literal>TILEFLOORHEIGHT</span>
refers to the fact that the part of the tile that represents the floor is 45
pixels tall. Here is a diagram of the plain floor image:</p>

<p class=MsoNormal align=center style='text-align:center'><img width=233
height=94 id="Picture 80" src="chapter9_files/image003.webp"></p>

<p class=MsoNormal>The grassy tiles outside of the level’s room will sometimes
have extra decorations added to them (such as trees or rocks). The <span
class=Literal>OUTSIDE_DECORATION_PCT</span> constant shows what percentage of
these tiles will randomly have these decorations.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst> <span class=SourceLineNumber>37. </span>def
main():</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>38. </span>    global
FPSCLOCK, DISPLAYSURF, IMAGESDICT, TILEMAPPING, OUTSIDEDECOMAPPING, BASICFONT, PLAYERIMAGES,
currentImage</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>39. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>40. </span>    <span
class=SourceCodeComment># Pygame initialization and basic set up of the global variables.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>41. </span>    pygame.init()</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>42. </span>    FPSCLOCK
= pygame.time.Clock()</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>43. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>44. </span>    <span
class=SourceCodeComment># Because the Surface object stored in DISPLAYSURF was
returned</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>45. </span>    <span
class=SourceCodeComment># from the pygame.display.set_mode() function, this is
the</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>46. </span>    <span
class=SourceCodeComment># Surface object that is drawn to the actual computer
screen</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>47. </span>    <span
class=SourceCodeComment># when pygame.display.update() is called.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>48. </span>    DISPLAYSURF
= pygame.display.set_mode((WINWIDTH, WINHEIGHT))</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>49. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>50. </span>    pygame.display.set_caption('Star
Pusher')</p>

<p class=SourceCodeFeaturedCxSpLast> <span class=SourceLineNumber>51. </span>    BASICFONT
= pygame.font.Font('freesansbold.ttf', 18)</p>

</div>

<p class=MsoNormal>This is the usual Pygame setup that happens at the beginning
of the program.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber> 53. </span>    <span
class=SourceCodeComment># A global dict value that will contain all the Pygame</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>54. </span>    <span
class=SourceCodeComment># Surface objects returned by pygame.image.load().</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>55. </span>    IMAGESDICT
= {'uncovered goal': pygame.image.load('RedSelector.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>56. </span>                  'covered
goal': pygame.image.load('Selector.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>57. </span>                  'star':
pygame.image.load('Star.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>58. </span>                  'corner':
pygame.image.load('Wall Block Tall.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>59. </span>                  'wall':
pygame.image.load('Wood Block Tall.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>60. </span>                  'inside
floor': pygame.image.load('Plain Block.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>61. </span>                  'outside
floor': pygame.image.load('Grass Block.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>62. </span>                  'title':
pygame.image.load('star_title.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>63. </span>                  'solved':
pygame.image.load('star_solved.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>64. </span>                  'princess':
pygame.image.load('princess.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>65. </span>                  'boy':
pygame.image.load('boy.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>66. </span>                  'catgirl':
pygame.image.load('catgirl.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>67. </span>                  'horngirl':
pygame.image.load('horngirl.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>68. </span>                  'pinkgirl':
pygame.image.load('pinkgirl.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>69. </span>                  'rock':
pygame.image.load('Rock.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>70. </span>                  'short
tree': pygame.image.load('Tree_Short.png'),</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>71. </span>                  'tall
tree': pygame.image.load('Tree_Tall.png'),</p>

<p class=SourceCodeFeaturedCxSpLast> <span class=SourceLineNumber>72. </span>                  'ugly
tree': pygame.image.load('Tree_Ugly.png')}</p>

</div>

<p class=MsoNormal>The <span class=Literal>IMAGESDICT</span> is a dictionary
where all of the loaded images are stored. This makes it easier to use in other
functions, since only the <span class=Literal>IMAGESDICT</span> variable needs
to be made global. If we stored each of these images in separate variables,
then all 18 variables (for the 18 images used in this game) would need to be
made global. A dictionary containing all of the Surface objects with the images
is easier to handle.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst> <span class=SourceLineNumber>74. </span>    <span
class=SourceCodeComment># These dict values are global, and map the character
that appears</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>75. </span>    <span
class=SourceCodeComment># in the level file to the Surface object it
represents.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>76. </span>    TILEMAPPING
= {'x': IMAGESDICT['corner'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>77. </span>                   '#':
IMAGESDICT['wall'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>78. </span>                   'o':
IMAGESDICT['inside floor'],</p>

<p class=SourceCodeFeaturedCxSpLast> <span class=SourceLineNumber>79. </span>                   '
': IMAGESDICT['outside floor']}</p>

</div>

<p class=MsoNormal>The data structure for the map is just a 2D list of single
character strings. The <span class=Literal>TILEMAPPING</span> dictionary links
the characters used in this map data structure to the images that they
represent. (This will become more clear in the <span class=Literal>drawMap()</span>
function’s explanation.)</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst> <span class=SourceLineNumber>80. </span>    OUTSIDEDECOMAPPING
= {'1': IMAGESDICT['rock'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>81. </span>                          '2':
IMAGESDICT['short tree'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>82. </span>                          '3':
IMAGESDICT['tall tree'],</p>

<p class=SourceCodeFeaturedCxSpLast> <span class=SourceLineNumber>83. </span>                          '4':
IMAGESDICT['ugly tree']}</p>

</div>

<p class=MsoNormal>The <span class=Literal>OUTSIDEDECOMAPPING</span> is also a
dictionary that links the characters used in the map data structure to images
that were loaded. The “outside decoration” images are drawn on top of the
outdoor grassy tile.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber> 85. </span>    <span
class=SourceCodeComment># PLAYERIMAGES is a list of all possible characters the
player can be.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>86. </span>    <span
class=SourceCodeComment># currentImage is the index of the player's current
player image.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber> 87. </span>    currentImage
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>88. </span>    PLAYERIMAGES
= [IMAGESDICT['princess'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>89. </span>                    IMAGESDICT['boy'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>90. </span>                    IMAGESDICT['catgirl'],</p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>91. </span>                    IMAGESDICT['horngirl'],</p>

<p class=SourceCodeFeaturedCxSpLast> <span class=SourceLineNumber>92. </span>                    IMAGESDICT['pinkgirl']]</p>

</div>

<p class=MsoNormal>The <span class=Literal>PLAYERIMAGES</span> list stores the
images used for the player. The <span class=Literal>currentImage</span>
variable tracks the index of the currently selected player image. For example,
when <span class=Literal>currentImage</span> is set to <span class=Literal>0</span>
then <span class=Literal>PLAYERIMAGES[0]</span>, which is the “princess” player
image, is drawn to the screen.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst> <span class=SourceLineNumber>94. </span>    startScreen()
<span class=SourceCodeComment># show the title screen until the user presses a
key</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>95. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>96. </span>    <span
class=SourceCodeComment># Read in the levels from the text file. See the
readLevelsFile() for</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>97. </span>    <span
class=SourceCodeComment># details on the format of this file and how to make
your own levels.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle> <span class=SourceLineNumber>98. </span>    levels
= readLevelsFile('starPusherLevels.txt')</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber> 99. </span>    currentLevelIndex
= 0</p>

</div>

<p class=MsoNormal>The <span class=Literal>startScreen()</span> function will
keep displaying the initial start screen (which also has the instructions for
the game) until the player presses a key. When the player presses a key, the <span
class=Literal>startScreen()</span> function returns and then reads in the
levels from the level file. The player starts off on the first level, which is
the level object in the levels list at index <span class=Literal>0</span>.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>101. </span>    <span
class=SourceCodeComment># The main game loop. This loop runs a single level,
when the user</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>102. </span>    <span
class=SourceCodeComment># finishes that level, the next/previous level is
loaded.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>103. </span>    while
True: <span class=SourceCodeComment># main game loop</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>104. </span>        <span
class=SourceCodeComment># Run the level to actually start playing the game:</span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>105. </span>        result
= runLevel(levels, currentLevelIndex)</p>

</div>

<p class=MsoNormal>The <span class=Literal>runLevel()</span> function handles
all the action for the game. It is passed a list of level objects, and the
integer index of the level in that list to be played. When the player has
finished playing the level, <span class=Literal>runLevel()</span> will return
one of the following strings: <span class=Literal>'solved'</span> (because the
player has finished putting all the stars on the goals), <span class=Literal>'next'</span>
(because the player wants to skip to the next level), <span class=Literal>'back'</span>
(because the player wants to go back to the previous level), and <span
class=Literal>'reset'</span> (because the player wants to start playing the
current level over again, maybe because they pushed a star into a corner).</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>107. </span>        if
result in ('solved', 'next'):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>108. </span>            <span
class=SourceCodeComment># Go to the next level.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>109. </span>            currentLevelIndex
+= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>110. </span>            if
currentLevelIndex &gt;= len(levels):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>111. </span>                <span
class=SourceCodeComment># If there are no more levels, go back to the first
one.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>112. </span>                currentLevelIndex
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>113. </span>        elif
result == 'back':</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>114. </span>            <span
class=SourceCodeComment># Go to the previous level.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>115. </span>            currentLevelIndex
-= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>116. </span>            if
currentLevelIndex &lt; 0:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>117. </span>                <span
class=SourceCodeComment># If there are no previous levels, go to the last one.</span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>118. </span>                currentLevelIndex
= len(levels)-1</p>

</div>

<p class=MsoNormal>If <span class=Literal>runLevel()</span> has returned the
strings <span class=Literal>'solved'</span> or <span class=Literal>'next'</span>,
then we need to increment <span class=Literal>levelNum</span> by <span
class=Literal>1</span>. If this increments <span class=Literal>levelNum</span>
beyond the number of levels there are, then <span class=Literal>levelNum</span>
is set back at <span class=Literal>0</span>.</p>

<p class=MsoNormal>The opposite is done if <span class=Literal>'back'</span> is
returned, then <span class=Literal>levelNum</span> is decremented by <span
class=Literal>1</span>. If this makes it go below <span class=Literal>0</span>,
then it is set to the last level (which is <span class=Literal>len(levels)-1</span>).</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>119. </span>        elif
result == 'reset':</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>120. </span>            pass
<span class=SourceCodeComment># Do nothing. Loop re-calls runLevel() to reset
the level</span></p>

</div>

<p class=MsoNormal>If the return value was <span class=Literal>'reset'</span>,
then the code does nothing. The <span class=Literal>pass</span> statement does
nothing (like a comment), but is needed because the Python interpreter expects
an indented line of code after an <span class=Literal>elif</span> statement.</p>

<p class=MsoNormal>We could remove lines 119 and 120 from the source code
entirely, and the program will still work just the same. The reason we include
it here is for program readability, so that if we make changes to the code
later, we won’t forget that <span class=Literal>runLevel()</span> can also
return the string <span class=Literal>'reset'</span>.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>123. </span>def
runLevel(levels, levelNum):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>124.</span>    
global currentImage</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>125.</span>    
levelObj = levels[levelnum]</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>126. </span>    mapObj
= decorateMap(levelObj['mapObj'], levelObj['startState']['player'])</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>127. </span>    gameStateObj
= copy.deepcopy(levelObj['startState'])</p>

</div>

<p class=MsoNormal>The levels list contains all the level objects that were
loaded from the level file. The level object for the current level (which is
what <span class=Literal>levelNum</span> is set to) is stored in the <span
class=Literal>levelObj</span> variable. A map object (which makes a distinction
between indoor and outdoor tiles, and decorates the outdoor tiles with trees
and rocks) is returned from the <span class=Literal>decorateMap()</span>
function. And to track the state of the game while the player plays this level,
a copy of the game state object that is stored in <span class=Literal>levelObj</span>
is made using the <span class=Literal>copy.deepcopy()</span> function.</p>

<p class=MsoNormal>The game state object copy is made because the game state
object stored in <span class=Literal>levelObj['startState']</span> represents
the game state at the very beginning of the level, and we do not want to modify
this. Otherwise, if the player restarts the level, the original game state for
that level will be lost.</p>

<p class=MsoNormal>The <span class=Literal>copy.deepcopy()</span> function is
used because the game state object is a dictionary of that has tuples. But
technically, the dictionary contains references to tuples. (References are
explained in detail at <span class=URL><a href="http://invpy.com/references">http://invpy.com/references</a></span>.)
Using an assignment statement to make a copy of the dictionary will make a copy
of the references but not the values they refer to, so that both the copy and
the original dictionary still refer to the same tuples.</p>

<p class=MsoNormal>The <span class=Literal>copy.deepcopy()</span> function
solves this problem by making copies of the actual tuples in the dictionary.
This way we can guarantee that changing one dictionary will not affect the
other dictionary.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>128. </span>    mapNeedsRedraw
= True <span class=SourceCodeComment># set to True to call drawMap()</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>129. </span>    levelSurf
= BASICFONT.render('Level %s of %s' % (levelObj['levelNum'] + 1,
totalNumOfLevels), 1, TEXTCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>130. </span>    levelRect
= levelSurf.get_rect()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>131. </span>    levelRect.bottomleft
= (20, WINHEIGHT - 35)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>132. </span>    mapWidth
= len(mapObj) * TILEWIDTH</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>133. </span>    mapHeight
= (len(mapObj[0]) - 1) * (TILEHEIGHT - TILEFLOORHEIGHT) + TILEHEIGHT</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>134. </span>    MAX_CAM_X_PAN
= abs(HALF_WINHEIGHT - int(mapHeight / 2)) + TILEWIDTH</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>135. </span>    MAX_CAM_Y_PAN
= abs(HALF_WINWIDTH - int(mapWidth / 2)) + TILEHEIGHT</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>136. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>137. </span>    levelIsComplete
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>138. </span>    <span
class=SourceCodeComment># Track how much the camera has moved:</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>139. </span>    cameraOffsetX
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>140. </span>    cameraOffsetY
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>141. </span>    <span
class=SourceCodeComment># Track if the keys to move the camera are being held
down:</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>142. </span>    cameraUp
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>143. </span>    cameraDown
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>144. </span>    cameraLeft
= False</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>145. </span>    cameraRight
= False</p>

</div>

<p class=MsoNormal>More variables are set at the start of playing a level. The <span
class=Literal>mapWidth</span> and <span class=Literal>mapHeight</span>
variables are the size of the maps in pixels. The expression for calculating <span
class=Literal>mapHeight</span> is a bit complicated since the tiles overlap
each other. Only the bottom row of tiles is the full height (which accounts for
the <span class=Literal>+ TILEHEIGHT</span> part of the expression), all of the
other rows of tiles (which number as <span class=Literal>(len(mapObj[0]) - 1)</span>)
are slightly overlapped. This means that they are effectively each only <span
class=Literal>(TILEHEIGHT - TILEFLOORHEIGHT)</span> pixels tall.</p>

<p class=MsoNormal>The camera in Star Pusher can be moved independently of the
player moving around the map. This is why the camera needs its own set of
“moving” variables: <span class=Literal>cameraUp</span>, <span class=Literal>cameraDown</span>,
<span class=Literal>cameraLeft</span>, and <span class=Literal>cameraRight</span>.
The <span class=Literal>cameraOffsetX</span> and <span class=Literal>cameraOffsetY</span>
variables track the position of the camera.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>147. </span>    while
True: <span class=SourceCodeComment># main game loop</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>148. </span>        <span
class=SourceCodeComment># Reset these variables:</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>149. </span>        playerMoveTo
= None</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>150. </span>        keyPressed
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>151. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>152. </span>        for
event in pygame.event.get(): <span class=SourceCodeComment># event handling
loop</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>153. </span>            if
event.type == QUIT:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>154. </span>                <span
class=SourceCodeComment># Player clicked the &quot;X&quot; at the corner of the
window.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>155. </span>                terminate()</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>156. </span></p>

</div>

<p class=MsoNormal>The <span class=Literal>playerMoveTo</span> variable will be
set to the direction constant that the player intends to move the player
character on the map. The <span class=Literal>keyPressed</span> variable tracks
if any key has been pressed during this iteration of the game loop. This
variable is checked later when the player has solved the level.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>157. </span>            elif
event.type == KEYDOWN:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>158. </span>                <span
class=SourceCodeComment># Handle key presses</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>159. </span>                keyPressed
= True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>160. </span>                if
event.key == K_LEFT:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>161. </span>                    playerMoveTo
= LEFT</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>162. </span>                elif
event.key == K_RIGHT:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>163. </span>                    playerMoveTo
= RIGHT</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>164. </span>                elif
event.key == K_UP:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>165. </span>                    playerMoveTo
= UP</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>166. </span>                elif
event.key == K_DOWN:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>167. </span>                    playerMoveTo
= DOWN</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>168. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>169. </span>                <span
class=SourceCodeComment># Set the camera move mode.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>170. </span>                elif
event.key == K_a:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>171. </span>                    cameraLeft
= True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>172. </span>                elif
event.key == K_d:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>173. </span>                    cameraRight
= True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>174. </span>                elif
event.key == K_w:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>175. </span>                    cameraUp
= True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>176. </span>                elif
event.key == K_s:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>177. </span>                    cameraDown
= True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>178. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>179. </span>                elif
event.key == K_n:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>180. </span>                    return
'next'</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>181. </span>                elif
event.key == K_b:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>182. </span>                    return
'back'</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>183. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>184. </span>                elif
event.key == K_ESCAPE:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>185. </span>                    terminate()
<span class=SourceCodeComment># Esc key quits.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>186. </span>                elif
event.key == K_BACKSPACE:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>187. </span>                    return
'reset' <span class=SourceCodeComment># Reset the level.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>188. </span>                elif
event.key == K_p:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>189. </span>                    <span
class=SourceCodeComment># Change the player image to the next one.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>190. </span>                    currentImage
+= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>191. </span>                    if
currentImage &gt;= len(PLAYERIMAGES):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>192. </span>                        <span
class=SourceCodeComment># After the last player image, use the first one.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>193. </span>                        currentImage
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>194. </span>                    mapNeedsRedraw
= True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>195. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>196. </span>            elif
event.type == KEYUP:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>197. </span>                <span
class=SourceCodeComment># Unset the camera move mode.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>198. </span>                if
event.key == K_a:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>199. </span>                    cameraLeft
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>200. </span>                elif
event.key == K_d:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>201. </span>                    cameraRight
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>202. </span>                elif
event.key == K_w:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>203. </span>                    cameraUp
= False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>204. </span>                elif
event.key == K_s:</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>205. </span>                    cameraDown
= False</p>

</div>

<p class=MsoNormal>This code handles what to do when the various keys are
pressed.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>207. </span>        if
playerMoveTo != None and not levelIsComplete:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>208. </span>            <span
class=SourceCodeComment># If the player pushed a key to move, make the move</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>209. </span>            <span
class=SourceCodeComment># (if possible) and push any stars that are pushable.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>210. </span>            moved
= makeMove(mapObj, gameStateObj, playerMoveTo)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>211. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>212. </span>            if
moved:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>213. </span>                <span
class=SourceCodeComment># increment the step counter.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>214. </span>                gameStateObj['stepCounter']
+= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>215. </span>                mapNeedsRedraw
= True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>216. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>217. </span>            if
isLevelFinished(levelObj, gameStateObj):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>218. </span>                <span
class=SourceCodeComment># level is solved, we should show the
&quot;Solved!&quot; image.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>219. </span>                levelIsComplete
= True</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>220. </span>                keyPressed
= False</p>

</div>

<p class=MsoNormal>If the <span class=Literal>playerMoveTo</span> variable is
no longer set to <span class=Literal>None</span>, then we know the player
intended to move. The call to <span class=Literal>makeMove()</span> handles
changing the XY coordinates of the player’s position in the <span
class=Literal>gameStateObj</span>, as well as pushing any stars. The return
value of <span class=Literal>makeMove()</span> is stored in moved. If this
value is <span class=Literal>True</span>, then the player character was moved
in that direction. If the value was <span class=Literal>False</span>, then the
player must have tried to move into a tile that was a wall, or push a star that
had something behind it. In this case, the player can’t move and nothing on the
map changes.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>222. </span>        DISPLAYSURF.fill(BGCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>223. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>224. </span>        if
mapNeedsRedraw:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>225. </span>            mapSurf
= drawMap(mapObj, gameStateObj, levelObj['goals'])</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>226. </span>            mapNeedsRedraw
= False</p>

</div>

<p class=MsoNormal>The map does not need to be redrawn on each iteration
through the game loop. In fact, this game program is complicated enough that
doing so would cause a slight (but noticeable) slowdown in the game. And the
map really only needs to be redrawn when something has changed (such as the
player moving or a star being pushed). So the Surface object in the <span
class=Literal>mapSurf</span> variable is only updated with a call to the <span
class=Literal>drawMap()</span> function when the <span class=Literal>mapNeedsRedraw</span>
variable is set to <span class=Literal>True</span>.</p>

<p class=MsoNormal>After the map has been drawn on line 225, the <span
class=Literal>mapNeedsRedraw</span> variable is set to <span class=Literal>False</span>.
If you want to see how the program slows down by drawing on each iteration
through the game loop, comment out line 226 and rerun the program. You will
notice that moving the camera is significantly slower.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>228. </span>        if
cameraUp and cameraOffsetY &lt; MAX_CAM_X_PAN:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>229. </span>            cameraOffsetY
+= CAM_MOVE_SPEED</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>230. </span>        elif
cameraDown and cameraOffsetY &gt; -MAX_CAM_X_PAN:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>231. </span>            cameraOffsetY
-= CAM_MOVE_SPEED</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>232. </span>        if
cameraLeft and cameraOffsetX &lt; MAX_CAM_Y_PAN:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>233. </span>            cameraOffsetX
+= CAM_MOVE_SPEED</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>234. </span>        elif
cameraRight and cameraOffsetX &gt; -MAX_CAM_Y_PAN:</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>235. </span>            cameraOffsetX
-= CAM_MOVE_SPEED</p>

</div>

<p class=MsoNormal>If the camera movement variables are set to <span
class=Literal>True</span> and the camera has not gone past (i.e. panned passed)
the boundaries set by the <span class=Literal>MAX_CAM_X_PAN</span> and <span
class=Literal>MAX_CAM_Y_PAN</span>, then the camera location (stored in <span
class=Literal>cameraOffsetX</span> and <span class=Literal>cameraOffsetY</span>)
should move over by <span class=Literal>CAM_MOVE_SPEED</span> pixels.</p>

<p class=MsoNormal>Note that there is an <span class=Literal>if</span> and <span
class=Literal>elif</span> statement on lines 228 and 230 for moving the camera
up and down, and then a separate <span class=Literal>if</span> and <span
class=Literal>elif</span> statement on lines 232 and 234. This way, the user
can move the camera both vertically and horizontally at the same time. This
wouldn’t be possible if line 232 were an <span class=Literal>elif</span>
statement.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>237. </span>        <span
class=SourceCodeComment># Adjust mapSurf's Rect object based on the camera
offset.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>238. </span>        mapSurfRect
= mapSurf.get_rect()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>239. </span>        mapSurfRect.center
= (HALF_WINWIDTH + cameraOffsetX, HALF_WINHEIGHT + cameraOffsetY)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>240. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>241. </span>        <span
class=SourceCodeComment># Draw mapSurf to the DISPLAYSURF Surface object.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>242. </span>        DISPLAYSURF.blit(mapSurf,
mapSurfRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>243. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>244. </span>        DISPLAYSURF.blit(levelSurf,
levelRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>245. </span>        stepSurf
= BASICFONT.render('Steps: %s' % (gameStateObj['stepCounter']), 1, TEXTCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>246. </span>        stepRect
= stepSurf.get_rect()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>247. </span>        stepRect.bottomleft
= (20, WINHEIGHT - 10)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>248. </span>        DISPLAYSURF.blit(stepSurf,
stepRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>249. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>250. </span>        if
levelIsComplete:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>251. </span>            <span
class=SourceCodeComment># is solved, show the &quot;Solved!&quot; image until
the player</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>252. </span>            <span
class=SourceCodeComment># has pressed a key.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>253. </span>            solvedRect
= IMAGESDICT['solved'].get_rect()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>254. </span>            solvedRect.center
= (HALF_WINWIDTH, HALF_WINHEIGHT)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>255. </span>            DISPLAYSURF.blit(IMAGESDICT['solved'],
solvedRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>256. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>257. </span>            if
keyPressed:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>258. </span>                return
'solved'</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>259. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>260. </span>        pygame.display.update()
<span class=SourceCodeComment># draw DISPLAYSURF to the screen.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>261. </span>        FPSCLOCK.tick()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>262.</span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>263.</span></p>

</div>

<p class=MsoNormal>Lines 237 to 261 position the camera and draw the map and
other graphics to the display Surface object in <span class=Literal>DISPLAYSURF</span>.
If the level is solved, then the victory graphic is also drawn on top of
everything else. The <span class=Literal>keyPressed</span> variable will be set
to <span class=Literal>True</span> if the user pressed a key during this
iteration, at which point the <span class=Literal>runLevel()</span> function
returns.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>264. </span>def
isWall(mapObj, x, y):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>265. </span>    <span
class=SourceCodeComment>&quot;&quot;&quot;Returns True if the (x, y) position
on</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>266. </span>    <span
class=SourceCodeComment>the map is a wall, otherwise return
False.&quot;&quot;&quot;</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>267. </span>    if
x &lt; 0 or x &gt;= len(mapObj) or y &lt; 0 or y &gt;= len(mapObj[x]):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>268. </span>        return
False <span class=SourceCodeComment># x and y aren't actually on the map.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>269. </span>    elif
mapObj[x][y] in ('#', 'x'):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>270. </span>        return
True <span class=SourceCodeComment># wall is blocking</span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>271. </span>    return
False</p>

</div>

<p class=MsoNormal>The <span class=Literal>isWall()</span> function returns <span
class=Literal>True</span> if there is a wall on the map object at the XY
coordinates passed to the function. Wall objects are represented as either a <span
class=Literal>'x'</span> or <span class=Literal>'#'</span> string in the map
object.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>274. </span>def
decorateMap(mapObj, startxy):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>275. </span>    <span
class=SourceCodeComment>&quot;&quot;&quot;Makes a copy of the given map object
and modifies it.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>276. </span>    <span
class=SourceCodeComment>Here is what is done to it:</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>277. </span>        <span
class=SourceCodeComment>* Walls that are corners are turned into corner pieces.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>278. </span>        <span
class=SourceCodeComment>* The outside/inside floor tile distinction is made.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>279. </span>        <span
class=SourceCodeComment>* Tree/rock decorations are randomly added to the
outside tiles.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>280. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>281. </span>    <span
class=SourceCodeComment>Returns the decorated map object.&quot;&quot;&quot;</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>282. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>283. </span>    startx,
starty = startxy <span class=SourceCodeComment># Syntactic sugar</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>284. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>285. </span>    <span
class=SourceCodeComment># Copy the map object so we don't modify the original
passed</span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>286. </span>    mapObjCopy
= copy.deepcopy(mapObj)</p>

</div>

<p class=MsoNormal>The <span class=Literal>decorateMap()</span> function alters
the data structure <span class=Literal>mapObj</span> so that it isn’t as plain
as it appears in the map file. The three things that <span class=Literal>decorateMap()</span>
changes are explained in the comment at the top of the function.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>288. </span>    <span
class=SourceCodeComment># Remove the non-wall characters from the map data</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>289. </span>    for
x in range(len(mapObjCopy)):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>290. </span>        for
y in range(len(mapObjCopy[0])):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>291. </span>            if
mapObjCopy[x][y] in ('$', '.', '@', '+', '*'):</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>292. </span>                mapObjCopy[x][y]
= ' '</p>

</div>

<p class=MsoNormal>The map object has characters that represent the position of
the player, goals, and stars. These are necessary for the map object (they’re
stored in other data structures after the map file is read) so they are
converted to blank spaces.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>294. </span>    <span
class=SourceCodeComment># Flood fill to determine inside/outside floor tiles.</span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>295. </span>    floodFill(mapObjCopy,
startx, starty, ' ', 'o')</p>

</div>

<p class=MsoNormal>The <span class=Literal>floodFill()</span> function will
change all of the tiles inside the walls from <span class=Literal>' '</span>
characters to <span class=Literal>'o'</span> characters. It does this using a
programming concept called recursion, which is explained in “Recursive
Functions” section later in this chapter.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>297. </span>    <span
class=SourceCodeComment># Convert the adjoined walls into corner tiles.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>298. </span>    for
x in range(len(mapObjCopy)):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>299. </span>        for
y in range(len(mapObjCopy[0])):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>300.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>301. </span>            if
mapObjCopy[x][y] == '#':</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>302. </span>                if
(isWall(mapObjCopy, x, y-1) and isWall(mapObjCopy, x+1, y)) or \</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>303. </span>                   (isWall(mapObjCopy,
x+1, y) and isWall(mapObjCopy, x, y+1)) or \</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>304. </span>                   (isWall(mapObjCopy,
x, y+1) and isWall(mapObjCopy, x-1, y)) or \</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>305. </span>                   (isWall(mapObjCopy,
x-1, y) and isWall(mapObjCopy, x, y-1)):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>306. </span>                    mapObjCopy[x][y]
= 'x'</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>307.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>308. </span>            elif
mapObjCopy[x][y] == ' ' and random.randint(0, 99) &lt; OUTSIDE_DECORATION_PCT:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>309. </span>                mapObjCopy[x][y]
= random.choice(list(OUTSIDEDECOMAPPING.keys()))</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>310. </span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>311. </span>    return
mapObjCopy<span class=SourceLineNumber> </span></p>

</div>

<p class=MsoNormal>The large, multi-line <span class=Literal>if</span>
statement on line 301 checks if the wall tile at the current XY coordinates are
a corner wall tile by checking if there are wall tiles adjacent to it that form
a corner shape. If so, the <span class=Literal>'#'</span> string in the map object
that represents a normal wall is changed to a <span class=Literal>'x'</span>
string which represents a corner wall tile.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>314. </span>def
isBlocked(mapObj, gameStateObj, x, y):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>315. </span>    <span
class=SourceCodeComment>&quot;&quot;&quot;Returns True if the (x, y) position
on the map is</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>316. </span>    <span
class=SourceCodeComment>blocked by a wall or star, otherwise return
False.&quot;&quot;&quot;</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>317.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>318. </span>    if
isWall(mapObj, x, y):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>319. </span>        return
True</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>320.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>321. </span>    elif
x &lt; 0 or x &gt;= len(mapObj) or y &lt; 0 or y &gt;= len(mapObj[x]):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>322. </span>        return
True <span class=SourceCodeComment># x and y aren't actually on the map.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>323.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>324. </span>    elif
(x, y) in gameStateObj['stars']:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>325. </span>        return
True <span class=SourceCodeComment># a star is blocking</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>326. </span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>327. </span>    return
False</p>

</div>

<p class=MsoNormal>There are three cases where a space on the map would be
blocked: if there is a star, a wall, or the coordinates of the space are past
the edges of the map. The <span class=Literal>isBlocked()</span> function
checks for these three cases and returns <span class=Literal>True</span> if the
XY coordinates are blocked and <span class=Literal>False</span> if not.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>330. </span>def
makeMove(mapObj, gameStateObj, playerMoveTo):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>331. </span>    <span
class=SourceCodeComment>&quot;&quot;&quot;Given a map and game state object,
see if it is possible for the</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>332. </span>    <span
class=SourceCodeComment>player to make the given move. If it is, then change
the player's</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>333. </span>    <span
class=SourceCodeComment>position (and the position of any pushed star). If not,
do nothing.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>334. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>335. </span>    <span
class=SourceCodeComment>Returns True if the player moved, otherwise
False.&quot;&quot;&quot;</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>336. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>337. </span>    <span
class=SourceCodeComment># Make sure the player can move in the direction they
want.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>338. </span>    playerx,
playery = gameStateObj['player']</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>339. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>340. </span>    <span
class=SourceCodeComment># This variable is &quot;syntactic sugar&quot;. Typing
&quot;stars&quot; is more</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>341. </span>    <span
class=SourceCodeComment># readable than typing
&quot;gameStateObj['stars']&quot; in our code.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>342. </span>    stars
= gameStateObj['stars']</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>343. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>344. </span>    <span
class=SourceCodeComment># The code for handling each of the directions is so
similar aside</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>345. </span>    <span
class=SourceCodeComment># from adding or subtracting 1 to the x/y coordinates.
We can</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>346. </span>    <span
class=SourceCodeComment># simplify it by using the xOffset and yOffset
variables.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>347. </span>    if
playerMoveTo == UP:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>348. </span>        xOffset
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>349. </span>        yOffset
= -1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>350. </span>    elif
playerMoveTo == RIGHT:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>351. </span>        xOffset
= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>352. </span>        yOffset
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>353. </span>    elif
playerMoveTo == DOWN:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>354. </span>        xOffset
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>355. </span>        yOffset
= 1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>356. </span>    elif
playerMoveTo == LEFT:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>357. </span>        xOffset
= -1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>358. </span>        yOffset
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>359. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>360. </span>    <span
class=SourceCodeComment># See if the player can move in that direction.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>361. </span>    if
isWall(mapObj, playerx + xOffset, playery + yOffset):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>362. </span>        return
False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>363. </span>    else:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>364. </span>        if
(playerx + xOffset, playery + yOffset) in stars:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>365. </span>            <span
class=SourceCodeComment># There is a star in the way, see if the player can
push it.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>366. </span>            if
not isBlocked(mapObj, gameStateObj, playerx + (xOffset*2), playery +
(yOffset*2)):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>367. </span>                <span
class=SourceCodeComment># Move the star.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>368. </span>                ind
= stars.index((playerx + xOffset, playery + yOffset))</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>369. </span>                stars[ind]
= (stars[ind][0] + xOffset, stars[ind][1] + yOffset)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>370. </span>            else:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>371. </span>                return
False</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>372. </span>        <span
class=SourceCodeComment># Move the player upwards.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>373. </span>        gameStateObj['player']
= (playerx + xOffset, playery + yOffset)</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>374. </span>        return
True</p>

</div>

<p class=MsoNormal>The <span class=Literal>makeMove()</span> function checks to
make sure if moving the player in a particular direction is a valid move. As
long as there isn’t a wall blocking the path, or a star that has a wall or star
behind it, the player will be able to move in that direction. The <span
class=Literal>gameStateObj</span> variable will be updated to reflect this, and
the <span class=Literal>True</span> value will be returned to tell the
function’s caller that the player was moved.</p>

<p class=MsoNormal>If there was a star in the space that the player wanted to
move, that star’s position is also changed and this information is updated in
the <span class=Literal>gameStateObj</span> variable as well. This is how the
“star pushing” is implemented.</p>

<p class=MsoNormal>If the player is blocked from moving in the desired
direction, then the <span class=Literal>gameStateObj</span> is not modified and
the function returns <span class=Literal>False</span>.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>377. </span>def
startScreen():</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>378. </span>    <span
class=SourceCodeComment>&quot;&quot;&quot;Display the start screen (which has
the title and instructions)</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>379. </span>    <span
class=SourceCodeComment>until the player presses a key. Returns
None.&quot;&quot;&quot;</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>380. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>381. </span>    <span
class=SourceCodeComment># Position the title image.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>382. </span>    titleRect
= IMAGESDICT['title'].get_rect()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>383. </span>    topCoord
= 50 <span class=SourceCodeComment># topCoord tracks where to position the top
of the text</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>384. </span>    titleRect.top
= topCoord</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>385. </span>    titleRect.centerx
= HALF_WINWIDTH</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>386. </span>    topCoord
+= titleRect.height</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>387. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>388. </span>    <span
class=SourceCodeComment># Unfortunately, Pygame's font &amp; text system only
shows one line at</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>389. </span>    <span
class=SourceCodeComment># a time, so we can't use strings with \n newline
characters in them.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>390. </span>    <span
class=SourceCodeComment># So we will use a list with each line in it.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>391. </span>    instructionText
= ['Push the stars over the marks.',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>392. </span>                       'Arrow
keys to move, WASD for camera control, P to change character.',</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>393. </span>                       'Backspace
to reset level, Esc to quit.',</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>394. </span>                       'N
for next level, B to go back a level.']</p>

</div>

<p class=MsoNormal>The <span class=Literal>startScreen()</span> function needs
to display a few different pieces of text down the center of the window. We
will store each line as a string in the <span class=Literal>instructionText</span>
list. The title image (stored in <span class=Literal>IMAGESDICT['title']</span>
as a Surface object (that was originally loaded from the <em>star_title.png</em>
file)) will be positioned 50 pixels from the top of the window. This is because
the integer <span class=Literal>50</span> was stored in the <span
class=Literal>topCoord</span> variable on line 383. The <span class=Literal>topCoord</span>
variable will track the Y axis positioning of the title image and the
instructional text. The X axis is always going to be set so that the images and
text are centered, as it is on line 385 for the title image.</p>

<p class=MsoNormal>On line 386, the <span class=Literal>topCoord</span>
variable is increased by whatever the height of that image is. This way we can
modify the image and the start screen code won’t have to be changed.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>396. </span>    <span
class=SourceCodeComment># Start with drawing a blank color to the entire
window:</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>397. </span>    DISPLAYSURF.fill(BGCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>398. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>399. </span>    <span
class=SourceCodeComment># Draw the title image to the window:</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>400. </span>    DISPLAYSURF.blit(IMAGESDICT['title'],
titleRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>401. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>402. </span>    <span
class=SourceCodeComment># Position and draw the text.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>403. </span>    for
i in range(len(instructionText)):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>404. </span>        instSurf
= BASICFONT.render(instructionText[i], 1, TEXTCOLOR)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>405. </span>        instRect
= instSurf.get_rect()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>406. </span>        topCoord
+= 10 <span class=SourceCodeComment># 10 pixels will go in between each line of
text.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>407. </span>        instRect.top
= topCoord</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>408. </span>        instRect.centerx
= HALF_WINWIDTH</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>409. </span>        topCoord
+= instRect.height <span class=SourceCodeComment># Adjust for the height of the
line.</span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>410. </span>        DISPLAYSURF.blit(instSurf,
instRect)</p>

</div>

<p class=MsoNormal>Line 400 is where the title image is blitted to the display
Surface object. The <span class=Literal>for</span> loop starting on line 403
will render, position, and blit each instructional string in the <span
class=Literal>instructionText</span> loop. The <span class=Literal>topCoord</span>
variable will always be incremented by the size of the previously rendered text
(line 409) and 10 additional pixels (on line 406, so that there will be a 10
pixel gap between the lines of text).</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>412. </span>    while
True: <span class=SourceCodeComment># Main loop for the start screen.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>413. </span>        for
event in pygame.event.get():</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>414. </span>            if
event.type == QUIT:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>415. </span>                terminate()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>416. </span>            elif
event.type == KEYDOWN:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>417. </span>                if
event.key == K_ESCAPE:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>418. </span>                    terminate()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>419. </span>                return
<span class=SourceCodeComment># user has pressed a key, so return.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>420. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>421. </span>        <span
class=SourceCodeComment># Display the DISPLAYSURF contents to the actual
screen.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>422. </span>        pygame.display.update()</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>423. </span>        FPSCLOCK.tick()</p>

</div>

<p class=MsoNormal>There is a game loop in <span class=Literal>startScreen()</span>
that begins on line 412 and handles events that indicate if the program should
terminate or return from the <span class=Literal>startScreen()</span> function.
Until the player does either, the loop will keep calling <span class=Literal>pygame.display.update()</span>
and <span class=Literal>FPSCLOCK.tick()</span> to keep the start screen
displayed on the screen.</p>

<h2><a name="_Toc316488740">Data Structures in Star Pusher</a></h2>

<p class=MsoNormal>Star Pusher has a specific format for the levels, maps, and
game state data structures.</p>

<h2><a name="_Toc316488741">The “Game State” Data Structure</a></h2>

<p class=MsoNormal>The game state object will be a dictionary with three keys: <span
class=Literal>'player'</span>, <span class=Literal>'stepCounter'</span>, and <span
class=Literal>'stars'</span>.</p>

<p class=MsoListParagraphCxSpFirst style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>The value at the <span class=Literal>'player'</span> key will be
a tuple of two integers for the current XY position of the player.</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>The value at the <span class=Literal>'stepCounter'</span> key will
be an integer that tracks how many moves the player has made in this level (so
the player can try to solve the puzzle in the future with fewer steps).</p>

<p class=MsoListParagraphCxSpLast style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>The value at the <span class=Literal>'stars'</span> key is a list
of two-integer tuples of XY values for each of the stars on the current level.</p>

<h2><a name="_Toc316488742">The “Map” Data Structure</a></h2>

<p class=MsoNormal>The map data structure is simply a 2D list of lists where
the two indexes used represent the X and Y coordinates of the map. The value at
each index in the list of lists is a single-character string that represents the
title that is on that map at each space:</p>

<p class=MsoListParagraphCxSpFirst style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span class=Literal>'#'</span> – A wooden wall.</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span class=Literal>'x'</span> – A corner wall.</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span class=Literal>'@'</span> – The starting space for the
player on this level.</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span class=Literal>'.'</span> – A goal space.</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span class=Literal>'$'</span> – A space where a star is at the
start of the level.</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span class=Literal>'+'</span> – A space with a goal and the
starting player’s space.</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span class=Literal>'*'</span> – A space with a goal and a star
at the start of the level.</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span class=Literal>' '</span> – A grassy outdoor space.</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span class=Literal>'o'</span> – An inside floor space. (This is
a lowercase letter O, not a zero.)</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span class=Literal>'1'</span> – A rock on grass.</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span class=Literal>'2'</span> – A short tree on grass.</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span class=Literal>'3'</span> – A tall tree on grass.</p>

<p class=MsoListParagraphCxSpLast style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span><span class=Literal>'4'</span> – An ugly tree on grass.</p>

<h2><a name="_Toc316488743">The “Levels” Data Structure</a></h2>

<p class=MsoNormal>The level object contains a game state object (which will be
the state used when the level first starts), a map object, and a few other
values. The level object itself is a dictionary with the following keys:</p>

<p class=MsoListParagraphCxSpFirst style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>The value at the key <span class=Literal>'width'</span> is an
integer of how many tiles wide the entire map is.</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>The value at the key <span class=Literal>'height'</span> is an
integer of how many tiles tall the entire map is.</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>The value at the key <span class=Literal>'mapObj'</span> is the
map object for this level.</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>The value at the key <span class=Literal>'goals'</span> is a list
of two-integer tuples with the XY coordinates of each goal space on the map.</p>

<p class=MsoListParagraphCxSpLast style='text-indent:-.25in'><span
style='font-family:Symbol'>·<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span>The value at the key <span class=Literal>'startState'</span> is a
game state object used to show the starting position of the stars and player at
the start of the level.</p>

<h2><a name="_Toc316488744">Reading and Writing Text Files</a></h2>

<p class=MsoNormal>Python has functions for reading files off of the player’s
hard drive. This will be useful for having a separate file keep all of the data
for each level. This is also a good idea because in order to get new levels,
the player doesn’t have to change the source code of the game but instead can
just download new level files.</p>

<h2><a name="_Toc316488745">Text Files and Binary Files</a></h2>

<p class=MsoNormal>Text files are files that contain simple text data. Text
files are created in Windows by the Notepad application, Gedit on Ubuntu, and
TextEdit on Mac OS X. There are many other programs called text editors that
can create and modify text files. IDLE’s own file editor is a text editor.</p>

<p class=MsoNormal>The difference between text editors and word processors
(like Microsoft Word, or OpenOffice Writer, or iWork Pages) is that text
editors have text only. You can’t set the font, size, or color of the text.
(IDLE automatically sets the color of the text based on what kind of Python
code it is, but you can’t change this yourself, so it is still a text editor.) The
difference between text and binary files isn’t important for this game program,
but you can read about it at <span class=URL><a href="http://invpy.com/textbinary">http://invpy.com/textbinary</a></span>.
All you need to know is the this chapter and the Star Pusher program only deal
with text files.</p>

<h2><a name="_Toc316488746">Writing to Files</a></h2>

<p class=MsoNormal>To create a file, call the <span class=Literal>open()</span>
function pass it two arguments: a string for the name of the file, and the
string <span class=Literal>'w'</span> to tell the <span class=Literal>open()</span>
function you want to open the file in “write” mode. The <span class=Literal>open()</span>
function returns a file object:</p>

<div style='border:solid windowtext 1.0pt;padding:4.0pt 4.0pt 4.0pt 4.0pt'>

<p class=CodeExampleCxSpFirst style='border:none;padding:0in'>&gt;&gt;&gt;
textFile = open('hello.txt', 'w')</p>

<p class=CodeExampleCxSpLast style='border:none;padding:0in'>&gt;&gt;&gt;&nbsp;</p>

</div>

<p class=MsoNormal>If you run this code from the interactive shell, the <em>hello.txt</em>
file that this function creates will be created in the same folder that the
python.exe program is in (on Windows, this will probably be C:\Python32). If
the <span class=Literal>open()</span> function is called from a .py program,
the file is created in the same folder that the .py file is in.</p>

<p class=MsoNormal>The “write” mode tells <span class=Literal>open()</span> to
create the file if it does not exist. If it does exist, then <span
class=Literal>open()</span> will delete that file and create a new, blank file.
This is just like how an assignment statement can create a new variable, or
overwrite the current value in an already existing variable. <strong>This can
be somewhat dangerous.</strong> If you accidentally send a filename of an
important file to the <span class=Literal>open()</span> function with <span
class=Literal>'w'</span> as the second parameter, it will be deleted. This
could result in having to reinstall the operating system on your computer
and/or the launching of nuclear missiles.</p>

<p class=MsoNormal>The file object has a method called <span class=Literal>write()</span>
which can be used to write text to the file. Just pass it a string like you
would pass a string to the <span class=Literal>print()</span> function. The
difference is that <span class=Literal>write()</span> does not automatically
add a newline character (<span class=Literal>'\n'</span>) to the end of the
string. If you want to add a newline, you will have to include it in the
string:</p>

<div style='border:solid windowtext 1.0pt;padding:4.0pt 4.0pt 4.0pt 4.0pt'>

<p class=CodeExampleCxSpFirst style='border:none;padding:0in'>&gt;&gt;&gt;
textFile = open('hello.txt', 'w')</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>&gt;&gt;&gt;
textFile.write('This will be the content of the file.\nHello world!\n')</p>

<p class=CodeExampleCxSpLast style='border:none;padding:0in'>&gt;&gt;&gt;&nbsp;</p>

</div>

<p class=MsoNormal>To tell Python that you are done writing content to this
file, you should call the <span class=Literal>close()</span> method of the file
object. (Although Python will automatically close any opened file objects when
the program ends.)</p>

<div style='border:solid windowtext 1.0pt;padding:4.0pt 4.0pt 4.0pt 4.0pt'>

<p class=CodeExample style='border:none;padding:0in'>&gt;&gt;&gt;
textFile.close()</p>

</div>

<h2><a name="_Toc316488747">Reading from Files</a></h2>

<p class=MsoNormal>To read the content of a file, pass the string <span
class=Literal>'r'</span> instead of <span class=Literal>'w'</span> to the <span
class=Literal>open()</span> function. Then call the <span class=Literal>readlines()</span>
method on the file object to read in the contents of the file. Last, close the
file by calling the <span class=Literal>close()</span> method.</p>

<div style='border:solid windowtext 1.0pt;padding:4.0pt 4.0pt 4.0pt 4.0pt'>

<p class=CodeExampleCxSpFirst style='border:none;padding:0in'>&gt;&gt;&gt;
textFile = open('hello.txt', 'r')</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>&gt;&gt;&gt;
content = textFile.readlines()</p>

<p class=CodeExampleCxSpLast style='border:none;padding:0in'>&gt;&gt;&gt;
textFile.close()</p>

</div>

<p class=MsoNormal>The <span class=Literal>readlines()</span> method returns a
list of strings: one string for each line of text in the file:</p>

<div style='border:solid windowtext 1.0pt;padding:4.0pt 4.0pt 4.0pt 4.0pt'>

<p class=CodeExampleCxSpFirst style='border:none;padding:0in'>&gt;&gt;&gt;
content</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>['This will be
the content of the file.\n', 'Hello world!\n']</p>

<p class=CodeExampleCxSpLast style='border:none;padding:0in'>&gt;&gt;&gt;&nbsp;</p>

</div>

<p class=MsoNormal>If you want to re-read the contents of that file, you will
have to call <span class=Literal>close()</span> on the file object and re-open
it.</p>

<p class=MsoNormal>As an alternative to <span class=Literal>readlines()</span>,
you can also call the <span class=Literal>read()</span> method, which will
return the entire contents of the file as a single string value:</p>

<div style='border:solid windowtext 1.0pt;padding:4.0pt 4.0pt 4.0pt 4.0pt'>

<p class=CodeExampleCxSpFirst style='border:none;padding:0in'>&gt;&gt;&gt; textFile
= open('hello.txt', 'r')</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>&gt;&gt;&gt;
content = textFile.read()</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>&gt;&gt;&gt;
content</p>

<p class=CodeExampleCxSpLast style='border:none;padding:0in'>'This will be the
content of the file.\nHello world!\n'</p>

</div>

<p class=MsoNormal>On a side note, if you leave out the second parameter to the
<span class=Literal>open()</span> function, Python will assume you mean to open
the file in read mode. So <span class=Literal>open('foobar.txt', 'r')</span>
and <span class=Literal>open('foobar.txt')</span> do the exact same thing.</p>

<h2><a name="_Toc316488748">About the Star Pusher Map File Format</a></h2>

<p class=MsoNormal>We need the level text file to be in a specific format.
Which characters represent walls, or stars, or the player’s starting position?
If we have the maps for multiple levels, how can we tell when one level’s map
ends and the next one begins?</p>

<p class=MsoNormal>Fortunately, the map file format we will use is already
defined for us. There are many Sokoban games out there (you can find more at <span
class=URL><a href="http://invpy.com/sokobanclones">http://invpy.com/sokobanclones</a></span>), and they all use the
same map file format. If you download the levels file from <span class=URL><a href="http://invpy.com/starPusherLevels.txt">http://invpy.com/starPusherLevels.txt</a></span>
and open it in a text editor, you’ll see something like this:</p>

<div style='border:solid windowtext 1.0pt;padding:4.0pt 4.0pt 4.0pt 4.0pt'>

<p class=CodeExampleCxSpFirst style='border:none;padding:0in'>; Star Pusher
(Sokoban clone)</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>;
http://inventwithpython.com/blog</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>; By Al Sweigart
al@inventwithpython.com</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>;</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>; Everything
after the ; is a comment and will be ignored by the game that</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>; reads in this
file.</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>;</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>; The format is
described at:</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>;
http://sokobano.de/wiki/index.php?title=Level_format</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>;   @ - The
starting position of the player.</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>;   $ - The
starting position for a pushable star.</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>;   . - A goal
where a star needs to be pushed.</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>;   + - Player
&amp; goal</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>;   * - Star
&amp; goal</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>;  (space) - an
empty open space.</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>;   # - A wall.</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>;</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>; Level maps are
separated by a blank line (I like to use a ; at the start</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>; of the line
since it is more visible.)</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>;</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>; I tried to use
the same format as other people use for their Sokoban games,</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>; so that
loading new levels is easy. Just place the levels in a text file</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>; and name it
&quot;starPusherLevels.txt&quot; (after renaming this file, of course).</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>&nbsp;</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>&nbsp;</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>; Starting demo
level:</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'> ########</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>##      #</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>#   .   #</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>#   $   #</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'># .$@$. #</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>####$   #</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>   #.   #</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>   #   ##</p>

<p class=CodeExampleCxSpLast style='border:none;padding:0in'>   #####</p>

</div>

<p class=MsoNormal>The comments at the top of the file explain the file’s
format. When you load the first level, it looks like this:</p>

<p class=MsoNormal align=center style='text-align:center'><img width=251
height=196 id="Picture 32" src="chapter9_files/image004.webp"></p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>426. </span>def
readLevelsFile(filename):</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>427. </span>    assert
os.path.exists(filename), 'Cannot find the level file: %s' % (filename)</p>

</div>

<p class=MsoNormal>The <span class=Literal>os.path.exists()</span> function
will return <span class=Literal>True</span> if the file specified by the string
passed to the function exists. If it does not exist, <span class=Literal>os.path.exists()</span>
returns <span class=Literal>False</span>.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>428. </span>    mapFile
= open(filename, 'r')</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>429. </span>    <span
class=SourceCodeComment># Each level must end with a blank line</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>430. </span>    content
= mapFile.readlines() + ['\r\n']</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>431.</span>     mapFile.close()</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>432.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>433. </span>    levels
= [] <span class=SourceCodeComment># Will contain a list of level objects.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>434. </span>    levelNum
= 0</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>435. </span>    mapTextLines
= [] <span class=SourceCodeComment># contains the lines for a single level's
map.</span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>436. </span>    mapObj
= [] <span class=SourceCodeComment># the map object made from the data in mapTextLines</span></p>

</div>

<p class=MsoNormal>The file object for the level file that is opened for
reading is stored in <span class=Literal>mapFile</span>. All of the text from
the level file is stored as a list of strings in the <span class=Literal>content</span>
variable, with a blank line added to the end. (The reason that this is done is
explained later.)</p>

<p class=MsoNormal>After the level objects are created, they will be stored in
the <span class=Literal>levels</span> list. The <span class=Literal>levelNum</span>
variable will keep track of how many levels are found inside the level file. The
<span class=Literal>mapTextLines</span> list will be a list of strings from the
<span class=Literal>content</span> list for a single map (as opposed to how <span
class=Literal>content</span> stores the strings of all maps in the level file).
The <span class=Literal>mapObj</span> variable will be a 2D list.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>437. </span>    for
lineNum in range(len(content)):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>438. </span>        <span
class=SourceCodeComment># Process each line that was in the level file.</span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>439. </span>        line
= content[lineNum].rstrip('\r\n')</p>

</div>

<p class=MsoNormal>The <span class=Literal>for</span> loop on line 437 will go
through each line that was read from the level file one line at a time. The
line number will be stored in <span class=Literal>lineNum</span> and the string
of text for the line will be stored in line. Any newline characters at the end
of the string will be stripped off.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>441. </span>        if
';' in line:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>442. </span>            <span
class=SourceCodeComment># Ignore the ; lines, they're comments in the level
file.</span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>443. </span>            line
= line[:line.find(';')]</p>

</div>

<p class=MsoNormal>Any text that exists after a semicolon in the map file is
treated like a comment and is ignored. This is just like the <span
class=Literal>#</span> sign for Python comments. To make sure that our code
does not accidentally think the comment is part of the map, the <span
class=Literal>line</span> variable is modified so that it only consists of the
text up to (but not including) the semicolon character. (Remember that this is
only changing the string in the <span class=Literal>content</span> list. It is
not changing the level file on the hard drive.)</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>445. </span>        if
line != '':</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>446. </span>            <span
class=SourceCodeComment># This line is part of the map.</span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>447. </span>            mapTextLines.append(line)</p>

</div>

<p class=MsoNormal>There can be maps for multiple levels in the map file. The <span
class=Literal>mapTextLines</span> list will contain the lines of text from the
map file for the current level being loaded. As long as the current line is not
blank, the line will be appended to the end of <span class=Literal>mapTextLines</span>.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>448. </span>        elif
line == '' and len(mapTextLines) &gt; 0:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>449. </span>            <span
class=SourceCodeComment># A blank line indicates the end of a level's map in
the file.</span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>450. </span>            <span
class=SourceCodeComment># Convert the text in mapTextLines into a level object.</span></p>

</div>

<p class=MsoNormal>When there is a blank line in the map file, that indicates
that the map for the current level has ended. And future lines of text will be
for the later levels. Note however, that there must at least be one line in <span
class=Literal>mapTextLines</span> so that multiple blank lines together are not
counted as the start and stop to multiple levels.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>452. </span>            <span
class=SourceCodeComment># Find the longest row in the map.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>453. </span>            maxWidth
= -1</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>454. </span>            for
i in range(len(mapTextLines)):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>455. </span>                if
len(mapTextLines[i]) &gt; maxWidth:</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>456. </span>                    maxWidth
= len(mapTextLines[i])</p>

</div>

<p class=MsoNormal>All of the strings in <span class=Literal>mapTextLines</span>
need to be the same length (so that they form a rectangle), so they should be
padded with extra blank spaces until they are all as long as the longest string.
The <span class=Literal>for</span> loop goes through each of the strings in <span
class=Literal>mapTextLines</span> and updates <span class=Literal>maxWidth</span>
when it finds a new longest string. After this loop finishes executing, the <span
class=Literal>maxWidth</span> variable will be set to the length of the longest
string in <span class=Literal>mapTextLines</span>.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>457. </span>            <span
class=SourceCodeComment># Add spaces to the ends of the shorter rows. This</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>458. </span>            <span
class=SourceCodeComment># ensures the map will be rectangular.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>459. </span>            for
i in range(len(mapTextLines)):</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>460. </span>                mapTextLines[i]
+= ' ' * (maxWidth - len(mapTextLines[i]))</p>

</div>

<p class=MsoNormal>The <span class=Literal>for</span> loop on line 459 goes
through the strings in <span class=Literal>mapTextLines</span> again, this time
to add enough space characters to pad each to be as long as <span
class=Literal>maxWidth</span>.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>462. </span>            <span
class=SourceCodeComment># Convert mapTextLines to a map object.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>463. </span>            for
x in range(len(mapTextLines[0])):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>464. </span>                mapObj.append([])</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>465. </span>            for
y in range(len(mapTextLines)):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>466. </span>                for
x in range(maxWidth):</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>467. </span>                    mapObj[x].append(mapTextLines[y][x])</p>

</div>

<p class=MsoNormal>The <span class=Literal>mapTextLines</span> variable just
stores a list of strings. (Each string in the list represents a row, and each
character in the string represents a character at a different column. This is
why line 467 has the Y and X indexes reversed, just like the <span
class=Literal>SHAPES</span> data structure in the Tetromino game.) But the map
object will have to be a list of list of single-character strings such that <span
class=Literal>mapObj[x][y]</span> refers to the tile at the XY coordinates. The
<span class=Literal>for</span> loop on line 463 adds an empty list to <span
class=Literal>mapObj</span> for each column in <span class=Literal>mapTextLines</span>.</p>

<p class=MsoNormal>The nested <span class=Literal>for</span> loops on line 465
and 466 will fill these lists with single-character strings to represent each
tile on the map. This creates the map object that Star Pusher uses.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>469. </span>            <span
class=SourceCodeComment># Loop through the spaces in the map and find the @, .,
and $</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>470. </span>            <span
class=SourceCodeComment># characters for the starting game state.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>471. </span>            startx
= None <span class=SourceCodeComment># The x and y for the player's starting
position</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>472. </span>            starty
= None</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>473. </span>            goals
= [] <span class=SourceCodeComment># list of (x, y) tuples for each goal.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>474. </span>            stars
= [] <span class=SourceCodeComment># list of (x, y) for each star's starting
position.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>475. </span>            for
x in range(maxWidth):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>476. </span>                for
y in range(len(mapObj[x])):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>477. </span>                    if
mapObj[x][y] in ('@', '+'):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>478. </span>                        <span
class=SourceCodeComment># '@' is player, '+' is player &amp; goal</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>479. </span>                        startx
= x</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>480. </span>                        starty
= y</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>481. </span>                    if
mapObj[x][y] in ('.', '+', '*'):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>482. </span>                        <span
class=SourceCodeComment># '.' is goal, '*' is star &amp; goal</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>483. </span>                        goals.append((x,
y))</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>484. </span>                    if
mapObj[x][y] in ('$', '*'):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>485. </span>                        <span
class=SourceCodeComment># '$' is star</span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>486. </span>                        stars.append((x,
y))</p>

</div>

<p class=MsoNormal>After creating the map object, the nested <span
class=Literal>for</span> loops on lines 475 and 476 will go through each space
to find the XY coordinates three things:</p>

<p class=MsoListParagraphCxSpFirst style='text-indent:-.25in'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>The
player’s starting position. This will be stored in the <span class=Literal>startx</span>
and <span class=Literal>starty</span> variables, which will then be stored in
the game state object later on line 494.</p>

<p class=MsoListParagraphCxSpMiddle style='text-indent:-.25in'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>The
starting position of all the stars These will be stored in the <span
class=Literal>stars</span> list, which is later stored in the game state object
on line 496.</p>

<p class=MsoListParagraphCxSpLast style='text-indent:-.25in'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>The
position of all the goals. These will be stored in the <span class=Literal>goals</span>
list, which is later stored in the level object on line 500.</p>

<p class=MsoNormal>Remember, the game state object contains all the things that
can change. This is why the player’s position is stored in it (because the
player can move around) and why the stars are stored in it (because the stars
can be pushed around by the player). But the goals are stored in the level
object, since they will never move around.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>488. </span>            <span
class=SourceCodeComment># Basic level design sanity checks:</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>489. </span>            assert
startx != None and starty != None, 'Level %s (around line %s) in %s is missing
a &quot;@&quot; or &quot;+&quot; to mark the start point.' % (levelNum+1,
lineNum, filename)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>490. </span>            assert
len(goals) &gt; 0, 'Level %s (around line %s) in %s must have at least one
goal.' % (levelNum+1, lineNum, filename)</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>491. </span>            assert
len(stars) &gt;= len(goals), 'Level %s (around line %s) in %s is impossible to
solve. It has %s goals but only %s stars.' % (levelNum+1, lineNum, filename,
len(goals), len(stars))</p>

</div>

<p class=MsoNormal>At this point, the level has been read in and processed. To
be sure that this level will work properly, a few assertions must pass. If any
of the conditions for these assertions are <span class=Literal>False</span>,
then Python will produce an error (using the string from the <span
class=Literal>assert</span> statement) saying what is wrong with the level
file.</p>

<p class=MsoNormal>The first assertion on line 489 checks to make sure that
there is a player starting point listed somewhere on the map. The second
assertion on line 490 checks to make sure there is at least one goal (or more)
somewhere on the map. And the third assertion on line 491 checks to make sure
that there is at least one star for each goal (but having more stars than goals
is allowed).</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>493. </span>            <span
class=SourceCodeComment># Create level object and starting game state object.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>494. </span>            gameStateObj
= {'player': (startx, starty),</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>495. </span>                            'stepCounter':
0,</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>496. </span>                            'stars':
stars}</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>497. </span>            levelObj
= {'width': maxWidth,</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>498. </span>                        'height':
len(mapObj),</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>499. </span>                        'mapObj':
mapObj,</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>500. </span>                        'goals':
goals,</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>501. </span>                        'startState':
gameStateObj}</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>502.</span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>503. </span>            levels.append(levelObj)</p>

</div>

<p class=MsoNormal>Finally, these objects are stored in the game state object,
which itself is stored in the level object. The level object is added to a list
of level objects on line 503. It is this <span class=Literal>levels</span> list
that will be returned by the <span class=Literal>readLevelsFile()</span>
function when all of the maps have been processed.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>505. </span>            <span
class=SourceCodeComment># Reset the variables for reading the next map.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>506. </span>            mapTextLines
= []</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>507. </span>            mapObj
= []</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>508. </span>            gameStateObj
= {}</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>509. </span>            levelNum
+= 1</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>510. </span>    return
levels</p>

</div>

<p class=MsoNormal>Now that this level is done processing, the variables for <span
class=Literal>mapTextLines</span>, <span class=Literal>mapObj</span>, and <span
class=Literal>gameStateObj</span> should be reset to blank values for the next
level that will be read in from the level file. The <span class=Literal>levelNum</span>
variable is also incremented by <span class=Literal>1</span> for the next
level’s level number.</p>

<h2><a name="_Toc316488749">Recursive Functions</a></h2>

<p class=MsoNormal>Before you can learn how the <span class=Literal>floodFill()</span>
function works, you need to learn about recursion. Recursion is a simple
concept: A <span class=Definition>recursive function</span> is just a function
that calls itself, like the one in the following program: (don’t type the
letters at the beginning of each line though)</p>

<div style='border:solid windowtext 1.0pt;padding:4.0pt 4.0pt 4.0pt 4.0pt'>

<p class=CodeExampleCxSpFirst style='border:none;padding:0in'><span
class=SourceCodeComment>A.</span> def passFortyTwoWhenYouCallThisFunction(param):</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'><span
class=SourceCodeComment>B.</span>     print('Start of function.')</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'><span
class=SourceCodeComment>C.</span>     if param != 42:</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'><span
class=SourceCodeComment>D.</span>         print('You did not pass 42 when you
called this function.')</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'><span
class=SourceCodeComment>E.</span>         print('Fine. I will do it myself.')</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'><span
class=SourceCodeComment>F.</span>         passFortyTwoWhenYouCallThisFunction(42)
<span class=SourceCodeComment># this is the recursive call</span></p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'><span
class=SourceCodeComment>G.</span>     if param == 42:</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'><span
class=SourceCodeComment>H.</span>         print('Thank you for passing 42 when
you called this function.')</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'><span
class=SourceCodeComment>I.</span>     print('End of function.')</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'><span
class=SourceLineNumber>J. </span></p>

<p class=CodeExampleCxSpLast style='border:none;padding:0in'><span
class=SourceLineNumber>K.</span> passFortyTwoWhenYouCallThisFunction(41)</p>

</div>

<p class=MsoNormal>(In your own programs, don’t make functions have names as
long as <span class=Literal>passFortyTwoWhenYouCallThisFunction()</span>. I’m
just being stupid and silly. Stupilly.)</p>

<p class=MsoNormal>When you run this program, the function gets defined when
the <span class=Literal>def</span> statement on line A executes. The next line
of code that is executed is line K, which calls <span class=Literal>passFortyTwoWhenYouCallThisFunction()</span>
and passes (gasp!) <span class=Literal>41</span>. As a result, the function
calls itself on line F and passes 42. We call this call the <span
class=Definition>recursive call</span>.</p>

<p class=MsoNormal>This is what our program outputs:</p>

<div style='border:solid windowtext 1.0pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SampleRunCxSpFirst>Start of function.</p>

<p class=SampleRunCxSpMiddle>You did not pass 42 when you called this function.</p>

<p class=SampleRunCxSpMiddle>Fine. I will do it myself.</p>

<p class=SampleRunCxSpMiddle>Start of function.</p>

<p class=SampleRunCxSpMiddle>Thank you for passing 42 when you called this
function.</p>

<p class=SampleRunCxSpMiddle>End of function.</p>

<p class=SampleRunCxSpLast>End of function.</p>

</div>

<p class=MsoNormal>Notice that the “Start of function.” and “End of function.”
text appears twice. Let’s figure out what exactly happens and what order it
happens in.</p>

<p class=MsoNormal>On line K, the function is called and 41 is passed for the
param parameter. Line B prints out “Start of function.”. The condition on line
C will be <span class=Literal>True</span> (since <span class=Literal>41 != 42</span>)
so Line C and D will print out their messages. Line F will then make a call,
recursively, to the function and passes <span class=Literal>42</span> for the
param parameter. So execution starts on line B again and prints out “Start of
function.”. Line C’s condition this time is <span class=Literal>False</span>,
so it skips to line G and finds that condition to be <span class=Literal>True</span>.
This causes line H to be called and displays “Thank you…” on the screen. Then
the last line of the function, line I, will execute to print out “End of
function.” and the function returns to the line that called it.</p>

<p class=MsoNormal>But remember, the line of code that called the function was
line F. And in this original call, param was set to <span class=Literal>41</span>.
The code goes down to line G and checks the condition, which is <span
class=Literal>False</span> (since <span class=Literal>41 == 42</span> is <span
class=Literal>False</span>) so it skips the <span class=Literal>print()</span>
call on line H. Instead, it runs the <span class=Literal>print()</span> call on
line I which makes “End of function.” display for a second time.</p>

<p class=MsoNormal>Since it has reached the end of the function, it returns to
the line of code that called this function call, which was line K. There are no
more lines of code after line K, so the program terminates. </p>

<p class=MsoNormal>Note that local variables are not just local to the
function, but to a specific call of the function.</p>

<h2><a name="_Toc316488750">Stack Overflows</a></h2>

<p class=MsoNormal>Each time a function is called, the Python interpreter
remembers which line of code made the call. That way when the function returns
Python knows where to resume the execution. Remembering this takes up a tiny
bit of memory. This isn’t normally a big deal, but take a look at this code:</p>

<div style='border:solid windowtext 1.0pt;padding:4.0pt 4.0pt 4.0pt 4.0pt'>

<p class=CodeExampleCxSpFirst style='border:none;padding:0in'>def funky():</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>    funky()</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>&nbsp;</p>

<p class=CodeExampleCxSpLast style='border:none;padding:0in'>funky()</p>

</div>

<p class=MsoNormal>If you run this program, you’ll get a large amount of output
which looks like this:</p>

<div style='border:solid windowtext 1.0pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SampleRunCxSpFirst>...</p>

<p class=SampleRunCxSpMiddle>  File &quot;C:\test67.py&quot;, line 2, in funky</p>

<p class=SampleRunCxSpMiddle>    funky()</p>

<p class=SampleRunCxSpMiddle>  File &quot;C:\test67.py&quot;, line 2, in funky</p>

<p class=SampleRunCxSpMiddle>    funky()</p>

<p class=SampleRunCxSpMiddle>  File &quot;C:\test67.py&quot;, line 2, in funky</p>

<p class=SampleRunCxSpMiddle>    funky()</p>

<p class=SampleRunCxSpMiddle>  File &quot;C:\test67.py&quot;, line 2, in funky</p>

<p class=SampleRunCxSpMiddle>    funky()</p>

<p class=SampleRunCxSpMiddle>  File &quot;C:\test67.py&quot;, line 2, in funky</p>

<p class=SampleRunCxSpMiddle>    funky()</p>

<p class=SampleRunCxSpLast>RuntimeError: maximum recursion depth exceeded</p>

</div>

<p class=MsoNormal>The <span class=Literal>funky()</span> function does nothing
but call itself. And then in that call, the function calls itself again. Then
it calls itself again, and again, and again. Each time it calls itself, Python
has to remember what line of code made that call so that when the function
returns it can resume the execution there. But the <span class=Literal>funky()</span>
function never returns, it just keeps making calls to itself.</p>

<p class=MsoNormal>This is just like the infinite loop bug, where the program
keeps going and never stops. To prevent itself from running out of memory,
Python will cause an error after you are a 1000 calls deep and crash the
program. This type of bug is called a <span class=Definition>stack overflow</span>.</p>

<p class=MsoNormal>This code also causes a stack overflow, even though there
are no recursive functions:</p>

<div style='border:solid windowtext 1.0pt;padding:4.0pt 4.0pt 4.0pt 4.0pt'>

<p class=CodeExampleCxSpFirst style='border:none;padding:0in'>def spam():</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>    eggs()</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>&nbsp;</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>def eggs():</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>    spam()</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>&nbsp;</p>

<p class=CodeExampleCxSpLast style='border:none;padding:0in'>spam()</p>

</div>

<p class=MsoNormal>When you run this program, it causes an error that looks
like this:</p>

<div style='border:solid windowtext 1.0pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SampleRunCxSpFirst>...</p>

<p class=SampleRunCxSpMiddle>  File &quot;C:\test67.py&quot;, line 2, in spam</p>

<p class=SampleRunCxSpMiddle>    eggs()</p>

<p class=SampleRunCxSpMiddle>  File &quot;C:\test67.py&quot;, line 5, in eggs</p>

<p class=SampleRunCxSpMiddle>    spam()</p>

<p class=SampleRunCxSpMiddle>  File &quot;C:\test67.py&quot;, line 2, in spam</p>

<p class=SampleRunCxSpMiddle>    eggs()</p>

<p class=SampleRunCxSpMiddle>  File &quot;C:\test67.py&quot;, line 5, in eggs</p>

<p class=SampleRunCxSpMiddle>    spam()</p>

<p class=SampleRunCxSpMiddle>  File &quot;C:\test67.py&quot;, line 2, in spam</p>

<p class=SampleRunCxSpMiddle>    eggs()</p>

<p class=SampleRunCxSpLast>RuntimeError: maximum recursion depth exceeded</p>

</div>

<h2><a name="_Toc316488751">Preventing Stack Overflows with a Base Case</a></h2>

<p class=MsoNormal>In order to prevent stack overflow bugs, you must have a <span
class=Definition>base case</span> where the function stops make new recursive
calls. If there is no base case then the function calls will never stop and
eventually a stack overflow will occur. Here is an example of a recursive
function with a base case. The base case is when the param parameter equals 2.</p>

<div style='border:solid windowtext 1.0pt;padding:4.0pt 4.0pt 4.0pt 4.0pt'>

<p class=CodeExampleCxSpFirst style='border:none;padding:0in'>def fizz(param):</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>    print(param)</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>    if param ==
2:</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>        return</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>    fizz(param -
1)</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>&nbsp;</p>

<p class=CodeExampleCxSpLast style='border:none;padding:0in'>fizz(5)</p>

</div>

<p class=MsoNormal>When you run this program, the output will look like this:</p>

<div style='border:solid windowtext 1.0pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SampleRunCxSpFirst>5</p>

<p class=SampleRunCxSpMiddle>4</p>

<p class=SampleRunCxSpMiddle>3</p>

<p class=SampleRunCxSpLast>2</p>

</div>

<p class=MsoNormal>This program does not have a stack overflow error because
once the param parameter is set to <span class=Literal>2</span>, the <span
class=Literal>if</span> statement’s condition will be <span class=Literal>True</span>
and the function will return, and then the rest of the calls will also return
in turn.</p>

<p class=MsoNormal>Though if your code never reaches the base case, then this
will cause a stack overflow. If we changed the <span class=Literal>fizz(5)</span>
call to <span class=Literal>fizz(0)</span>, then the program’s output would
look like this:</p>

<div style='border:solid windowtext 1.0pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SampleRunCxSpFirst>  File &quot;C:\rectest.py&quot;, line 5, in fizz</p>

<p class=SampleRunCxSpMiddle>    fizz(param - 1)</p>

<p class=SampleRunCxSpMiddle>  File &quot;C:\rectest.py&quot;, line 5, in fizz</p>

<p class=SampleRunCxSpMiddle>    fizz(param - 1)</p>

<p class=SampleRunCxSpMiddle>  File &quot;C:\rectest.py&quot;, line 5, in fizz</p>

<p class=SampleRunCxSpMiddle>    fizz(param - 1)</p>

<p class=SampleRunCxSpMiddle>  File &quot;C:\rectest.py&quot;, line 2, in fizz</p>

<p class=SampleRunCxSpMiddle>    print(param)</p>

<p class=SampleRunCxSpLast>RuntimeError: maximum recursion depth exceeded</p>

</div>

<p class=MsoNormal>Recursive calls and base cases will be used to perform the
flood fill algorithm, which is described next.</p>

<h2><a name="_Toc316488752">The Flood Fill Algorithm</a></h2>

<p class=MsoNormal>The flood fill algorithm is used in Star Pusher to change
all of the floor tiles inside the walls of the level to use the “inside floor”
tile image instead of the “outside floor” tile (which all the tiles on the map
are by default). The original <span class=Literal>floodFill()</span> call is on
line 295. It will convert any tiles represented with the <span class=Literal>'
'</span> string (which represents an outdoor floor) to a <span class=Literal>'o'</span>
string (which represents an indoor floor).</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>513. </span>def
floodFill(mapObj, x, y, oldCharacter, newCharacter):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>514. </span>    <span
class=SourceCodeComment>&quot;&quot;&quot;Changes any values matching
oldCharacter on the map object to</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>515. </span>    <span
class=SourceCodeComment>newCharacter at the (x, y) position, and does the same
for the</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>516. </span>    <span
class=SourceCodeComment>positions to the left, right, down, and up of (x, y),
recursively.&quot;&quot;&quot;</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>517. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>518. </span>    <span
class=SourceCodeComment># In this game, the flood fill algorithm creates the
inside/outside</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>519. </span>    <span
class=SourceCodeComment># floor distinction. This is a &quot;recursive&quot;
function.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>520. </span>    <span
class=SourceCodeComment># For more info on the Flood Fill algorithm, see:</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>521. </span>    <span
class=SourceCodeComment>#   http://en.wikipedia.org/wiki/Flood_fill</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>522. </span>    if
mapObj[x][y] == oldCharacter:</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>523. </span>        mapObj[x][y]
= newCharacter</p>

</div>

<p class=MsoNormal>Line 522 and 523 converts the tile at the XY coordinate
passed to <span class=Literal>floodFill()</span> to the <span class=Literal>newCharacter</span>
string if it originally was the same as the <span class=Literal>oldCharacter</span>
string.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>525. </span>    if
x &lt; len(mapObj) - 1 and mapObj[x+1][y] == oldCharacter:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>526. </span>        floodFill(mapObj,
x+1, y, oldCharacter, newCharacter) <span class=SourceCodeComment># call right</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>527. </span>    if
x &gt; 0 and mapObj[x-1][y] == oldCharacter:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>528. </span>        floodFill(mapObj,
x-1, y, oldCharacter, newCharacter) <span class=SourceCodeComment># call left</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>529. </span>    if
y &lt; len(mapObj[x]) - 1 and mapObj[x][y+1] == oldCharacter:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>530. </span>        floodFill(mapObj,
x, y+1, oldCharacter, newCharacter) <span class=SourceCodeComment># call down</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>531. </span>    if
y &gt; 0 and mapObj[x][y-1] == oldCharacter:</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>532. </span>        floodFill(mapObj,
x, y-1, oldCharacter, newCharacter) <span class=SourceCodeComment># call up</span></p>

</div>

<p class=MsoNormal>These four <span class=Literal>if</span> statements check if
the tile to the right, left, down, and up of the XY coordinate are the same as <span
class=Literal>oldCharacter</span>, and if so, a recursive call is made to <span
class=Literal>floodFill()</span> with those coordinates.</p>

<p class=MsoNormal>To better understand how the <span class=Literal>floodFill()</span>
function works, here is a version that does not use recursive calls, but
instead uses a list of XY coordinates to keep track of which spaces on the map
should be checked and possibly changed to <span class=Literal>newCharacter</span>.</p>

<div style='border:solid windowtext 1.0pt;padding:4.0pt 4.0pt 4.0pt 4.0pt'>

<p class=CodeExampleCxSpFirst style='border:none;padding:0in'>def
floodFill(mapObj, x, y, oldCharacter, newCharacter):</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>   
spacesToCheck = []</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>    if
mapObj[x][y] == oldCharacter:</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>       
spacesToCheck.append((x, y))</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>    while
spacesToCheck != []:</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>        x, y =
spacesToCheck.pop()</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>       
mapObj[x][y] = newCharacter</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>&nbsp;</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>        if x
&lt; len(mapObj) - 1 and mapObj[x+1][y] == oldCharacter:</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>           
spacesToCheck.append((x+1, y)) <span class=SourceCodeComment># check right</span></p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>        if x
&gt; 0 and mapObj[x-1][y] == oldCharacter:</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>           
spacesToCheck.append((x-1, y)) <span class=SourceCodeComment># check left</span></p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>        if y
&lt; len(mapObj[x]) - 1 and mapObj[x][y+1] == oldCharacter:</p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>           
spacesToCheck.append((x, y+1)) <span class=SourceCodeComment># check down</span></p>

<p class=CodeExampleCxSpMiddle style='border:none;padding:0in'>        if y
&gt; 0 and mapObj[x][y-1] == oldCharacter:</p>

<p class=CodeExampleCxSpLast style='border:none;padding:0in'>           
spacesToCheck.append((x, y-1)) <span class=SourceCodeComment># check up</span></p>

</div>

<p class=MsoNormal>If you would like to read a more detailed tutorial on
recursion that uses cats and zombies for an example, go to <span class=URL><a href="http://invpy.com/recursivezombies">http://invpy.com/recursivezombies</a></span>.</p>

<h2><a name="_Toc316488753">Drawing the Map</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>535. </span>def
drawMap(mapObj, gameStateObj, goals):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>536. </span>    <span
class=SourceCodeComment>&quot;&quot;&quot;Draws the map to a Surface object,
including the player and</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>537. </span>    <span
class=SourceCodeComment>stars. This function does not call pygame.display.update(),
nor</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>538. </span>    <span
class=SourceCodeComment>does it draw the &quot;Level&quot; and
&quot;Steps&quot; text in the corner.&quot;&quot;&quot;</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>539. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>540. </span>    <span
class=SourceCodeComment># mapSurf will be the single Surface object that the
tiles are drawn</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>541. </span>    <span
class=SourceCodeComment># on, so that it is easy to position the entire map on
the DISPLAYSURF</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>542. </span>    <span
class=SourceCodeComment># Surface object. First, the width and height must be
calculated.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>543. </span>    mapSurfWidth
= len(mapObj) * TILEWIDTH</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>544. </span>    mapSurfHeight
= (len(mapObj[0]) - 1) * (TILEHEIGHT - TILEFLOORHEIGHT) + TILEHEIGHT</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>545. </span>    mapSurf
= pygame.Surface((mapSurfWidth, mapSurfHeight))</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>546. </span>    mapSurf.fill(BGCOLOR)
<span class=SourceCodeComment># start with a blank color on the surface.</span></p>

</div>

<p class=MsoNormal>The <span class=Literal>drawMap()</span> function will
return a Surface object with the entire map (and the player and stars) drawn on
it. The width and height needed for this Surface have to be calculated from <span
class=Literal>mapObj</span> (which is done on line 543 and 544). The Surface
object that everything will be drawn on is created on line 545. To begin with,
the entire Surface object is painted to the background color on line 546.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>548. </span>    <span
class=SourceCodeComment># Draw the tile sprites onto this surface.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>549. </span>    for
x in range(len(mapObj)):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>550. </span>        for
y in range(len(mapObj[x])):</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>551. </span>            spaceRect
= pygame.Rect((x * TILEWIDTH, y * (TILEHEIGHT - TILEFLOORHEIGHT), TILEWIDTH,
TILEHEIGHT))</p>

</div>

<p class=MsoNormal>The set of nested <span class=Literal>for</span> loops on
line 549 and 550 will go through every possible XY coordinate on the map and
draw the appropriate tile image at that location.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>552. </span>            if
mapObj[x][y] in TILEMAPPING:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>553. </span>                baseTile
= TILEMAPPING[mapObj[x][y]]</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>554. </span>            elif
mapObj[x][y] in OUTSIDEDECOMAPPING:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>555. </span>                baseTile
= TILEMAPPING[' ']</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>556. </span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>557. </span>            <span
class=SourceCodeComment># First draw the base ground/wall tile.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>558. </span>            mapSurf.blit(baseTile,
spaceRect)</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>559. </span></p>

</div>

<p class=MsoNormal>The <span class=Literal>baseTile</span> variable is set to
the Surface object of the tile image to be drawn at the iteration’s current XY
coordinate. If the single-character string is in the <span class=Literal>OUTSIDEDECOMAPPING</span>
dictionary, then <span class=Literal>TILEMAPPING[' ']</span> (the
single-character string for the basic outdoor floor tile) will be used.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>560. </span>            if
mapObj[x][y] in OUTSIDEDECOMAPPING:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>561. </span>                <span
class=SourceCodeComment># Draw any tree/rock decorations that are on this tile.</span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>562. </span>                mapSurf.blit(OUTSIDEDECOMAPPING[mapObj[x][y]],
spaceRect)</p>

</div>

<p class=MsoNormal>Additionally, if the tile was listed in the <span
class=Literal>OUTSIDEDECOMAPPING</span> dictionary, the corresponding tree or
rock image should be drawn on top of the tile that was just drawn at that XY
coordinate.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>563. </span>            elif
(x, y) in gameStateObj['stars']:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>564. </span>                if
(x, y) in goals:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>565. </span>                    <span
class=SourceCodeComment># A goal AND star are on this space, draw goal first.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>566. </span>                    mapSurf.blit(IMAGESDICT['covered
goal'], spaceRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>567. </span>                <span
class=SourceCodeComment># Then draw the star sprite.</span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>568. </span>                mapSurf.blit(IMAGESDICT['star'],
spaceRect)</p>

</div>

<p class=MsoNormal>If there is a star located at this XY coordinate on the map
(which can be found out by checking for <span class=Literal>(x, y)</span> in
the list at <span class=Literal>gameStateObj['stars']</span>), then a star
should be drawn at this XY coordinate (which is done on line 568). Before the
star is drawn, the code should first check if there is also a goal at this
location, in which case, the “covered goal” tile should be drawn first.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>569. </span>            elif
(x, y) in goals:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>570. </span>                <span
class=SourceCodeComment># Draw a goal without a star on it.</span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>571. </span>                mapSurf.blit(IMAGESDICT['uncovered
goal'], spaceRect)</p>

</div>

<p class=MsoNormal>If there is a goal at this XY coordinate on the map, then
the “uncovered goal” should be drawn on top of the tile. The uncovered goal is
drawn because if execution has reached the <span class=Literal>elif</span>
statement on line 569, we know that the <span class=Literal>elif</span>
statement’s condition on line 563 was <span class=Literal>False</span> and
there is no star that is also at this XY coordinate.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>573. </span>            <span
class=SourceCodeComment># Last draw the player on the board.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>574. </span>            if
(x, y) == gameStateObj['player']:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>575. </span>                <span
class=SourceCodeComment># Note: The value &quot;currentImage&quot; refers</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>576. </span>                <span
class=SourceCodeComment># to a key in &quot;PLAYERIMAGES&quot; which has the</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>577. </span>                <span
class=SourceCodeComment># specific player image we want to show.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>578. </span>                mapSurf.blit(PLAYERIMAGES[currentImage],
spaceRect)</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>579. </span></p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>580. </span>    return
mapSurf</p>

</div>

<p class=MsoNormal>Finally, the <span class=Literal>drawMap()</span> function
checks if the player is located at this XY coordinate, and if so, the player’s
image is drawn over the tile. Line 580 is outside of the nested <span
class=Literal>for</span> loops that began on line 549 and 550, so by the time
the Surface object is returned, the entire map has been drawn on it.</p>

<h2><a name="_Toc316488754">Checking if the Level is Finished</a></h2>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>583. </span>def
isLevelFinished(levelObj, gameStateObj):</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>584. </span>    <span
class=SourceCodeComment>&quot;&quot;&quot;Returns True if all the goals have
stars in them.&quot;&quot;&quot;</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>585. </span>    for
goal in levelObj['goals']:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>586. </span>        if
goal not in gameStateObj['stars']:</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>587. </span>            <span
class=SourceCodeComment># Found a space with a goal but no star on it.</span></p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>588. </span>            return
False</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>589. </span>    return
True</p>

</div>

<p class=MsoNormal>The <span class=Literal>isLevelFinished()</span> function
returns <span class=Literal>True</span> if all the goals are covered stars. Some
levels could have more stars than goals, so it’s important to check that all
the goals are covered by stars, rather than checking if all the stars are over
goals.</p>

<p class=MsoNormal>The <span class=Literal>for</span> loop on line 585 goes
through the goals in <span class=Literal>levelObj['goals']</span> (which is a
list of tuples of XY coordinates for each goal) and checks if there is a star
in the <span class=Literal>gameStateObj['stars']</span> list that has those
same XY coordinates (the <span class=Literal>not in</span> operators work here
because <span class=Literal>gameStateObj['stars']</span> is a list of those
same tuples of XY coordinates). The first time the code finds a goal with no
star at the same position, the function returns <span class=Literal>False</span>.</p>

<p class=MsoNormal>If it gets through all of the goals and finds a star on each
of them, <span class=Literal>isLevelFinished()</span> returns <span
class=Literal>True</span>.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>592. </span>def
terminate():</p>

<p class=SourceCodeFeaturedCxSpMiddle><span class=SourceLineNumber>593. </span>    pygame.quit()</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>594. </span>    sys.exit()</p>

</div>

<p class=MsoNormal>This <span class=Literal>terminate()</span> function is the
same as in all the previous programs.</p>

<div style='border:double windowtext 1.5pt;padding:6.0pt 4.0pt 6.0pt 4.0pt'>

<p class=SourceCodeFeaturedCxSpFirst><span class=SourceLineNumber>597. </span>if
__name__ == '__main__':</p>

<p class=SourceCodeFeaturedCxSpLast><span class=SourceLineNumber>598. </span>    main()</p>

</div>

<p class=MsoNormal>After all the functions have been defined, the <span
class=Literal>main()</span> function is called on line 602 to begin the game.</p>

<h2><a name="_Toc316488755">Summary</a></h2>

<p class=MsoNormal>In the Squirrel Eat Squirrel game, the game world was pretty
simple: just an infinite green plain with grass images randomly scattered
around it. The Star Pusher game introduced something new: having uniquely
designed levels with tile graphics. In order to store these levels in a format
that the computer can read, they are typed out into a text file and code in the
program reads those files and creates the data structures for the level.</p>

<p class=MsoNormal>Really, rather than just make a simple game with a single
map, the Star Pusher program is more of a system for loading custom maps based
on the level file. Just by modifying the level file, we can change where walls,
stars, and goals appear in the game world. The Star Pusher program can handle
any configuration that the level file is set to (as long as it passes the <span
class=Literal>assert</span> statements that ensure the map makes sense).</p>

<p class=MsoNormal>You won’t even have to know how to program Python to make
your own levels. A text editor program that modifies the <em>starPusherLevels.txt</em>
file is all that anyone needs to have their own level editor for the Star
Pusher game.</p>

<p class=MsoNormal>For additional programming practice, you can download buggy
versions of Star Pusher from <span class=URL><a href="http://invpy.com/buggy/starpusher">http://invpy.com/buggy/starpusher</a></span>
and try to figure out how to fix the bugs.</p>

</div>

</body>

</html>
