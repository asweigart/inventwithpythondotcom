<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link href="style.css" rel="stylesheet" type="text/css" /><link rel="stylesheet" type="text/css" href="pygments.css"><title>Hourglass</title></head><body style="background-color: #fffeee;">

<script type="text/javascript">
//<![CDATA[

var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-5459430-3']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

//]]>
</script>


<div style="background-color: #eeeddd; float: right; height: 310px; font-family: sans-serif;" id="otherbooks">
  <a href="#" onclick="document.getElementById('otherbooks').outerHTML='';" style="vertical-align: top;">(close)</a><br />

  <a target="_blank" href="https://nostarch.com/automatestuff2" onclick="javascript: pageTracker._trackPageview('/affiliate_chapters_automate.link');"><img src="/images/cover_automate2_thumb.webp" style="height: 200px; border: solid black 1px;" /></a>
  <a target="_blank" href="https://nostarch.com/big-book-small-python-projects" onclick="javascript: pageTracker._trackPageview('/affiliate_chapters_bigbookpython.link');"><img src="/images/cover_bigbookpython_thumb.webp" style="height: 200px; border: solid black 1px;" /></a>
  <a target="_blank" href="https://nostarch.com/beyond-basic-stuff-python" onclick="javascript: pageTracker._trackPageview('/affiliate_chapters_beyond.link');"><img src="/images/cover_beyond_thumb.webp" style="height: 200px; border: solid black 1px;" /></a>
  <a target="_blank" href="https://nostarch.com/inventwithpython" onclick="javascript: pageTracker._trackPageview('/affiliate_chapters_invent.link');"><img src="/images/cover_invent4th_thumb.webp" style="height: 200px; border: solid black 1px;" /></a>
  <a target="_blank" href="https://www.amazon.com/Making-Games-Python-Pygame-Sweigart/dp/1469901730?ie=UTF8&amp;tag=playwithpyth-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=1469901730" onclick="javascript: pageTracker._trackPageview('/affiliate_chapters_pygame.link');"><img src="/images/cover_makinggames_thumb.webp" style="height: 200px; border: solid black 1px; /"></a>
  <a target="_blank" href="https://nostarch.com/crackingcodes" onclick="javascript: pageTracker._trackPageview('/affiliate_chapters_hacking.link');"><img src="/images/cover_crackingcodes_thumb.webp" style="height: 200px; border: solid black 1px;" /></a>
  <a target="_blank" href="https://nostarch.com/scratchplayground"><img src="/images/cover_scratchprogrammingplayground_thumb.webp" style="height: 200px; border: solid black 1px;" /></a>
  <a target="_blank" href="https://nostarch.com/codingwithminecraft"><img src="/images/cover_codingwithminecraft_thumb.webp" style="height: 200px; border: solid black 1px;" /></a>
  <br />
  <a href="https://inventwithpython.com/automateudemy">Use this link to get 70% off the Automate the Boring Stuff online video course.</a><br />
  <a href="https://www.patreon.com/AlSweigart">Support me on Patreon</a>
</div>

<a href="project35.html">Prev: Hex Grid</a> | <a href="project37.html">Next: Hungry Robots</a>





<div type="bodymatter chapter" class="calibre1" id="calibre_link-8">
<section class="toclist">
<header class="calibre10">
<h1 class="chapter">
<span class="chapternumber">#36</span><br class="calibre14" />
<span class="chaptertitle">Hourglass</span></h1>
</header>
<figure class="opener">
<img src="images/000002.webp" alt="" class="calibre12" />
</figure>
<p class="chapterintro">This visualization program has a rough physics engine that simulates sand falling through the small aperture of an hourglass. The sand piles up in the bottom half of the hourglass; then the hourglass is turned over so the process repeats.</p>
<h2 id="calibre_link-166" class="calibre5">The Program in Action</h2>
<p class="bodyfirst"><a href="#calibre_link-9" id="calibre_link-802" class="linkurl">Figure 36-1</a> shows what the output will look like when you run <em class="calibre9">hourglass.py</em>.</p>
<figure class="calibre28">
<img src="images/000013.webp" alt="f36001" class="calibre12" />
<figcaption class="calibre29"><p class="calibre30"><a id="calibre_link-9" class="linkurl">Figure 36-1</a>: The output of the hourglass program with sand falling</p></figcaption>
</figure>
<h2 id="calibre_link-167" class="calibre5">How It Works</h2>
<p class="bodyfirst">The hourglass program implements a rudimentary physics engine. A <em class="calibre9">physics engine</em> is software that simulates physical objects falling under gravity, colliding with each other, and moving according to the laws of physics. You’ll find physics engines used in video games, computer animation, and scientific simulations. On lines 91 to 102, each “grain” of sand checks if the space beneath it is empty and moves down if it is. Otherwise, it checks if it can move down and to the left (lines 104 to 112) or down and to the right (lines 114 to 122). Of course, there is much more to <em class="calibre9">kinematics</em>, the branch of classical physics that deals with the motion of macroscopic objects, than this. However, you don’t need a degree in physics to make a primitive simulation of sand in an hourglass that is enjoyable to look at.</p>
<div class="highlight"><pre><span></span>
<span class="c">  1. </span><span class="sd">&quot;&quot;&quot;Hourglass, by Al Sweigart al@inventwithpython.com</span>
<span class="c">  2. </span><span class="sd">An animation of an hourglass with falling sand. Press Ctrl-C to stop.</span>
<span class="c">  3. </span><span class="sd">This code is available at https://nostarch.com/big-book-small-python-programming</span>
<span class="c">  4. </span><span class="sd">Tags: large, artistic, bext, simulation&quot;&quot;&quot;</span>
<span class="c">  5. </span>
<span class="c">  6. </span><span class="kn">import</span> <span class="nn">random</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">time</span>
<span class="c">  7. </span>
<span class="c">  8. </span><span class="k">try</span><span class="p">:</span>
<span class="c">  9. </span>    <span class="kn">import</span> <span class="nn">bext</span>
<span class="c"> 10. </span><span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
<span class="c"> 11. </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;This program requires the bext module, which you&#39;</span><span class="p">)</span>
<span class="c"> 12. </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;can install by following the instructions at&#39;</span><span class="p">)</span>
<span class="c"> 13. </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;https://pypi.org/project/Bext/&#39;</span><span class="p">)</span>
<span class="c"> 14. </span>    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
<span class="c"> 15. </span>
<span class="c"> 16. </span><span class="c1"># Set up the constants:</span>
<span class="c"> 17. </span><span class="n">PAUSE_LENGTH</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># (!) Try changing this to 0.0 or 1.0.</span>
<span class="c"> 18. </span><span class="c1"># (!) Try changing this to any number between 0 and 100:</span>
<span class="c"> 19. </span><span class="n">WIDE_FALL_CHANCE</span> <span class="o">=</span> <span class="mi">50</span>
<span class="c"> 20. </span>
<span class="c"> 21. </span><span class="n">SCREEN_WIDTH</span> <span class="o">=</span> <span class="mi">79</span>
<span class="c"> 22. </span><span class="n">SCREEN_HEIGHT</span> <span class="o">=</span> <span class="mi">25</span>
<span class="c"> 23. </span><span class="n">X</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># The index of X values in an (x, y) tuple is 0.</span>
<span class="c"> 24. </span><span class="n">Y</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># The index of Y values in an (x, y) tuple is 1.</span>
<span class="c"> 25. </span><span class="n">SAND</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">9617</span><span class="p">)</span>
<span class="c"> 26. </span><span class="n">WALL</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">9608</span><span class="p">)</span>
<span class="c"> 27. </span>
<span class="c"> 28. </span><span class="c1"># Set up the walls of the hour glass:</span>
<span class="c"> 29. </span><span class="n">HOURGLASS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>  <span class="c1"># Has (x, y) tuples for where hourglass walls are.</span>
<span class="c"> 30. </span><span class="c1"># (!) Try commenting out some HOURGLASS.add() lines to erase walls:</span>
<span class="c"> 31. </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">37</span><span class="p">):</span>
<span class="c"> 32. </span>    <span class="n">HOURGLASS</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># Add walls for the top cap of the hourglass.</span>
<span class="c"> 33. </span>    <span class="n">HOURGLASS</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="mi">23</span><span class="p">))</span>  <span class="c1"># Add walls for the bottom cap.</span>
<span class="c"> 34. </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
<span class="c"> 35. </span>    <span class="n">HOURGLASS</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="mi">18</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>  <span class="c1"># Add walls for the top left straight wall.</span>
<span class="c"> 36. </span>    <span class="n">HOURGLASS</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="mi">36</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>  <span class="c1"># Add walls for the top right straight wall.</span>
<span class="c"> 37. </span>    <span class="n">HOURGLASS</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="mi">18</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">19</span><span class="p">))</span>  <span class="c1"># Add walls for the bottom left.</span>
<span class="c"> 38. </span>    <span class="n">HOURGLASS</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="mi">36</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">19</span><span class="p">))</span>  <span class="c1"># Add walls for the bottom right.</span>
<span class="c"> 39. </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
<span class="c"> 40. </span>    <span class="n">HOURGLASS</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="mi">19</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">i</span><span class="p">))</span>  <span class="c1"># Add the top left slanted wall.</span>
<span class="c"> 41. </span>    <span class="n">HOURGLASS</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="mi">35</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">i</span><span class="p">))</span>  <span class="c1"># Add the top right slanted wall.</span>
<span class="c"> 42. </span>    <span class="n">HOURGLASS</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="mi">25</span> <span class="o">-</span> <span class="n">i</span><span class="p">,</span> <span class="mi">13</span> <span class="o">+</span> <span class="n">i</span><span class="p">))</span>  <span class="c1"># Add the bottom left slanted wall.</span>
<span class="c"> 43. </span>    <span class="n">HOURGLASS</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="mi">29</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="mi">13</span> <span class="o">+</span> <span class="n">i</span><span class="p">))</span>  <span class="c1"># Add the bottom right slanted wall.</span>
<span class="c"> 44. </span>
<span class="c"> 45. </span><span class="c1"># Set up the initial sand at the top of the hourglass:</span>
<span class="c"> 46. </span><span class="n">INITIAL_SAND</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="c"> 47. </span><span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
<span class="c"> 48. </span>    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">19</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span> <span class="mi">36</span> <span class="o">-</span> <span class="n">y</span><span class="p">):</span>
<span class="c"> 49. </span>        <span class="n">INITIAL_SAND</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">4</span><span class="p">))</span>
<span class="c"> 50. </span>
<span class="c"> 51. </span>
<span class="c"> 52. </span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="c"> 53. </span>    <span class="n">bext</span><span class="o">.</span><span class="n">fg</span><span class="p">(</span><span class="s1">&#39;yellow&#39;</span><span class="p">)</span>
<span class="c"> 54. </span>    <span class="n">bext</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="c"> 55. </span>
<span class="c"> 56. </span>    <span class="c1"># Draw the quit message:</span>
<span class="c"> 57. </span>    <span class="n">bext</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="c"> 58. </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Ctrl-C to quit.&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="c"> 59. </span>
<span class="c"> 60. </span>    <span class="c1"># Display the walls of the hourglass:</span>
<span class="c"> 61. </span>    <span class="k">for</span> <span class="n">wall</span> <span class="ow">in</span> <span class="n">HOURGLASS</span><span class="p">:</span>
<span class="c"> 62. </span>        <span class="n">bext</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="n">wall</span><span class="p">[</span><span class="n">X</span><span class="p">],</span> <span class="n">wall</span><span class="p">[</span><span class="n">Y</span><span class="p">])</span>
<span class="c"> 63. </span>        <span class="nb">print</span><span class="p">(</span><span class="n">WALL</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="c"> 64. </span>
<span class="c"> 65. </span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1"># Main program loop.</span>
<span class="c"> 66. </span>        <span class="n">allSand</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">INITIAL_SAND</span><span class="p">)</span>
<span class="c"> 67. </span>
<span class="c"> 68. </span>        <span class="c1"># Draw the initial sand:</span>
<span class="c"> 69. </span>        <span class="k">for</span> <span class="n">sand</span> <span class="ow">in</span> <span class="n">allSand</span><span class="p">:</span>
<span class="c"> 70. </span>            <span class="n">bext</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="n">sand</span><span class="p">[</span><span class="n">X</span><span class="p">],</span> <span class="n">sand</span><span class="p">[</span><span class="n">Y</span><span class="p">])</span>
<span class="c"> 71. </span>            <span class="nb">print</span><span class="p">(</span><span class="n">SAND</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="c"> 72. </span>
<span class="c"> 73. </span>        <span class="n">runHourglassSimulation</span><span class="p">(</span><span class="n">allSand</span><span class="p">)</span>
<span class="c"> 74. </span>
<span class="c"> 75. </span>
<span class="c"> 76. </span><span class="k">def</span> <span class="nf">runHourglassSimulation</span><span class="p">(</span><span class="n">allSand</span><span class="p">):</span>
<span class="c"> 77. </span>    <span class="sd">&quot;&quot;&quot;Keep running the sand falling simulation until the sand stops</span>
<span class="c"> 78. </span><span class="sd">    moving.&quot;&quot;&quot;</span>
<span class="c"> 79. </span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1"># Keep looping until sand has run out.</span>
<span class="c"> 80. </span>        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">allSand</span><span class="p">)</span>  <span class="c1"># Random order of grain simulation.</span>
<span class="c"> 81. </span>
<span class="c"> 82. </span>        <span class="n">sandMovedOnThisStep</span> <span class="o">=</span> <span class="kc">False</span>
<span class="c"> 83. </span>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sand</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">allSand</span><span class="p">):</span>
<span class="c"> 84. </span>            <span class="k">if</span> <span class="n">sand</span><span class="p">[</span><span class="n">Y</span><span class="p">]</span> <span class="o">==</span> <span class="n">SCREEN_HEIGHT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
<span class="c"> 85. </span>                <span class="c1"># Sand is on the very bottom, so it won&#39;t move:</span>
<span class="c"> 86. </span>                <span class="k">continue</span>
<span class="c"> 87. </span>
<span class="c"> 88. </span>            <span class="c1"># If nothing is under this sand, move it down:</span>
<span class="c"> 89. </span>            <span class="n">noSandBelow</span> <span class="o">=</span> <span class="p">(</span><span class="n">sand</span><span class="p">[</span><span class="n">X</span><span class="p">],</span> <span class="n">sand</span><span class="p">[</span><span class="n">Y</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allSand</span>
<span class="c"> 90. </span>            <span class="n">noWallBelow</span> <span class="o">=</span> <span class="p">(</span><span class="n">sand</span><span class="p">[</span><span class="n">X</span><span class="p">],</span> <span class="n">sand</span><span class="p">[</span><span class="n">Y</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">HOURGLASS</span>
<span class="c"> 91. </span>            <span class="n">canFallDown</span> <span class="o">=</span> <span class="n">noSandBelow</span> <span class="ow">and</span> <span class="n">noWallBelow</span>
<span class="c"> 92. </span>
<span class="c"> 93. </span>            <span class="k">if</span> <span class="n">canFallDown</span><span class="p">:</span>
<span class="c"> 94. </span>                <span class="c1"># Draw the sand in its new position down one space:</span>
<span class="c"> 95. </span>                <span class="n">bext</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="n">sand</span><span class="p">[</span><span class="n">X</span><span class="p">],</span> <span class="n">sand</span><span class="p">[</span><span class="n">Y</span><span class="p">])</span>
<span class="c"> 96. </span>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># Clear the old position.</span>
<span class="c"> 97. </span>                <span class="n">bext</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="n">sand</span><span class="p">[</span><span class="n">X</span><span class="p">],</span> <span class="n">sand</span><span class="p">[</span><span class="n">Y</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="c"> 98. </span>                <span class="nb">print</span><span class="p">(</span><span class="n">SAND</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="c"> 99. </span>
<span class="c">100. </span>                <span class="c1"># Set the sand in its new position down one space:</span>
<span class="c">101. </span>                <span class="n">allSand</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sand</span><span class="p">[</span><span class="n">X</span><span class="p">],</span> <span class="n">sand</span><span class="p">[</span><span class="n">Y</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="c">102. </span>                <span class="n">sandMovedOnThisStep</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c">103. </span>            <span class="k">else</span><span class="p">:</span>
<span class="c">104. </span>                <span class="c1"># Check if the sand can fall to the left:</span>
<span class="c">105. </span>                <span class="n">belowLeft</span> <span class="o">=</span> <span class="p">(</span><span class="n">sand</span><span class="p">[</span><span class="n">X</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sand</span><span class="p">[</span><span class="n">Y</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="c">106. </span>                <span class="n">noSandBelowLeft</span> <span class="o">=</span> <span class="n">belowLeft</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allSand</span>
<span class="c">107. </span>                <span class="n">noWallBelowLeft</span> <span class="o">=</span> <span class="n">belowLeft</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">HOURGLASS</span>
<span class="c">108. </span>                <span class="n">left</span> <span class="o">=</span> <span class="p">(</span><span class="n">sand</span><span class="p">[</span><span class="n">X</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sand</span><span class="p">[</span><span class="n">Y</span><span class="p">])</span>
<span class="c">109. </span>                <span class="n">noWallLeft</span> <span class="o">=</span> <span class="n">left</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">HOURGLASS</span>
<span class="c">110. </span>                <span class="n">notOnLeftEdge</span> <span class="o">=</span> <span class="n">sand</span><span class="p">[</span><span class="n">X</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="c">111. </span>                <span class="n">canFallLeft</span> <span class="o">=</span> <span class="p">(</span><span class="n">noSandBelowLeft</span> <span class="ow">and</span> <span class="n">noWallBelowLeft</span>
<span class="c">112. </span>                    <span class="ow">and</span> <span class="n">noWallLeft</span> <span class="ow">and</span> <span class="n">notOnLeftEdge</span><span class="p">)</span>
<span class="c">113. </span>
<span class="c">114. </span>                <span class="c1"># Check if the sand can fall to the right:</span>
<span class="c">115. </span>                <span class="n">belowRight</span> <span class="o">=</span> <span class="p">(</span><span class="n">sand</span><span class="p">[</span><span class="n">X</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sand</span><span class="p">[</span><span class="n">Y</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="c">116. </span>                <span class="n">noSandBelowRight</span> <span class="o">=</span> <span class="n">belowRight</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allSand</span>
<span class="c">117. </span>                <span class="n">noWallBelowRight</span> <span class="o">=</span> <span class="n">belowRight</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">HOURGLASS</span>
<span class="c">118. </span>                <span class="n">right</span> <span class="o">=</span> <span class="p">(</span><span class="n">sand</span><span class="p">[</span><span class="n">X</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sand</span><span class="p">[</span><span class="n">Y</span><span class="p">])</span>
<span class="c">119. </span>                <span class="n">noWallRight</span> <span class="o">=</span> <span class="n">right</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">HOURGLASS</span>
<span class="c">120. </span>                <span class="n">notOnRightEdge</span> <span class="o">=</span> <span class="n">sand</span><span class="p">[</span><span class="n">X</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">SCREEN_WIDTH</span> <span class="o">-</span> <span class="mi">1</span>
<span class="c">121. </span>                <span class="n">canFallRight</span> <span class="o">=</span> <span class="p">(</span><span class="n">noSandBelowRight</span> <span class="ow">and</span> <span class="n">noWallBelowRight</span>
<span class="c">122. </span>                    <span class="ow">and</span> <span class="n">noWallRight</span> <span class="ow">and</span> <span class="n">notOnRightEdge</span><span class="p">)</span>
<span class="c">123. </span>
<span class="c">124. </span>                <span class="c1"># Set the falling direction:</span>
<span class="c">125. </span>                <span class="n">fallingDirection</span> <span class="o">=</span> <span class="kc">None</span>
<span class="c">126. </span>                <span class="k">if</span> <span class="n">canFallLeft</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">canFallRight</span><span class="p">:</span>
<span class="c">127. </span>                    <span class="n">fallingDirection</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># Set the sand to fall left.</span>
<span class="c">128. </span>                <span class="k">elif</span> <span class="ow">not</span> <span class="n">canFallLeft</span> <span class="ow">and</span> <span class="n">canFallRight</span><span class="p">:</span>
<span class="c">129. </span>                    <span class="n">fallingDirection</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Set the sand to fall right.</span>
<span class="c">130. </span>                <span class="k">elif</span> <span class="n">canFallLeft</span> <span class="ow">and</span> <span class="n">canFallRight</span><span class="p">:</span>
<span class="c">131. </span>                    <span class="c1"># Both are possible, so randomly set it:</span>
<span class="c">132. </span>                    <span class="n">fallingDirection</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="c">133. </span>
<span class="c">134. </span>                <span class="c1"># Check if the sand can &quot;far&quot; fall two spaces to</span>
<span class="c">135. </span>                <span class="c1"># the left or right instead of just one space:</span>
<span class="c">136. </span>                <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">&lt;=</span> <span class="n">WIDE_FALL_CHANCE</span><span class="p">:</span>
<span class="c">137. </span>                    <span class="n">belowTwoLeft</span> <span class="o">=</span> <span class="p">(</span><span class="n">sand</span><span class="p">[</span><span class="n">X</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sand</span><span class="p">[</span><span class="n">Y</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="c">138. </span>                    <span class="n">noSandBelowTwoLeft</span> <span class="o">=</span> <span class="n">belowTwoLeft</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allSand</span>
<span class="c">139. </span>                    <span class="n">noWallBelowTwoLeft</span> <span class="o">=</span> <span class="n">belowTwoLeft</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">HOURGLASS</span>
<span class="c">140. </span>                    <span class="n">notOnSecondToLeftEdge</span> <span class="o">=</span> <span class="n">sand</span><span class="p">[</span><span class="n">X</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span>
<span class="c">141. </span>                    <span class="n">canFallTwoLeft</span> <span class="o">=</span> <span class="p">(</span><span class="n">canFallLeft</span> <span class="ow">and</span> <span class="n">noSandBelowTwoLeft</span>
<span class="c">142. </span>                        <span class="ow">and</span> <span class="n">noWallBelowTwoLeft</span> <span class="ow">and</span> <span class="n">notOnSecondToLeftEdge</span><span class="p">)</span>
<span class="c">143. </span>
<span class="c">144. </span>                    <span class="n">belowTwoRight</span> <span class="o">=</span> <span class="p">(</span><span class="n">sand</span><span class="p">[</span><span class="n">X</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sand</span><span class="p">[</span><span class="n">Y</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="c">145. </span>                    <span class="n">noSandBelowTwoRight</span> <span class="o">=</span> <span class="n">belowTwoRight</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allSand</span>
<span class="c">146. </span>                    <span class="n">noWallBelowTwoRight</span> <span class="o">=</span> <span class="n">belowTwoRight</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">HOURGLASS</span>
<span class="c">147. </span>                    <span class="n">notOnSecondToRightEdge</span> <span class="o">=</span> <span class="n">sand</span><span class="p">[</span><span class="n">X</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">SCREEN_WIDTH</span> <span class="o">-</span> <span class="mi">2</span>
<span class="c">148. </span>                    <span class="n">canFallTwoRight</span> <span class="o">=</span> <span class="p">(</span><span class="n">canFallRight</span>
<span class="c">149. </span>                        <span class="ow">and</span> <span class="n">noSandBelowTwoRight</span> <span class="ow">and</span> <span class="n">noWallBelowTwoRight</span>
<span class="c">150. </span>                        <span class="ow">and</span> <span class="n">notOnSecondToRightEdge</span><span class="p">)</span>
<span class="c">151. </span>
<span class="c">152. </span>                    <span class="k">if</span> <span class="n">canFallTwoLeft</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">canFallTwoRight</span><span class="p">:</span>
<span class="c">153. </span>                        <span class="n">fallingDirection</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
<span class="c">154. </span>                    <span class="k">elif</span> <span class="ow">not</span> <span class="n">canFallTwoLeft</span> <span class="ow">and</span> <span class="n">canFallTwoRight</span><span class="p">:</span>
<span class="c">155. </span>                        <span class="n">fallingDirection</span> <span class="o">=</span> <span class="mi">2</span>
<span class="c">156. </span>                    <span class="k">elif</span> <span class="n">canFallTwoLeft</span> <span class="ow">and</span> <span class="n">canFallTwoRight</span><span class="p">:</span>
<span class="c">157. </span>                        <span class="n">fallingDirection</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">((</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="c">158. </span>
<span class="c">159. </span>                <span class="k">if</span> <span class="n">fallingDirection</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
<span class="c">160. </span>                    <span class="c1"># This sand can&#39;t fall, so move on.</span>
<span class="c">161. </span>                    <span class="k">continue</span>
<span class="c">162. </span>
<span class="c">163. </span>                <span class="c1"># Draw the sand in its new position:</span>
<span class="c">164. </span>                <span class="n">bext</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="n">sand</span><span class="p">[</span><span class="n">X</span><span class="p">],</span> <span class="n">sand</span><span class="p">[</span><span class="n">Y</span><span class="p">])</span>
<span class="c">165. </span>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># Erase old sand.</span>
<span class="c">166. </span>                <span class="n">bext</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="n">sand</span><span class="p">[</span><span class="n">X</span><span class="p">]</span> <span class="o">+</span> <span class="n">fallingDirection</span><span class="p">,</span> <span class="n">sand</span><span class="p">[</span><span class="n">Y</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="c">167. </span>                <span class="nb">print</span><span class="p">(</span><span class="n">SAND</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># Draw new sand.</span>
<span class="c">168. </span>
<span class="c">169. </span>                <span class="c1"># Move the grain of sand to its new position:</span>
<span class="c">170. </span>                <span class="n">allSand</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sand</span><span class="p">[</span><span class="n">X</span><span class="p">]</span> <span class="o">+</span> <span class="n">fallingDirection</span><span class="p">,</span> <span class="n">sand</span><span class="p">[</span><span class="n">Y</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="c">171. </span>                <span class="n">sandMovedOnThisStep</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c">172. </span>
<span class="c">173. </span>        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>  <span class="c1"># (Required for bext-using programs.)</span>
<span class="c">174. </span>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">PAUSE_LENGTH</span><span class="p">)</span>  <span class="c1"># Pause after this</span>
<span class="c">175. </span>
<span class="c">176. </span>        <span class="c1"># If no sand has moved on this step, reset the hourglass:</span>
<span class="c">177. </span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">sandMovedOnThisStep</span><span class="p">:</span>
<span class="c">178. </span>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="c">179. </span>            <span class="c1"># Erase all of the sand:</span>
<span class="c">180. </span>            <span class="k">for</span> <span class="n">sand</span> <span class="ow">in</span> <span class="n">allSand</span><span class="p">:</span>
<span class="c">181. </span>                <span class="n">bext</span><span class="o">.</span><span class="n">goto</span><span class="p">(</span><span class="n">sand</span><span class="p">[</span><span class="n">X</span><span class="p">],</span> <span class="n">sand</span><span class="p">[</span><span class="n">Y</span><span class="p">])</span>
<span class="c">182. </span>                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="c">183. </span>            <span class="k">break</span>  <span class="c1"># Break out of main simulation loop.</span>
<span class="c">184. </span>
<span class="c">185. </span>
<span class="c">186. </span><span class="c1"># If this program was run (instead of imported), run the game:</span>
<span class="c">187. </span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="c">188. </span>    <span class="k">try</span><span class="p">:</span>
<span class="c">189. </span>        <span class="n">main</span><span class="p">()</span>
<span class="c">190. </span>    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
<span class="c">191. </span>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>  <span class="c1"># When Ctrl-C is pressed, end the program.</span>
</pre></div>

<p class="calibre19">After entering the source code and running it a few times, try making experimental changes to it. The comments marked with <code class="calibre22">(!)</code> have suggestions for small changes you can make. On your own, you can also try to figure out how to do the following:</p>
<ul class="calibre25">
<li class="calibre8">Create wall shapes other than an hourglass.</li>
<li class="calibre8">Create points on the screen that continuously pour out new grains of sand.</li>
</ul>
<h2 id="calibre_link-168" class="calibre5">Exploring the Program</h2>
<p class="bodyfirst">Try to find the answers to the following questions. Experiment with some modifications to the code and rerun the program to see what effect the changes have.</p>
<ol class="decimal">
<li value="1" class="calibre8">What happens if you change <code class="calibre22">range(18, 37)</code> on line 31 to <code class="calibre22">range(18, 30)</code>?</li>
<li value="2" class="calibre8">What happens if you change <code class="calibre22">range(8)</code> on line 39 to <code class="calibre22">range(0)</code>?</li>
<li value="3" class="calibre8">What happens if you change <code class="calibre22">sandMovedOnThisStep = False</code> on line 82 to <code class="calibre22">sandMovedOnThisStep = True</code>?</li>
<li value="4" class="calibre8">What happens if you change <code class="calibre22">fallingDirection = None</code> on line 125 to <code class="calibre22">fallingDirection = 1</code>?</li>
<li value="5" class="calibre8">What happens if you change <code class="calibre22">random.random() * 100 &lt;= WIDE_FALL_CHANCE</code> on line 136 to <code class="calibre22">random.random() * 0 &lt;= WIDE_FALL_CHANCE</code>?</li>
</ol>
</section>
</div>








<a href="project35.html">Prev: Hex Grid</a> | <a href="project37.html">Next: Hungry Robots</a>
</body></html>