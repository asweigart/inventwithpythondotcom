<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8" /><link href="style.css" rel="stylesheet" type="text/css" /><link rel="stylesheet" type="text/css" href="pygments.css"><title>Twenty Forty Eight</title></head><body style="background-color: #fffeee;">

<script type="text/javascript">
//<![CDATA[

var _gaq = _gaq || [];
_gaq.push(['_setAccount', 'UA-5459430-3']);
_gaq.push(['_trackPageview']);

(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();

//]]>
</script>


<div style="background-color: #eeeddd; float: right; height: 310px; font-family: sans-serif;" id="otherbooks">
  <a href="#" onclick="document.getElementById('otherbooks').outerHTML='';" style="vertical-align: top;">(close)</a><br />

  <a target="_blank" href="https://nostarch.com/automatestuff2" onclick="javascript: pageTracker._trackPageview('/affiliate_chapters_automate.link');"><img src="/images/cover_automate2_thumb.webp" style="height: 200px; border: solid black 1px;" /></a>
  <a target="_blank" href="https://nostarch.com/big-book-small-python-projects" onclick="javascript: pageTracker._trackPageview('/affiliate_chapters_bigbookpython.link');"><img src="/images/cover_bigbookpython_thumb.webp" style="height: 200px; border: solid black 1px;" /></a>
  <a target="_blank" href="https://nostarch.com/beyond-basic-stuff-python" onclick="javascript: pageTracker._trackPageview('/affiliate_chapters_beyond.link');"><img src="/images/cover_beyond_thumb.webp" style="height: 200px; border: solid black 1px;" /></a>
  <a target="_blank" href="https://nostarch.com/inventwithpython" onclick="javascript: pageTracker._trackPageview('/affiliate_chapters_invent.link');"><img src="/images/cover_invent4th_thumb.webp" style="height: 200px; border: solid black 1px;" /></a>
  <a target="_blank" href="https://www.amazon.com/Making-Games-Python-Pygame-Sweigart/dp/1469901730?ie=UTF8&amp;tag=playwithpyth-20&amp;linkCode=as2&amp;camp=1789&amp;creative=9325&amp;creativeASIN=1469901730" onclick="javascript: pageTracker._trackPageview('/affiliate_chapters_pygame.link');"><img src="/images/cover_makinggames_thumb.webp" style="height: 200px; border: solid black 1px; /"></a>
  <a target="_blank" href="https://nostarch.com/crackingcodes" onclick="javascript: pageTracker._trackPageview('/affiliate_chapters_hacking.link');"><img src="/images/cover_crackingcodes_thumb.webp" style="height: 200px; border: solid black 1px;" /></a>
  <a target="_blank" href="https://nostarch.com/scratchplayground"><img src="/images/cover_scratchprogrammingplayground_thumb.webp" style="height: 200px; border: solid black 1px;" /></a>
  <a target="_blank" href="https://nostarch.com/codingwithminecraft"><img src="/images/cover_codingwithminecraft_thumb.webp" style="height: 200px; border: solid black 1px;" /></a>
  <br />
  <a href="https://inventwithpython.com/automateudemy">Use this link to get 70% off the Automate the Boring Stuff online video course.</a><br />
  <a href="https://www.patreon.com/AlSweigart">Support me on Patreon</a>
</div>

<a href="project78.html">Prev: Trick Questions</a> | <a href="project80.html">Next: Vigenère Cipher</a>





<div type="bodymatter chapter" class="calibre1" id="calibre_link-324">
<section class="toclist">
<header class="calibre10">
<h1 class="chapter">
<span class="chapternumber">#79</span><br class="calibre14" />
<span class="chaptertitle">Twenty Forty-Eight</span></h1>
</header>
<figure class="opener">
<img src="images/000002.webp" alt="" class="calibre12" />
</figure>
<p class="chapterintro">Gabriele Cirulli, a web developer, invented the game 2048 in one weekend. It was inspired by Veewo Studios’ 1024 game, which in turn was inspired by Threes!, a game by the development team Sirvo. In 2048, you must merge numbers on a 4 × 4 board to clear them from the screen. Two 2s merge into a 4, two 4s merge into an 8, and so on. The game adds a new 2 to the board on each merging. The objective is to reach 2048 before the entire board fills up.</p>
<h2 id="calibre_link-325" class="calibre5">The Program in Action</h2>
<p class="bodyfirst">When you run <em class="calibre9">twentyfortyeight.py</em>, the output will look like this:</p>
<pre class="calibre24"><code class="calibre22">Twenty Forty-Eight, by Al Sweigart al@inventwithpython.com
<var class="calibre27">--snip--</var>
+-----+-----+-----+-----+
|     |     |     |     |
|     |     |  2  |  16 |
|     |     |     |     |
+-----+-----+-----+-----+
|     |     |     |     |
|     |  16 |  4  |  2  |
|     |     |     |     |
+-----+-----+-----+-----+
|     |     |     |     |
|  2  |     |  4  |  32 |
|     |     |     |     |
+-----+-----+-----+-----+
|     |     |     |     |
|     |     |     |  2  |
|     |     |     |     |
+-----+-----+-----+-----+

Score: 80
Enter move: (WASD or Q to quit)
<var class="calibre27">--snip--</var></code></pre>
<h2 id="calibre_link-326" class="calibre5">How It Works</h2>
<p class="bodyfirst">This program implements its sliding behavior using “column” data structures, represented by lists of four strings: <code class="calibre22">BLANK</code> (a single-space string), <code class="calibre22">'2'</code>, <code class="calibre22">'4'</code>, <code class="calibre22">'8'</code>, and so on. The first value in this list represents the bottom of the column, while the last represents the top. Numbers that combine in a column always slide downward, whether the player slides the tiles up, down, left, or right. Think of it as gravity pulling the tiles in these directions. For example, <a href="#calibre_link-353" id="calibre_link-814" class="linkurl">Figure 79-1</a> shows a board with tiles sliding to the right. We’ll create four lists to represent the columns:</p>
<ul class="calibre25">
<li class="calibre8"><code class="calibre22">['2', '4', '8', ' ']</code></li>
<li class="calibre8"><code class="calibre22">[' ', ' ', ' ', '4']</code></li>
<li class="calibre8"><code class="calibre22">[' ', ' ', ' ', '2']</code></li>
<li class="calibre8"><code class="calibre22">[' ', ' ', ' ', ' ']</code></li>
</ul>
<p class="calibre19">The <code class="calibre22">combineTilesInColumn()</code> function accepts one column list and returns another, with the matching numbers combined and shifted toward the bottom. The code that calls <code class="calibre22">combineTilesInColumn()</code> handles creating the column lists in the appropriate direction and updating the game board with the returned list.</p>
<figure class="calibre28">
<img src="images/000014.webp" alt="f79001" class="calibre12" />
<figcaption class="calibre29"><p class="calibre30"><a id="calibre_link-353" class="linkurl">Figure 79-1</a>: Columns (highlighted) when a game board is sliding to the right</p></figcaption>
</figure>
<div class="highlight"><pre><span></span>
<span class="c">  1. </span><span class="sd">&quot;&quot;&quot;Twenty Forty-Eight, by Al Sweigart al@inventwithpython.com</span>
<span class="c">  2. </span><span class="sd">A sliding tile game to combine exponentially-increasing numbers.</span>
<span class="c">  3. </span><span class="sd">Inspired by Gabriele Cirulli&#39;s 2048, which is a clone of Veewo Studios&#39;</span>
<span class="c">  4. </span><span class="sd">1024, which in turn is a clone of the Threes! game.</span>
<span class="c">  5. </span><span class="sd">More info at https://en.wikipedia.org/wiki/2048_(video_game)</span>
<span class="c">  6. </span><span class="sd">This code is available at https://nostarch.com/big-book-small-python-programming</span>
<span class="c">  7. </span><span class="sd">Tags: large, game, puzzle&quot;&quot;&quot;</span>
<span class="c">  8. </span>
<span class="c">  9. </span><span class="kn">import</span> <span class="nn">random</span><span class="o">,</span> <span class="nn">sys</span>
<span class="c"> 10. </span>
<span class="c"> 11. </span><span class="c1"># Set up the constants:</span>
<span class="c"> 12. </span><span class="n">BLANK</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>  <span class="c1"># A value that represents a blank space on the board.</span>
<span class="c"> 13. </span>
<span class="c"> 14. </span>
<span class="c"> 15. </span><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="c"> 16. </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;Twenty Forty-Eight, by Al Sweigart al@inventwithpython.com</span>
<span class="c"> 17. </span>
<span class="c"> 18. </span><span class="s1">Slide all the tiles on the board in one of four directions. Tiles with</span>
<span class="c"> 19. </span><span class="s1">like numbers will combine into larger-numbered tiles. A new 2 tile is</span>
<span class="c"> 20. </span><span class="s1">added to the board on each move. You win if you can create a 2048 tile.</span>
<span class="c"> 21. </span><span class="s1">You lose if the board fills up the tiles before then.&#39;&#39;&#39;</span><span class="p">)</span>
<span class="c"> 22. </span>    <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Press Enter to begin...&#39;</span><span class="p">)</span>
<span class="c"> 23. </span>
<span class="c"> 24. </span>    <span class="n">gameBoard</span> <span class="o">=</span> <span class="n">getNewBoard</span><span class="p">()</span>
<span class="c"> 25. </span>
<span class="c"> 26. </span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1"># Main game loop.</span>
<span class="c"> 27. </span>        <span class="n">drawBoard</span><span class="p">(</span><span class="n">gameBoard</span><span class="p">)</span>
<span class="c"> 28. </span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Score:&#39;</span><span class="p">,</span> <span class="n">getScore</span><span class="p">(</span><span class="n">gameBoard</span><span class="p">))</span>
<span class="c"> 29. </span>        <span class="n">playerMove</span> <span class="o">=</span> <span class="n">askForPlayerMove</span><span class="p">()</span>
<span class="c"> 30. </span>        <span class="n">gameBoard</span> <span class="o">=</span> <span class="n">makeMove</span><span class="p">(</span><span class="n">gameBoard</span><span class="p">,</span> <span class="n">playerMove</span><span class="p">)</span>
<span class="c"> 31. </span>        <span class="n">addTwoToBoard</span><span class="p">(</span><span class="n">gameBoard</span><span class="p">)</span>
<span class="c"> 32. </span>
<span class="c"> 33. </span>        <span class="k">if</span> <span class="n">isFull</span><span class="p">(</span><span class="n">gameBoard</span><span class="p">):</span>
<span class="c"> 34. </span>            <span class="n">drawBoard</span><span class="p">(</span><span class="n">gameBoard</span><span class="p">)</span>
<span class="c"> 35. </span>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Game Over - Thanks for playing!&#39;</span><span class="p">)</span>
<span class="c"> 36. </span>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
<span class="c"> 37. </span>
<span class="c"> 38. </span>
<span class="c"> 39. </span><span class="k">def</span> <span class="nf">getNewBoard</span><span class="p">():</span>
<span class="c"> 40. </span>    <span class="sd">&quot;&quot;&quot;Returns a new data structure that represents a board.</span>
<span class="c"> 41. </span>
<span class="c"> 42. </span><span class="sd">    It&#39;s a dictionary with keys of (x, y) tuples and values of the tile</span>
<span class="c"> 43. </span><span class="sd">    at that space. The tile is either a power-of-two integer or BLANK.</span>
<span class="c"> 44. </span><span class="sd">    The coordinates are laid out as:</span>
<span class="c"> 45. </span><span class="sd">       X0 1 2 3</span>
<span class="c"> 46. </span><span class="sd">      Y+-+-+-+-+</span>
<span class="c"> 47. </span><span class="sd">      0| | | | |</span>
<span class="c"> 48. </span><span class="sd">       +-+-+-+-+</span>
<span class="c"> 49. </span><span class="sd">      1| | | | |</span>
<span class="c"> 50. </span><span class="sd">       +-+-+-+-+</span>
<span class="c"> 51. </span><span class="sd">      2| | | | |</span>
<span class="c"> 52. </span><span class="sd">       +-+-+-+-+</span>
<span class="c"> 53. </span><span class="sd">      3| | | | |</span>
<span class="c"> 54. </span><span class="sd">       +-+-+-+-+&quot;&quot;&quot;</span>
<span class="c"> 55. </span>
<span class="c"> 56. </span>    <span class="n">newBoard</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Contains the board data structure to be returned.</span>
<span class="c"> 57. </span>    <span class="c1"># Loop over every possible space and set all the tiles to blank:</span>
<span class="c"> 58. </span>    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<span class="c"> 59. </span>        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<span class="c"> 60. </span>            <span class="n">newBoard</span><span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)]</span> <span class="o">=</span> <span class="n">BLANK</span>
<span class="c"> 61. </span>
<span class="c"> 62. </span>    <span class="c1"># Pick two random spaces for the two starting 2&#39;s:</span>
<span class="c"> 63. </span>    <span class="n">startingTwosPlaced</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># The number of starting spaces picked.</span>
<span class="c"> 64. </span>    <span class="k">while</span> <span class="n">startingTwosPlaced</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># Repeat for duplicate spaces.</span>
<span class="c"> 65. </span>        <span class="n">randomSpace</span> <span class="o">=</span> <span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="c"> 66. </span>        <span class="c1"># Make sure the randomly selected space isn&#39;t already taken:</span>
<span class="c"> 67. </span>        <span class="k">if</span> <span class="n">newBoard</span><span class="p">[</span><span class="n">randomSpace</span><span class="p">]</span> <span class="o">==</span> <span class="n">BLANK</span><span class="p">:</span>
<span class="c"> 68. </span>            <span class="n">newBoard</span><span class="p">[</span><span class="n">randomSpace</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="c"> 69. </span>            <span class="n">startingTwosPlaced</span> <span class="o">=</span> <span class="n">startingTwosPlaced</span> <span class="o">+</span> <span class="mi">1</span>
<span class="c"> 70. </span>
<span class="c"> 71. </span>    <span class="k">return</span> <span class="n">newBoard</span>
<span class="c"> 72. </span>
<span class="c"> 73. </span>
<span class="c"> 74. </span><span class="k">def</span> <span class="nf">drawBoard</span><span class="p">(</span><span class="n">board</span><span class="p">):</span>
<span class="c"> 75. </span>    <span class="sd">&quot;&quot;&quot;Draws the board data structure on the screen.&quot;&quot;&quot;</span>
<span class="c"> 76. </span>
<span class="c"> 77. </span>    <span class="c1"># Go through each possible space left to right, top to bottom, and</span>
<span class="c"> 78. </span>    <span class="c1"># create a list of what each space&#39;s label should be.</span>
<span class="c"> 79. </span>    <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># A list of strings for the number/blank for that tile.</span>
<span class="c"> 80. </span>    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<span class="c"> 81. </span>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<span class="c"> 82. </span>            <span class="n">tile</span> <span class="o">=</span> <span class="n">board</span><span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)]</span>  <span class="c1"># Get the tile at this space.</span>
<span class="c"> 83. </span>            <span class="c1"># Make sure the label is 5 spaces long:</span>
<span class="c"> 84. </span>            <span class="n">labelForThisTile</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">tile</span><span class="p">)</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="c"> 85. </span>            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labelForThisTile</span><span class="p">)</span>
<span class="c"> 86. </span>
<span class="c"> 87. </span>    <span class="c1"># The {} are replaced with the label for that tile:</span>
<span class="c"> 88. </span>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
<span class="c"> 89. </span><span class="s2">+-----+-----+-----+-----+</span>
<span class="c"> 90. </span><span class="s2">|     |     |     |     |</span>
<span class="c"> 91. </span><span class="s2">|</span><span class="si">{}</span><span class="s2">|</span><span class="si">{}</span><span class="s2">|</span><span class="si">{}</span><span class="s2">|</span><span class="si">{}</span><span class="s2">|</span>
<span class="c"> 92. </span><span class="s2">|     |     |     |     |</span>
<span class="c"> 93. </span><span class="s2">+-----+-----+-----+-----+</span>
<span class="c"> 94. </span><span class="s2">|     |     |     |     |</span>
<span class="c"> 95. </span><span class="s2">|</span><span class="si">{}</span><span class="s2">|</span><span class="si">{}</span><span class="s2">|</span><span class="si">{}</span><span class="s2">|</span><span class="si">{}</span><span class="s2">|</span>
<span class="c"> 96. </span><span class="s2">|     |     |     |     |</span>
<span class="c"> 97. </span><span class="s2">+-----+-----+-----+-----+</span>
<span class="c"> 98. </span><span class="s2">|     |     |     |     |</span>
<span class="c"> 99. </span><span class="s2">|</span><span class="si">{}</span><span class="s2">|</span><span class="si">{}</span><span class="s2">|</span><span class="si">{}</span><span class="s2">|</span><span class="si">{}</span><span class="s2">|</span>
<span class="c">100. </span><span class="s2">|     |     |     |     |</span>
<span class="c">101. </span><span class="s2">+-----+-----+-----+-----+</span>
<span class="c">102. </span><span class="s2">|     |     |     |     |</span>
<span class="c">103. </span><span class="s2">|</span><span class="si">{}</span><span class="s2">|</span><span class="si">{}</span><span class="s2">|</span><span class="si">{}</span><span class="s2">|</span><span class="si">{}</span><span class="s2">|</span>
<span class="c">104. </span><span class="s2">|     |     |     |     |</span>
<span class="c">105. </span><span class="s2">+-----+-----+-----+-----+</span>
<span class="c">106. </span><span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">labels</span><span class="p">))</span>
<span class="c">107. </span>
<span class="c">108. </span>
<span class="c">109. </span><span class="k">def</span> <span class="nf">getScore</span><span class="p">(</span><span class="n">board</span><span class="p">):</span>
<span class="c">110. </span>    <span class="sd">&quot;&quot;&quot;Returns the sum of all the tiles on the board data structure.&quot;&quot;&quot;</span>
<span class="c">111. </span>    <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
<span class="c">112. </span>    <span class="c1"># Loop over every space and add the tile to the score:</span>
<span class="c">113. </span>    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<span class="c">114. </span>        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<span class="c">115. </span>            <span class="c1"># Only add non-blank tiles to the score:</span>
<span class="c">116. </span>            <span class="k">if</span> <span class="n">board</span><span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)]</span> <span class="o">!=</span> <span class="n">BLANK</span><span class="p">:</span>
<span class="c">117. </span>                <span class="n">score</span> <span class="o">=</span> <span class="n">score</span> <span class="o">+</span> <span class="n">board</span><span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)]</span>
<span class="c">118. </span>    <span class="k">return</span> <span class="n">score</span>
<span class="c">119. </span>
<span class="c">120. </span>
<span class="c">121. </span><span class="k">def</span> <span class="nf">combineTilesInColumn</span><span class="p">(</span><span class="n">column</span><span class="p">):</span>
<span class="c">122. </span>    <span class="sd">&quot;&quot;&quot;The column is a list of four tile. Index 0 is the &quot;bottom&quot; of</span>
<span class="c">123. </span><span class="sd">    the column, and tiles are pulled &quot;down&quot; and combine if they are the</span>
<span class="c">124. </span><span class="sd">    same. For example, combineTilesInColumn([2, BLANK, 2, BLANK])</span>
<span class="c">125. </span><span class="sd">    returns [4, BLANK, BLANK, BLANK].&quot;&quot;&quot;</span>
<span class="c">126. </span>
<span class="c">127. </span>    <span class="c1"># Copy only the numbers (not blanks) from column to combinedTiles</span>
<span class="c">128. </span>    <span class="n">combinedTiles</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># A list of the non-blank tiles in column.</span>
<span class="c">129. </span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<span class="c">130. </span>        <span class="k">if</span> <span class="n">column</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">BLANK</span><span class="p">:</span>
<span class="c">131. </span>            <span class="n">combinedTiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">column</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<span class="c">132. </span>
<span class="c">133. </span>    <span class="c1"># Keep adding blanks until there are 4 tiles:</span>
<span class="c">134. </span>    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">combinedTiles</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">:</span>
<span class="c">135. </span>        <span class="n">combinedTiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">BLANK</span><span class="p">)</span>
<span class="c">136. </span>
<span class="c">137. </span>    <span class="c1"># Combine numbers if the one &quot;above&quot; it is the same, and double it.</span>
<span class="c">138. </span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>  <span class="c1"># Skip index 3: it&#39;s the topmost space.</span>
<span class="c">139. </span>        <span class="k">if</span> <span class="n">combinedTiles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">combinedTiles</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
<span class="c">140. </span>            <span class="n">combinedTiles</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">2</span>  <span class="c1"># Double the number in the tile.</span>
<span class="c">141. </span>            <span class="c1"># Move the tiles above it down one space:</span>
<span class="c">142. </span>            <span class="k">for</span> <span class="n">aboveIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
<span class="c">143. </span>                <span class="n">combinedTiles</span><span class="p">[</span><span class="n">aboveIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">combinedTiles</span><span class="p">[</span><span class="n">aboveIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
<span class="c">144. </span>            <span class="n">combinedTiles</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">BLANK</span>  <span class="c1"># Topmost space is always BLANK.</span>
<span class="c">145. </span>    <span class="k">return</span> <span class="n">combinedTiles</span>
<span class="c">146. </span>
<span class="c">147. </span>
<span class="c">148. </span><span class="k">def</span> <span class="nf">makeMove</span><span class="p">(</span><span class="n">board</span><span class="p">,</span> <span class="n">move</span><span class="p">):</span>
<span class="c">149. </span>    <span class="sd">&quot;&quot;&quot;Carries out the move on the board.</span>
<span class="c">150. </span>
<span class="c">151. </span><span class="sd">    The move argument is either &#39;W&#39;, &#39;A&#39;, &#39;S&#39;, or &#39;D&#39; and the function</span>
<span class="c">152. </span><span class="sd">    returns the resulting board data structure.&quot;&quot;&quot;</span>
<span class="c">153. </span>
<span class="c">154. </span>    <span class="c1"># The board is split up into four columns, which are different</span>
<span class="c">155. </span>    <span class="c1"># depending on the direction of the move:</span>
<span class="c">156. </span>    <span class="k">if</span> <span class="n">move</span> <span class="o">==</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span>
<span class="c">157. </span>        <span class="n">allColumnsSpaces</span> <span class="o">=</span> <span class="p">[[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span>
<span class="c">158. </span>                            <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span>
<span class="c">159. </span>                            <span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)],</span>
<span class="c">160. </span>                            <span class="p">[(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]]</span>
<span class="c">161. </span>    <span class="k">elif</span> <span class="n">move</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
<span class="c">162. </span>        <span class="n">allColumnsSpaces</span> <span class="o">=</span> <span class="p">[[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
<span class="c">163. </span>                            <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
<span class="c">164. </span>                            <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">)],</span>
<span class="c">165. </span>                            <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]]</span>
<span class="c">166. </span>    <span class="k">elif</span> <span class="n">move</span> <span class="o">==</span> <span class="s1">&#39;S&#39;</span><span class="p">:</span>
<span class="c">167. </span>        <span class="n">allColumnsSpaces</span> <span class="o">=</span> <span class="p">[[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
<span class="c">168. </span>                            <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
<span class="c">169. </span>                            <span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
<span class="c">170. </span>                            <span class="p">[(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]]</span>
<span class="c">171. </span>    <span class="k">elif</span> <span class="n">move</span> <span class="o">==</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span>
<span class="c">172. </span>        <span class="n">allColumnsSpaces</span> <span class="o">=</span> <span class="p">[[(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span>
<span class="c">173. </span>                            <span class="p">[(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)],</span>
<span class="c">174. </span>                            <span class="p">[(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)],</span>
<span class="c">175. </span>                            <span class="p">[(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]]</span>
<span class="c">176. </span>
<span class="c">177. </span>    <span class="c1"># The board data structure after making the move:</span>
<span class="c">178. </span>    <span class="n">boardAfterMove</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c">179. </span>    <span class="k">for</span> <span class="n">columnSpaces</span> <span class="ow">in</span> <span class="n">allColumnsSpaces</span><span class="p">:</span>  <span class="c1"># Loop over all 4 columns.</span>
<span class="c">180. </span>        <span class="c1"># Get the tiles of this column (The first tile is the &quot;bottom&quot;</span>
<span class="c">181. </span>        <span class="c1"># of the column):</span>
<span class="c">182. </span>        <span class="n">firstTileSpace</span> <span class="o">=</span> <span class="n">columnSpaces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c">183. </span>        <span class="n">secondTileSpace</span> <span class="o">=</span> <span class="n">columnSpaces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="c">184. </span>        <span class="n">thirdTileSpace</span> <span class="o">=</span> <span class="n">columnSpaces</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="c">185. </span>        <span class="n">fourthTileSpace</span> <span class="o">=</span> <span class="n">columnSpaces</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="c">186. </span>
<span class="c">187. </span>        <span class="n">firstTile</span> <span class="o">=</span> <span class="n">board</span><span class="p">[</span><span class="n">firstTileSpace</span><span class="p">]</span>
<span class="c">188. </span>        <span class="n">secondTile</span> <span class="o">=</span> <span class="n">board</span><span class="p">[</span><span class="n">secondTileSpace</span><span class="p">]</span>
<span class="c">189. </span>        <span class="n">thirdTile</span> <span class="o">=</span> <span class="n">board</span><span class="p">[</span><span class="n">thirdTileSpace</span><span class="p">]</span>
<span class="c">190. </span>        <span class="n">fourthTile</span> <span class="o">=</span> <span class="n">board</span><span class="p">[</span><span class="n">fourthTileSpace</span><span class="p">]</span>
<span class="c">191. </span>
<span class="c">192. </span>        <span class="c1"># Form the column and combine the tiles in it:</span>
<span class="c">193. </span>        <span class="n">column</span> <span class="o">=</span> <span class="p">[</span><span class="n">firstTile</span><span class="p">,</span> <span class="n">secondTile</span><span class="p">,</span> <span class="n">thirdTile</span><span class="p">,</span> <span class="n">fourthTile</span><span class="p">]</span>
<span class="c">194. </span>        <span class="n">combinedTilesColumn</span> <span class="o">=</span> <span class="n">combineTilesInColumn</span><span class="p">(</span><span class="n">column</span><span class="p">)</span>
<span class="c">195. </span>
<span class="c">196. </span>        <span class="c1"># Set up the new board data structure with the combined tiles:</span>
<span class="c">197. </span>        <span class="n">boardAfterMove</span><span class="p">[</span><span class="n">firstTileSpace</span><span class="p">]</span> <span class="o">=</span> <span class="n">combinedTilesColumn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c">198. </span>        <span class="n">boardAfterMove</span><span class="p">[</span><span class="n">secondTileSpace</span><span class="p">]</span> <span class="o">=</span> <span class="n">combinedTilesColumn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="c">199. </span>        <span class="n">boardAfterMove</span><span class="p">[</span><span class="n">thirdTileSpace</span><span class="p">]</span> <span class="o">=</span> <span class="n">combinedTilesColumn</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="c">200. </span>        <span class="n">boardAfterMove</span><span class="p">[</span><span class="n">fourthTileSpace</span><span class="p">]</span> <span class="o">=</span> <span class="n">combinedTilesColumn</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="c">201. </span>
<span class="c">202. </span>    <span class="k">return</span> <span class="n">boardAfterMove</span>
<span class="c">203. </span>
<span class="c">204. </span>
<span class="c">205. </span><span class="k">def</span> <span class="nf">askForPlayerMove</span><span class="p">():</span>
<span class="c">206. </span>    <span class="sd">&quot;&quot;&quot;Asks the player for the direction of their next move (or quit).</span>
<span class="c">207. </span>
<span class="c">208. </span><span class="sd">    Ensures they enter a valid move: either &#39;W&#39;, &#39;A&#39;, &#39;S&#39; or &#39;D&#39;.&quot;&quot;&quot;</span>
<span class="c">209. </span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Enter move: (WASD or Q to quit)&#39;</span><span class="p">)</span>
<span class="c">210. </span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1"># Keep looping until they enter a valid move.</span>
<span class="c">211. </span>        <span class="n">move</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;&gt; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
<span class="c">212. </span>        <span class="k">if</span> <span class="n">move</span> <span class="o">==</span> <span class="s1">&#39;Q&#39;</span><span class="p">:</span>
<span class="c">213. </span>            <span class="c1"># End the program:</span>
<span class="c">214. </span>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Thanks for playing!&#39;</span><span class="p">)</span>
<span class="c">215. </span>            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
<span class="c">216. </span>
<span class="c">217. </span>        <span class="c1"># Either return the valid move, or loop back and ask again:</span>
<span class="c">218. </span>        <span class="k">if</span> <span class="n">move</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">):</span>
<span class="c">219. </span>            <span class="k">return</span> <span class="n">move</span>
<span class="c">220. </span>        <span class="k">else</span><span class="p">:</span>
<span class="c">221. </span>            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Enter one of &quot;W&quot;, &quot;A&quot;, &quot;S&quot;, &quot;D&quot;, or &quot;Q&quot;.&#39;</span><span class="p">)</span>
<span class="c">222. </span>
<span class="c">223. </span>
<span class="c">224. </span><span class="k">def</span> <span class="nf">addTwoToBoard</span><span class="p">(</span><span class="n">board</span><span class="p">):</span>
<span class="c">225. </span>    <span class="sd">&quot;&quot;&quot;Adds a new 2 tile randomly to the board.&quot;&quot;&quot;</span>
<span class="c">226. </span>    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
<span class="c">227. </span>        <span class="n">randomSpace</span> <span class="o">=</span> <span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="c">228. </span>        <span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="n">randomSpace</span><span class="p">]</span> <span class="o">==</span> <span class="n">BLANK</span><span class="p">:</span>
<span class="c">229. </span>            <span class="n">board</span><span class="p">[</span><span class="n">randomSpace</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="c">230. </span>            <span class="k">return</span>  <span class="c1"># Return after finding one non-blank tile.</span>
<span class="c">231. </span>
<span class="c">232. </span>
<span class="c">233. </span><span class="k">def</span> <span class="nf">isFull</span><span class="p">(</span><span class="n">board</span><span class="p">):</span>
<span class="c">234. </span>    <span class="sd">&quot;&quot;&quot;Returns True if the board data structure has no blanks.&quot;&quot;&quot;</span>
<span class="c">235. </span>    <span class="c1"># Loop over every space on the board:</span>
<span class="c">236. </span>    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<span class="c">237. </span>        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
<span class="c">238. </span>            <span class="c1"># If a space is blank, return False:</span>
<span class="c">239. </span>            <span class="k">if</span> <span class="n">board</span><span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)]</span> <span class="o">==</span> <span class="n">BLANK</span><span class="p">:</span>
<span class="c">240. </span>                <span class="k">return</span> <span class="kc">False</span>
<span class="c">241. </span>    <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># No space is blank, so return True.</span>
<span class="c">242. </span>
<span class="c">243. </span>
<span class="c">244. </span><span class="c1"># If this program was run (instead of imported), run the game:</span>
<span class="c">245. </span><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
<span class="c">246. </span>    <span class="k">try</span><span class="p">:</span>
<span class="c">247. </span>        <span class="n">main</span><span class="p">()</span>
<span class="c">248. </span>    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
<span class="c">249. </span>        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>  <span class="c1"># When Ctrl-C is pressed, end the program.</span>
</pre></div>

<h2 id="calibre_link-327" class="calibre5">Exploring the Program</h2>
<p class="bodyfirst">Try to find the answers to the following questions. Experiment with some modifications to the code and rerun the program to see what effect the changes have.</p>
<ol class="decimal">
<li value="1" class="calibre8">What happens if you change <code class="calibre22">return score</code> on line 118 to <code class="calibre22">return 9999</code>?</li>
<li value="2" class="calibre8">What happens if you change <code class="calibre22">board[randomSpace] = 2</code> on line 229 to <code class="calibre22">board[randomSpace] = 256</code>?</li>
</ol>
</section>
</div>








<a href="project78.html">Prev: Trick Questions</a> | <a href="project80.html">Next: Vigenère Cipher</a>
</body></html>